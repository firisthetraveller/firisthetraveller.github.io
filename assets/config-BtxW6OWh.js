const Os=navigator.language.split("-")[0],Rs=["en","fr"].includes(Os)?Os:"en",Ky=e=>e?e[Rs]?e[Rs]:e:"";var Vi=function(e,t){return Vi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Vi(e,t)};function k(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");Vi(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}var He=function(){return He=Object.assign||function(t){for(var n,r=1,i=arguments.length;r<i;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},He.apply(this,arguments)};function g(e,t,n,r){function i(o){return o instanceof n?o:new n(function(s){s(o)})}return new(n||(n=Promise))(function(o,s){function a(l){try{c(r.next(l))}catch(f){s(f)}}function u(l){try{c(r.throw(l))}catch(f){s(f)}}function c(l){l.done?o(l.value):i(l.value).then(a,u)}c((r=r.apply(e,t||[])).next())})}function m(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,s=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return s.next=a(0),s.throw=a(1),s.return=a(2),typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function a(c){return function(l){return u([c,l])}}function u(c){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,c[0]&&(n=0)),n;)try{if(r=1,i&&(o=c[0]&2?i.return:c[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,c[1])).done)return o;switch(i=0,o&&(c=[c[0]&2,o.value]),c[0]){case 0:case 1:o=c;break;case 4:return n.label++,{value:c[1],done:!1};case 5:n.label++,i=c[1],c=[0];continue;case 7:c=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(c[0]===6||c[0]===2)){n=0;continue}if(c[0]===3&&(!o||c[1]>o[0]&&c[1]<o[3])){n.label=c[1];break}if(c[0]===6&&n.label<o[1]){n.label=o[1],o=c;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(c);break}o[2]&&n.ops.pop(),n.trys.pop();continue}c=t.call(e,n)}catch(l){c=[6,l],i=0}finally{r=o=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function _i(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function cr(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var r=n.call(e),i,o=[],s;try{for(;(t===void 0||t-- >0)&&!(i=r.next()).done;)o.push(i.value)}catch(a){s={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(s)throw s.error}}return o}function H(e,t,n){if(n||arguments.length===2)for(var r=0,i=t.length,o;r<i;r++)(o||!(r in t))&&(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}var tf=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=i&63|128):(i&64512)===55296&&r+1<e.length&&(e.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(e.charCodeAt(++r)&1023),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=i&63|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=i&63|128)}return t},ef=function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[n++];t[r++]=String.fromCharCode((i&31)<<6|o&63)}else if(i>239&&i<365){var o=e[n++],s=e[n++],a=e[n++],u=((i&7)<<18|(o&63)<<12|(s&63)<<6|a&63)-65536;t[r++]=String.fromCharCode(55296+(u>>10)),t[r++]=String.fromCharCode(56320+(u&1023))}else{var o=e[n++],s=e[n++];t[r++]=String.fromCharCode((i&15)<<12|(o&63)<<6|s&63)}}return t.join("")},xs={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var o=e[i],s=i+1<e.length,a=s?e[i+1]:0,u=i+2<e.length,c=u?e[i+2]:0,l=o>>2,f=(o&3)<<4|a>>4,h=(a&15)<<2|c>>6,p=c&63;u||(p=64,s||(h=64)),r.push(n[l],n[f],n[h],n[p])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(tf(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):ef(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var o=n[e.charAt(i++)],s=i<e.length,a=s?n[e.charAt(i)]:0;++i;var u=i<e.length,c=u?n[e.charAt(i)]:64;++i;var l=i<e.length,f=l?n[e.charAt(i)]:64;if(++i,o==null||a==null||c==null||f==null)throw Error();var h=o<<2|a>>4;if(r.push(h),c!==64){var p=a<<4&240|c>>2;if(r.push(p),f!==64){var d=c<<6&192|f;r.push(d)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};function nf(e){return Dn(void 0,e)}function Dn(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:var n=t;return new Date(n.getTime());case Object:e===void 0&&(e={});break;case Array:e=[];break;default:return t}for(var r in t)!t.hasOwnProperty(r)||!rf(r)||(e[r]=Dn(e[r],t[r]));return e}function rf(e){return e!=="__proto__"}var of=(function(){function e(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(n,r){t.resolve=n,t.reject=r})}return e.prototype.wrapCallback=function(t){var n=this;return function(r,i){r?n.reject(r):n.resolve(i),typeof t=="function"&&(n.promise.catch(function(){}),t.length===1?t(r):t(r,i))}},e})();function sf(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n={alg:"none",type:"JWT"},r="demo-project",i=e.iat||0,o=e.sub||e.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=He({iss:"https://securetoken.google.com/"+r,aud:r,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},e),a="";return[xs.encodeString(JSON.stringify(n),!1),xs.encodeString(JSON.stringify(s),!1),a].join(".")}function Se(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function af(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Se())}function uf(){try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function cf(){return typeof self=="object"&&self.self===self}function lf(){var e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function ff(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function hf(){return Se().indexOf("Electron/")>=0}function pf(){var e=Se();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function df(){return Se().indexOf("MSAppHost/")>=0}var yf="FirebaseError",vf=(function(e){k(t,e);function t(n,r,i){var o=e.call(this,r)||this;return o.code=n,o.customData=i,o.name=yf,Object.setPrototypeOf(o,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,yo.prototype.create),o}return t})(Error),yo=(function(){function e(t,n,r){this.service=t,this.serviceName=n,this.errors=r}return e.prototype.create=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=n[0]||{},o=this.service+"/"+t,s=this.errors[t],a=s?mf(s,i):"Error",u=this.serviceName+": "+a+" ("+o+").",c=new vf(o,u,i);return c},e})();function mf(e,t){return e.replace(gf,function(n,r){var i=t[r];return i!=null?String(i):"<"+r+"?>"})}var gf=/\{\$([^}]+)}/g;function Ps(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function wf(e,t){var n=new bf(e,t);return n.subscribe.bind(n)}var bf=(function(){function e(t,n){var r=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(function(){t(r)}).catch(function(i){r.error(i)})}return e.prototype.next=function(t){this.forEachObserver(function(n){n.next(t)})},e.prototype.error=function(t){this.forEachObserver(function(n){n.error(t)}),this.close(t)},e.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},e.prototype.subscribe=function(t,n,r){var i=this,o;if(t===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");Ef(t,["next","error","complete"])?o=t:o={next:t,error:n,complete:r},o.next===void 0&&(o.next=Si),o.error===void 0&&(o.error=Si),o.complete===void 0&&(o.complete=Si);var s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?o.error(i.finalError):o.complete()}catch{}}),this.observers.push(o),s},e.prototype.unsubscribeOne=function(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))},e.prototype.forEachObserver=function(t){if(!this.finalized)for(var n=0;n<this.observers.length;n++)this.sendOne(n,t)},e.prototype.sendOne=function(t,n){var r=this;this.task.then(function(){if(r.observers!==void 0&&r.observers[t]!==void 0)try{n(r.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})},e.prototype.close=function(t){var n=this;this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(function(){n.observers=void 0,n.onNoObservers=void 0}))},e})();function Ef(e,t){if(typeof e!="object"||e===null)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&typeof e[i]=="function")return!0}return!1}function Si(){}function X(e){return e&&e._delegate?e._delegate:e}var Yr=(function(){function e(t,n,r){this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return e.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},e.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},e.prototype.setServiceProps=function(t){return this.serviceProps=t,this},e.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},e})();var Zt="[DEFAULT]";var If=(function(){function e(t,n){this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.onInitCallbacks=new Set}return e.prototype.get=function(t){t===void 0&&(t=Zt);var n=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(n)){var r=new of;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{var i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise},e.prototype.getImmediate=function(t){var n=He({identifier:Zt,optional:!1},t),r=n.identifier,i=n.optional,o=this.normalizeInstanceIdentifier(r);if(this.isInitialized(o)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:o})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error("Service "+this.name+" is not available")}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(t){var n,r;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,!!this.shouldAutoInitialize()){if(_f(t))try{this.getOrInitializeService({instanceIdentifier:Zt})}catch{}try{for(var i=_i(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var s=cr(o.value,2),a=s[0],u=s[1],c=this.normalizeInstanceIdentifier(a);try{var l=this.getOrInitializeService({instanceIdentifier:c});u.resolve(l)}catch{}}}catch(f){n={error:f}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}},e.prototype.clearInstance=function(t){t===void 0&&(t=Zt),this.instancesDeferred.delete(t),this.instances.delete(t)},e.prototype.delete=function(){return g(this,void 0,void 0,function(){var t;return m(this,function(n){switch(n.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(H(H([],cr(t.filter(function(r){return"INTERNAL"in r}).map(function(r){return r.INTERNAL.delete()}))),cr(t.filter(function(r){return"_delete"in r}).map(function(r){return r._delete()}))))];case 1:return n.sent(),[2]}})})},e.prototype.isComponentSet=function(){return this.component!=null},e.prototype.isInitialized=function(t){return t===void 0&&(t=Zt),this.instances.has(t)},e.prototype.initialize=function(t){var n,r;t===void 0&&(t={});var i=t.instanceIdentifier,o=i===void 0?Zt:i,s=t.options,a=s===void 0?{}:s,u=this.normalizeInstanceIdentifier(o);if(this.isInitialized(u))throw Error(this.name+"("+u+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var c=this.getOrInitializeService({instanceIdentifier:u,options:a});try{for(var l=_i(this.instancesDeferred.entries()),f=l.next();!f.done;f=l.next()){var h=cr(f.value,2),p=h[0],d=h[1],v=this.normalizeInstanceIdentifier(p);u===v&&d.resolve(c)}}catch(b){n={error:b}}finally{try{f&&!f.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}return this.invokeOnInitCallbacks(c,u),c},e.prototype.onInit=function(t){var n=this;return this.onInitCallbacks.add(t),function(){n.onInitCallbacks.delete(t)}},e.prototype.invokeOnInitCallbacks=function(t,n){var r,i;try{for(var o=_i(this.onInitCallbacks),s=o.next();!s.done;s=o.next()){var a=s.value;try{a(t,n)}catch{}}}catch(u){r={error:u}}finally{try{s&&!s.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}},e.prototype.getOrInitializeService=function(t){var n=t.instanceIdentifier,r=t.options,i=r===void 0?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:Tf(n),options:i}),this.instances.set(n,o),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch{}return o||null},e.prototype.normalizeInstanceIdentifier=function(t){return this.component?this.component.multipleInstances?t:Zt:t},e.prototype.shouldAutoInitialize=function(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"},e})();function Tf(e){return e===Zt?void 0:e}function _f(e){return e.instantiationMode==="EAGER"}var Sf=(function(){function e(t){this.name=t,this.providers=new Map}return e.prototype.addComponent=function(t){var n=this.getProvider(t.name);if(n.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);n.setComponent(t)},e.prototype.addOrOverwriteComponent=function(t){var n=this.getProvider(t.name);n.isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},e.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var n=new If(t,this);return this.providers.set(t,n),n},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e})();function Pt(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var r=Array(e),i=0,t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var me,vo=[],V;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(V||(V={}));var ru={debug:V.DEBUG,verbose:V.VERBOSE,info:V.INFO,warn:V.WARN,error:V.ERROR,silent:V.SILENT},Af=V.INFO,Nf=(me={},me[V.DEBUG]="log",me[V.VERBOSE]="log",me[V.INFO]="info",me[V.WARN]="warn",me[V.ERROR]="error",me),Df=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(t<e.logLevel)){var i=new Date().toISOString(),o=Nf[t];if(o)console[o].apply(console,Pt(["["+i+"]  "+e.name+":"],n));else throw new Error("Attempted to log a message with an invalid logType (value: "+t+")")}},iu=(function(){function e(t){this.name=t,this._logLevel=Af,this._logHandler=Df,this._userLogHandler=null,vo.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in V))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(t){this._logLevel=typeof t=="string"?ru[t]:t},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Pt([this,V.DEBUG],t)),this._logHandler.apply(this,Pt([this,V.DEBUG],t))},e.prototype.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Pt([this,V.VERBOSE],t)),this._logHandler.apply(this,Pt([this,V.VERBOSE],t))},e.prototype.info=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Pt([this,V.INFO],t)),this._logHandler.apply(this,Pt([this,V.INFO],t))},e.prototype.warn=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Pt([this,V.WARN],t)),this._logHandler.apply(this,Pt([this,V.WARN],t))},e.prototype.error=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,Pt([this,V.ERROR],t)),this._logHandler.apply(this,Pt([this,V.ERROR],t))},e})();function Cf(e){vo.forEach(function(t){t.setLogLevel(e)})}function kf(e,t){for(var n=function(s){var a=null;t&&t.level&&(a=ru[t.level]),e===null?s.userLogHandler=null:s.userLogHandler=function(u,c){for(var l=[],f=2;f<arguments.length;f++)l[f-2]=arguments[f];var h=l.map(function(p){if(p==null)return null;if(typeof p=="string")return p;if(typeof p=="number"||typeof p=="boolean")return p.toString();if(p instanceof Error)return p.message;try{return JSON.stringify(p)}catch{return null}}).filter(function(p){return p}).join(" ");c>=(a??u.logLevel)&&e({level:V[c].toLowerCase(),message:h,args:l,type:u.name})}},r=0,i=vo;r<i.length;r++){var o=i[r];n(o)}}var Yt,Of=(Yt={},Yt["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Yt["bad-app-name"]="Illegal App name: '{$appName}",Yt["duplicate-app"]="Firebase App named '{$appName}' already exists",Yt["app-deleted"]="Firebase App named '{$appName}' already deleted",Yt["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Yt["invalid-log-argument"]="First argument to `onLog` must be null or a function.",Yt),qe=new yo("app","Firebase",Of),ou="@firebase/app",Rf="0.6.21",xf="@firebase/analytics",Pf="@firebase/app-check",Lf="@firebase/auth",Mf="@firebase/database",Ff="@firebase/functions",Vf="@firebase/installations",Uf="@firebase/messaging",qf="@firebase/performance",Bf="@firebase/remote-config",jf="@firebase/storage",Kf="@firebase/firestore",zf="firebase-wrapper";var ot,_r="[DEFAULT]",Gf=(ot={},ot[ou]="fire-core",ot[xf]="fire-analytics",ot[Pf]="fire-app-check",ot[Lf]="fire-auth",ot[Mf]="fire-rtdb",ot[Ff]="fire-fn",ot[Vf]="fire-iid",ot[Uf]="fire-fcm",ot[qf]="fire-perf",ot[Bf]="fire-rc",ot[jf]="fire-gcs",ot[Kf]="fire-fst",ot["fire-js"]="fire-js",ot[zf]="fire-js-all",ot);var Qe=new iu("@firebase/app");var gr=(function(){function e(t,n,r){var i=this;this.firebase_=r,this.isDeleted_=!1,this.name_=n.name,this.automaticDataCollectionEnabled_=n.automaticDataCollectionEnabled||!1,this.options_=nf(t),this.container=new Sf(n.name),this._addComponent(new Yr("app",function(){return i},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(o){return i._addComponent(o)})}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var t=this;return new Promise(function(n){t.checkDestroyed_(),n()}).then(function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map(function(n){return n.delete()}))}).then(function(){t.isDeleted_=!0})},e.prototype._getService=function(t,n){return n===void 0&&(n=_r),this.checkDestroyed_(),this.container.getProvider(t).getImmediate({identifier:n})},e.prototype._removeServiceInstance=function(t,n){n===void 0&&(n=_r),this.container.getProvider(t).clearInstance(n)},e.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(n){Qe.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,n)}},e.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw qe.create("app-deleted",{appName:this.name_})},e})();gr.prototype.name&&gr.prototype.options||gr.prototype.delete||console.log("dc");var $f="8.5.0";function Hf(e){var t={},n=new Map,r={__esModule:!0,initializeApp:s,app:o,registerVersion:c,setLogLevel:Cf,onLog:l,apps:null,SDK_VERSION:$f,INTERNAL:{registerComponent:u,removeApp:i,components:n,useAsService:f}};r.default=r,Object.defineProperty(r,"apps",{get:a});function i(h){delete t[h]}function o(h){if(h=h||_r,!Ps(t,h))throw qe.create("no-app",{appName:h});return t[h]}o.App=e;function s(h,p){if(p===void 0&&(p={}),typeof p!="object"||p===null){var d=p;p={name:d}}var v=p;v.name===void 0&&(v.name=_r);var b=v.name;if(typeof b!="string"||!b)throw qe.create("bad-app-name",{appName:String(b)});if(Ps(t,b))throw qe.create("duplicate-app",{appName:b});var I=new e(h,v,r);return t[b]=I,I}function a(){return Object.keys(t).map(function(h){return t[h]})}function u(h){var p=h.name;if(n.has(p))return Qe.debug("There were multiple attempts to register component "+p+"."),h.type==="PUBLIC"?r[p]:null;if(n.set(p,h),h.type==="PUBLIC"){var d=function(A){if(A===void 0&&(A=o()),typeof A[p]!="function")throw qe.create("invalid-app-argument",{appName:p});return A[p]()};h.serviceProps!==void 0&&Dn(d,h.serviceProps),r[p]=d,e.prototype[p]=function(){for(var A=[],S=0;S<arguments.length;S++)A[S]=arguments[S];var x=this._getService.bind(this,p);return x.apply(this,h.multipleInstances?A:[])}}for(var v=0,b=Object.keys(t);v<b.length;v++){var I=b[v];t[I]._addComponent(h)}return h.type==="PUBLIC"?r[p]:null}function c(h,p,d){var v,b=(v=Gf[h])!==null&&v!==void 0?v:h;d&&(b+="-"+d);var I=b.match(/\s|\//),A=p.match(/\s|\//);if(I||A){var S=['Unable to register library "'+b+'" with version "'+p+'":'];I&&S.push('library name "'+b+'" contains illegal characters (whitespace or "/")'),I&&A&&S.push("and"),A&&S.push('version name "'+p+'" contains illegal characters (whitespace or "/")'),Qe.warn(S.join(" "));return}u(new Yr(b+"-version",function(){return{library:b,version:p}},"VERSION"))}function l(h,p){if(h!==null&&typeof h!="function")throw qe.create("invalid-log-argument");kf(h,p)}function f(h,p){if(p==="serverAuth")return null;var d=p;return d}return r}function su(){var e=Hf(gr);e.INTERNAL=He(He({},e.INTERNAL),{createFirebaseNamespace:su,extendNamespace:t,createSubscribe:wf,ErrorFactory:yo,deepExtend:Dn});function t(n){Dn(e,n)}return e}var mo=su();var Qf=(function(){function e(t){this.container=t}return e.prototype.getPlatformInfoString=function(){var t=this.container.getProviders();return t.map(function(n){if(Wf(n)){var r=n.getImmediate();return r.library+"/"+r.version}else return null}).filter(function(n){return n}).join(" ")},e})();function Wf(e){var t=e.getComponent();return t?.type==="VERSION"}function Yf(e,t){e.INTERNAL.registerComponent(new Yr("platform-logger",function(n){return new Qf(n)},"PRIVATE")),e.registerVersion(ou,Rf,t),e.registerVersion("fire-js","")}if(cf()&&self.firebase!==void 0){Qe.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);var Ls=self.firebase.SDK_VERSION;Ls&&Ls.indexOf("LITE")>=0&&Qe.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}var Xf=mo.initializeApp;mo.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return uf()&&Qe.warn(`
      Warning: This is a browser-targeted Firebase bundle but it appears it is being
      run in a Node environment.  If running in a Node environment, make sure you
      are using the bundle specified by the "main" field in package.json.
      
      If you are using Webpack, you can specify "main" as the first item in
      "resolve.mainFields":
      https://webpack.js.org/configuration/resolve/#resolvemainfields
      
      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"
      as the first item in "mainFields", e.g. ['main', 'module'].
      https://github.com/rollup/@rollup/plugin-node-resolve
      `),Xf.apply(void 0,e)};var Gn=mo;Yf(Gn);var Jf="firebase",Zf="8.5.0";Gn.registerVersion(Jf,Zf,"app");var Ui=function(e,t){return Ui=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,r){n.__proto__=r}||function(n,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n[i]=r[i])},Ui(e,t)};function th(e,t){Ui(e,t);function n(){this.constructor=e}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n)}function au(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var eh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},N,go=go||{},R=eh||self;function Sr(){}function qi(e){var t=typeof e;return t=t!="object"?t:e?Array.isArray(e)?"array":t:"null",t=="array"||t=="object"&&typeof e.length=="number"}function $n(e){var t=typeof e;return t=="object"&&e!=null||t=="function"}function nh(e,t,n){return e.call.apply(e.bind,arguments)}function rh(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),e.apply(t,i)}}return function(){return e.apply(t,arguments)}}function ct(e,t,n){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ct=nh:ct=rh,ct.apply(null,arguments)}function lr(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var r=n.slice();return r.push.apply(r,arguments),e.apply(this,r)}}function Kt(){return Date.now()}function gt(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Kb=function(r,i,o){for(var s=Array(arguments.length-2),a=2;a<arguments.length;a++)s[a-2]=arguments[a];return t.prototype[i].apply(r,s)}}function he(){this.j=this.j,this.i=this.i}var ih=0;he.prototype.j=!1;he.prototype.ja=function(){!this.j&&(this.j=!0,this.G(),ih!=0)};he.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var uu=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if(typeof e=="string")return typeof t!="string"||t.length!=1?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},cu=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i=typeof e=="string"?e.split(""):e,o=0;o<r;o++)o in i&&t.call(n,i[o],o,e)};function oh(e){t:{for(var t=Qh,n=e.length,r=typeof e=="string"?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break t}t=-1}return 0>t?null:typeof e=="string"?e.charAt(t):e[t]}function Ms(e){return Array.prototype.concat.apply([],arguments)}function wo(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Ar(e){return/^[\s\xa0]*$/.test(e)}var Fs=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function dt(e,t){return e.indexOf(t)!=-1}function Ai(e,t){return e<t?-1:e>t?1:0}var yt;t:{var Vs=R.navigator;if(Vs){var Us=Vs.userAgent;if(Us){yt=Us;break t}}yt=""}function bo(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function lu(e){var t={};for(var n in e)t[n]=e[n];return t}var qs="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function fu(e,t){for(var n,r,i=1;i<arguments.length;i++){r=arguments[i];for(n in r)e[n]=r[n];for(var o=0;o<qs.length;o++)n=qs[o],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function Eo(e){return Eo[" "](e),e}Eo[" "]=Sr;function sh(e,t){var n=ch;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}var ah=dt(yt,"Opera"),ue=dt(yt,"Trident")||dt(yt,"MSIE"),hu=dt(yt,"Edge"),Bi=hu||ue,pu=dt(yt,"Gecko")&&!(dt(yt.toLowerCase(),"webkit")&&!dt(yt,"Edge"))&&!(dt(yt,"Trident")||dt(yt,"MSIE"))&&!dt(yt,"Edge"),uh=dt(yt.toLowerCase(),"webkit")&&!dt(yt,"Edge");function du(){var e=R.document;return e?e.documentMode:void 0}var Nr;t:{var Ni="",Di=(function(){var e=yt;if(pu)return/rv:([^\);]+)(\)|;)/.exec(e);if(hu)return/Edge\/([\d\.]+)/.exec(e);if(ue)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e);if(uh)return/WebKit\/(\S+)/.exec(e);if(ah)return/(?:Version)[ \/]?(\S+)/.exec(e)})();if(Di&&(Ni=Di?Di[1]:""),ue){var Ci=du();if(Ci!=null&&Ci>parseFloat(Ni)){Nr=String(Ci);break t}}Nr=Ni}var ch={};function yu(e){return sh(e,function(){for(var t=0,n=Fs(String(Nr)).split("."),r=Fs(String(e)).split("."),i=Math.max(n.length,r.length),o=0;t==0&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s[0].length==0&&a[0].length==0)break;t=Ai(s[1].length==0?0:parseInt(s[1],10),a[1].length==0?0:parseInt(a[1],10))||Ai(s[2].length==0,a[2].length==0)||Ai(s[2],a[2]),s=s[3],a=a[3]}while(t==0)}return 0<=t})}var ji;if(R.document&&ue){var Bs=du();ji=Bs||parseInt(Nr,10)||void 0}else ji=void 0;var vu=ji,Io=!ue||9<=Number(vu),lh=ue&&!yu("9"),fh=(function(){if(!R.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{R.addEventListener("test",Sr,t),R.removeEventListener("test",Sr,t)}catch{}return e})();function lt(e,t){this.type=e,this.a=this.target=t,this.defaultPrevented=!1}lt.prototype.b=function(){this.defaultPrevented=!0};function Cn(e,t){if(lt.call(this,e?e.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.a=t,t=e.relatedTarget){if(pu){t:{try{Eo(t.nodeName);var i=!0;break t}catch{}i=!1}i||(t=null)}}else n=="mouseover"?t=e.fromElement:n=="mouseout"&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=e.clientX!==void 0?e.clientX:e.pageX,this.clientY=e.clientY!==void 0?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=typeof e.pointerType=="string"?e.pointerType:hh[e.pointerType]||"",this.c=e,e.defaultPrevented&&this.b()}}gt(Cn,lt);var hh={2:"touch",3:"pen",4:"mouse"};Cn.prototype.b=function(){Cn.X.b.call(this);var e=this.c;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,lh)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch{}};var Hn="closure_listenable_"+(1e6*Math.random()|0),ph=0;function dh(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ca=i,this.key=++ph,this.Y=this.Z=!1}function Xr(e){e.Y=!0,e.listener=null,e.proxy=null,e.src=null,e.ca=null}function Jr(e){this.src=e,this.a={},this.b=0}Jr.prototype.add=function(e,t,n,r,i){var o=e.toString();e=this.a[o],e||(e=this.a[o]=[],this.b++);var s=zi(e,t,r,i);return-1<s?(t=e[s],n||(t.Z=!1)):(t=new dh(t,this.src,o,!!r,i),t.Z=n,e.push(t)),t};function Ki(e,t){var n=t.type;if(n in e.a){var r=e.a[n],i=uu(r,t),o;(o=0<=i)&&Array.prototype.splice.call(r,i,1),o&&(Xr(t),e.a[n].length==0&&(delete e.a[n],e.b--))}}function zi(e,t,n,r){for(var i=0;i<e.length;++i){var o=e[i];if(!o.Y&&o.listener==t&&o.capture==!!n&&o.ca==r)return i}return-1}var To="closure_lm_"+(1e6*Math.random()|0),ki={};function _o(e,t,n,r,i){if(r&&r.once)return gu(e,t,n,r,i);if(Array.isArray(t)){for(var o=0;o<t.length;o++)_o(e,t[o],n,r,i);return null}return n=No(n),e&&e[Hn]?e.va(t,n,$n(r)?!!r.capture:!!r,i):mu(e,t,n,!1,r,i)}function mu(e,t,n,r,i,o){if(!t)throw Error("Invalid event type");var s=$n(i)?!!i.capture:!!i;if(s&&!Io)return null;var a=Ao(e);if(a||(e[To]=a=new Jr(e)),n=a.add(t,n,r,s,o),n.proxy)return n;if(r=yh(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)fh||(i=s),i===void 0&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(bu(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function yh(){var e=vh,t=Io?function(n){return e.call(t.src,t.listener,n)}:function(n){if(n=e.call(t.src,t.listener,n),!n)return n};return t}function gu(e,t,n,r,i){if(Array.isArray(t)){for(var o=0;o<t.length;o++)gu(e,t[o],n,r,i);return null}return n=No(n),e&&e[Hn]?e.wa(t,n,$n(r)?!!r.capture:!!r,i):mu(e,t,n,!0,r,i)}function wu(e,t,n,r,i){if(Array.isArray(t))for(var o=0;o<t.length;o++)wu(e,t[o],n,r,i);else r=$n(r)?!!r.capture:!!r,n=No(n),e&&e[Hn]?(e=e.c,t=String(t).toString(),t in e.a&&(o=e.a[t],n=zi(o,n,r,i),-1<n&&(Xr(o[n]),Array.prototype.splice.call(o,n,1),o.length==0&&(delete e.a[t],e.b--)))):e&&(e=Ao(e))&&(t=e.a[t.toString()],e=-1,t&&(e=zi(t,n,r,i)),(n=-1<e?t[e]:null)&&So(n))}function So(e){if(typeof e!="number"&&e&&!e.Y){var t=e.src;if(t&&t[Hn])Ki(t.c,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(bu(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Ao(t))?(Ki(n,e),n.b==0&&(n.src=null,t[To]=null)):Xr(e)}}}function bu(e){return e in ki?ki[e]:ki[e]="on"+e}function js(e,t){var n=e.listener,r=e.ca||e.src;return e.Z&&So(e),n.call(r,t)}function vh(e,t){if(e.Y)return!0;if(!Io){if(!t)t:{t=["window","event"];for(var n=R,r=0;r<t.length;r++)if(n=n[t[r]],n==null){t=null;break t}t=n}return t=new Cn(t,this),js(e,t)}return js(e,new Cn(t,this))}function Ao(e){return e=e[To],e instanceof Jr?e:null}var Oi="__closure_events_fn_"+(1e9*Math.random()>>>0);function No(e){return typeof e=="function"?e:(e[Oi]||(e[Oi]=function(t){return e.handleEvent(t)}),e[Oi])}function kt(){he.call(this),this.c=new Jr(this),this.J=this,this.C=null}gt(kt,he);kt.prototype[Hn]=!0;N=kt.prototype;N.addEventListener=function(e,t,n,r){_o(this,e,t,n,r)};N.removeEventListener=function(e,t,n,r){wu(this,e,t,n,r)};function it(e,t){var n,r=e.C;if(r)for(n=[];r;r=r.C)n.push(r);if(e=e.J,r=t.type||t,typeof t=="string")t=new lt(t,e);else if(t instanceof lt)t.target=t.target||e;else{var i=t;t=new lt(r,e),fu(t,i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=t.a=n[o];i=fr(s,r,!0,t)&&i}if(s=t.a=e,i=fr(s,r,!0,t)&&i,i=fr(s,r,!1,t)&&i,n)for(o=0;o<n.length;o++)s=t.a=n[o],i=fr(s,r,!1,t)&&i}N.G=function(){if(kt.X.G.call(this),this.c){var e=this.c,t;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Xr(n[r]);delete e.a[t],e.b--}}this.C=null};N.va=function(e,t,n,r){return this.c.add(String(e),t,!1,n,r)};N.wa=function(e,t,n,r){return this.c.add(String(e),t,!0,n,r)};function fr(e,t,n,r){if(t=e.c.a[String(t)],!t)return!0;t=t.concat();for(var i=!0,o=0;o<t.length;++o){var s=t[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.ca||s.src;s.Z&&Ki(e.c,s),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var Do=R.JSON.stringify;function Eu(){this.b=this.a=null}var Iu=new((function(){function e(t,n){this.c=t,this.f=n,this.b=0,this.a=null}return e.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},e})())(function(){return new Co},function(e){e.reset()});Eu.prototype.add=function(e,t){var n=Iu.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n};function mh(){var e=_u,t=null;return e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null),t}function Co(){this.next=this.b=this.a=null}Co.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null};Co.prototype.reset=function(){this.next=this.b=this.a=null};function gh(e){R.setTimeout(function(){throw e},0)}function Tu(e,t){Gi||wh(),$i||(Gi(),$i=!0),_u.add(e,t)}var Gi;function wh(){var e=R.Promise.resolve(void 0);Gi=function(){e.then(bh)}}var $i=!1,_u=new Eu;function bh(){for(var e;e=mh();){try{e.a.call(e.b)}catch(n){gh(n)}var t=Iu;t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}$i=!1}function Zr(e,t){kt.call(this),this.b=e||1,this.a=t||R,this.f=ct(this.Za,this),this.g=Kt()}gt(Zr,kt);N=Zr.prototype;N.aa=!1;N.M=null;N.Za=function(){if(this.aa){var e=Kt()-this.g;0<e&&e<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-e):(this.M&&(this.a.clearTimeout(this.M),this.M=null),it(this,"tick"),this.aa&&(ko(this),this.start()))}};N.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=Kt())};function ko(e){e.aa=!1,e.M&&(e.a.clearTimeout(e.M),e.M=null)}N.G=function(){Zr.X.G.call(this),ko(this),delete this.a};function Oo(e,t,n){if(typeof e=="function")n&&(e=ct(e,n));else if(e&&typeof e.handleEvent=="function")e=ct(e.handleEvent,e);else throw Error("Invalid listener argument");return 2147483647<Number(t)?-1:R.setTimeout(e,t||0)}function Su(e){e.a=Oo(function(){e.a=null,e.c&&(e.c=!1,Su(e))},e.h);var t=e.b;e.b=null,e.g.apply(null,t)}var Eh=(function(e){th(t,e);function t(n,r){var i=e.call(this)||this;return i.g=n,i.h=r,i.b=null,i.c=!1,i.a=null,i}return t.prototype.f=function(n){this.b=arguments,this.a?this.c=!0:Su(this)},t.prototype.G=function(){e.prototype.G.call(this),this.a&&(R.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},t})(he);function kn(e){he.call(this),this.b=e,this.a={}}gt(kn,he);var Ks=[];function Au(e,t,n,r){Array.isArray(n)||(n&&(Ks[0]=n.toString()),n=Ks);for(var i=0;i<n.length;i++){var o=_o(t,n[i],r||e.handleEvent,!1,e.b||e);if(!o)break;e.a[o.key]=o}}function Nu(e){bo(e.a,function(t,n){this.a.hasOwnProperty(n)&&So(t)},e),e.a={}}kn.prototype.G=function(){kn.X.G.call(this),Nu(this)};kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Ro(){this.a=!0}function Ih(e,t,n,r,i,o){e.info(function(){if(e.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var f=l.split("_");s=2<=f.length&&f[1]=="type"?s+(l+"="+c+"&"):s+(l+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+t+`
`+n+`
`+s})}function Th(e,t,n,r,i,o,s){e.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+t+`
`+n+`
`+o+" "+s})}function Ke(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+Sh(e,n)+(r?" "+r:"")})}function _h(e,t){e.info(function(){return"TIMEOUT: "+t})}Ro.prototype.info=function(){};function Sh(e,t){if(!e.a)return t;if(!t)return null;try{var n=JSON.parse(t);if(n){for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if(o!="noop"&&o!="stop"&&o!="close")for(var s=1;s<i.length;s++)i[s]=""}}}}return Do(n)}catch{return t}}var Oe={},zs=null;function ti(){return zs=zs||new kt}Oe.Fa="serverreachability";function Du(e){lt.call(this,Oe.Fa,e)}gt(Du,lt);function On(e){var t=ti();it(t,new Du(t))}Oe.STAT_EVENT="statevent";function Cu(e,t){lt.call(this,Oe.STAT_EVENT,e),this.stat=t}gt(Cu,lt);function vt(e){var t=ti();it(t,new Cu(t,e))}Oe.Ga="timingevent";function ku(e){lt.call(this,Oe.Ga,e)}gt(ku,lt);function Qn(e,t){if(typeof e!="function")throw Error("Fn must not be null and must be a function");return R.setTimeout(function(){e()},t)}var ei={NO_ERROR:0,$a:1,nb:2,mb:3,hb:4,lb:5,ob:6,Da:7,TIMEOUT:8,rb:9},Ou={};function Ru(){}Ru.prototype.a=null;function Gs(e){var t;return(t=e.a)||(t=e.a={}),t}function xu(){}var Wn={OPEN:"a",eb:"b",Ea:"c",qb:"d"};function xo(){lt.call(this,"d")}gt(xo,lt);function Po(){lt.call(this,"c")}gt(Po,lt);var Pu;function Lu(){}gt(Lu,Ru);Pu=new Lu;function Yn(e,t,n,r){this.g=e,this.c=t,this.f=n,this.S=r||1,this.J=new kn(this),this.P=Ah,e=Bi?125:void 0,this.R=new Zr(e),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}var Ah=45e3,Mu={},Hi={};N=Yn.prototype;N.setTimeout=function(e){this.P=e};function Qi(e,t,n){e.H=1,e.i=ri(Qt(t)),e.j=n,e.I=!0,Fu(e,null)}function Fu(e,t){e.u=Kt(),Xn(e),e.l=Qt(e.i);var n=e.l,r=e.S;Array.isArray(r)||(r=[String(r)]),Ku(n.b,"t",r),e.D=0,e.a=ac(e.g,e.g.C?t:null),0<e.O&&(e.F=new Eh(ct(e.Ca,e,e.a),e.O)),Au(e.J,e.a,"readystatechange",e.Xa),t=e.B?lu(e.B):{},e.j?(e.m||(e.m="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.a.ba(e.l,e.m,e.j,t)):(e.m="GET",e.a.ba(e.l,e.m,null,t)),On(),Ih(e.c,e.m,e.l,e.f,e.S,e.j)}N.Xa=function(e){e=e.target;var t=this.F;t&&oe(e)==3?t.f():this.Ca(e)};N.Ca=function(e){try{if(e==this.a)t:{var t=oe(this.a),n=this.a.ua(),r=this.a.W();if(!(3>t||t==3&&!Bi&&!this.a.$())){this.A||t!=4||n==7||(n==8||0>=r?On(3):On(2)),ni(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=i==200,Th(this.c,this.m,this.l,this.f,this.S,t,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ar(s)){var u=s;break e}}u=null}if(u)Ke(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Wi(this,u);else{this.b=!1,this.h=3,vt(12),Ge(this),Dr(this);break t}}this.I?(Vu(this,t,o),Bi&&this.b&&t==3&&(Au(this.J,this.R,"tick",this.Wa),this.R.start())):(Ke(this.c,this.f,o,null),Wi(this,o)),t==4&&Ge(this),this.b&&!this.A&&(t==4?rc(this.g,this):(this.b=!1,Xn(this)))}else i==400&&0<o.indexOf("Unknown SID")?(this.h=3,vt(12)):(this.h=0,vt(13)),Ge(this),Dr(this)}}}catch{}finally{}};function Vu(e,t,n){for(var r=!0;!e.A&&e.D<n.length;){var i=Nh(e,n);if(i==Hi){t==4&&(e.h=4,vt(14),r=!1),Ke(e.c,e.f,null,"[Incomplete Response]");break}else if(i==Mu){e.h=4,vt(15),Ke(e.c,e.f,n,"[Invalid Chunk]"),r=!1;break}else Ke(e.c,e.f,i,null),Wi(e,i)}t==4&&n.length==0&&(e.h=1,vt(16),r=!1),e.b=e.b&&r,r?0<n.length&&!e.V&&(e.V=!0,t=e.g,t.a==e&&t.U&&!t.F&&(t.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),jo(t),t.F=!0,vt(11))):(Ke(e.c,e.f,n,"[Invalid Chunked Response]"),Ge(e),Dr(e))}N.Wa=function(){if(this.a){var e=oe(this.a),t=this.a.$();this.D<t.length&&(ni(this),Vu(this,e,t),this.b&&e!=4&&Xn(this))}};function Nh(e,t){var n=e.D,r=t.indexOf(`
`,n);return r==-1?Hi:(n=Number(t.substring(n,r)),isNaN(n)?Mu:(r+=1,r+n>t.length?Hi:(t=t.substr(r,n),e.D=r+n,t)))}N.cancel=function(){this.A=!0,Ge(this)};function Xn(e){e.T=Kt()+e.P,Uu(e,e.P)}function Uu(e,t){if(e.o!=null)throw Error("WatchDog timer not null");e.o=Qn(ct(e.Va,e),t)}function ni(e){e.o&&(R.clearTimeout(e.o),e.o=null)}N.Va=function(){this.o=null;var e=Kt();0<=e-this.T?(_h(this.c,this.l),this.H!=2&&(On(),vt(17)),Ge(this),this.h=2,Dr(this)):Uu(this,this.T-e)};function Dr(e){e.g.v==0||e.A||rc(e.g,e)}function Ge(e){ni(e);var t=e.F;t&&typeof t.ja=="function"&&t.ja(),e.F=null,ko(e.R),Nu(e.J),e.a&&(t=e.a,e.a=null,t.abort(),t.ja())}function Wi(e,t){try{var n=e.g;if(n.v!=0&&(n.a==e||Yi(n.b,e))){if(n.I=e.N,!e.C&&Yi(n.b,e)&&n.v==3){try{var r=n.ka.a.parse(t)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){t:if(!n.j){if(n.a)if(n.a.u+3e3<e.u)Rr(n),oi(n);else break t;Bo(n),vt(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&n.o==0&&!n.m&&(n.m=Qn(ct(n.Sa,n),6e3));if(1>=$u(n.b)&&n.ea){try{n.ea()}catch{}n.ea=void 0}}else we(n,11)}else if((e.C||n.a==e)&&Rr(n),!Ar(t))for(t=r=n.ka.a.parse(t),r=0;r<t.length;r++)if(i=t[r],n.P=i[0],i=i[1],n.v==2)if(i[0]=="c"){n.J=i[1],n.ga=i[2];var o=i[3];o!=null&&(n.ha=o,n.c.info("VER="+n.ha));var s=i[4];s!=null&&(n.pa=s,n.c.info("SVER="+n.pa));var a=i[5];if(a!=null&&typeof a=="number"&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=e.a;if(c){var l=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var f=u.b;!f.a&&(dt(l,"spdy")||dt(l,"quic")||dt(l,"h2"))&&(f.f=f.g,f.a=new Set,f.b&&(Fo(f,f.b),f.b=null))}if(u.A){var h=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;h&&(u.na=h,z(u.B,u.A,h))}}n.v=3,n.f&&n.f.ta(),n.U&&(n.N=Kt()-e.u,n.c.info("Handshake RTT: "+n.N+"ms")),u=n;var p=e;if(u.la=sc(u,u.C?u.ga:null,u.fa),p.C){Hu(u.b,p);var d=p,v=u.D;v&&d.setTimeout(v),d.o&&(ni(d),Xn(d)),u.a=p}else ec(u);0<n.g.length&&si(n)}else i[0]!="stop"&&i[0]!="close"||we(n,7);else n.v==3&&(i[0]=="stop"||i[0]=="close"?i[0]=="stop"?we(n,7):qo(n):i[0]!="noop"&&n.f&&n.f.sa(i),n.o=0)}On(4)}catch{}}function Dh(e){if(e.K&&typeof e.K=="function")return e.K();if(typeof e=="string")return e.split("");if(qi(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}t=[],n=0;for(r in e)t[n++]=e[r];return e=t}function Lo(e,t){if(e.forEach&&typeof e.forEach=="function")e.forEach(t,void 0);else if(qi(e)||typeof e=="string")cu(e,t,void 0);else{if(e.L&&typeof e.L=="function")var n=e.L();else if(e.K&&typeof e.K=="function")n=void 0;else if(qi(e)||typeof e=="string"){n=[];for(var r=e.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,e)n[r++]=i;r=Dh(e),i=r.length;for(var o=0;o<i;o++)t.call(void 0,r[o],n&&n[o],e)}}function hn(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof hn)for(n=e.L(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}N=hn.prototype;N.K=function(){Mo(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e};N.L=function(){return Mo(this),this.a.concat()};function Mo(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Ae(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)r=e.a[t],Ae(i,r)||(e.a[n++]=r,i[r]=1),t++;e.a.length=n}}N.get=function(e,t){return Ae(this.b,e)?this.b[e]:t};N.set=function(e,t){Ae(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t};N.forEach=function(e,t){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);e.call(t,o,i,this)}};function Ae(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var qu=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ch(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var o=e[n].substring(0,r);i=e[n].substring(r+1)}else o=e[n];t(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ne(e,t){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,e instanceof Ne){this.a=t!==void 0?t:e.a,Cr(this,e.f),this.j=e.j,kr(this,e.c),Or(this,e.h),this.g=e.g,t=e.b;var n=new Rn;n.c=t.c,t.a&&(n.a=new hn(t.a),n.b=t.b),$s(this,n),this.i=e.i}else e&&(n=String(e).match(qu))?(this.a=!!t,Cr(this,n[1]||"",!0),this.j=Sn(n[2]||""),kr(this,n[3]||"",!0),Or(this,n[4]),this.g=Sn(n[5]||"",!0),$s(this,n[6]||"",!0),this.i=Sn(n[7]||"")):(this.a=!!t,this.b=new Rn(null,this.a))}Ne.prototype.toString=function(){var e=[],t=this.f;t&&e.push(Tn(t,Hs,!0),":");var n=this.c;return(n||t=="file")&&(e.push("//"),(t=this.j)&&e.push(Tn(t,Hs,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n=this.h,n!=null&&e.push(":",String(n))),(n=this.g)&&(this.c&&n.charAt(0)!="/"&&e.push("/"),e.push(Tn(n,n.charAt(0)=="/"?Ph:xh,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.i)&&e.push("#",Tn(n,Mh)),e.join("")};function Qt(e){return new Ne(e)}function Cr(e,t,n){e.f=n?Sn(t,!0):t,e.f&&(e.f=e.f.replace(/:$/,""))}function kr(e,t,n){e.c=n?Sn(t,!0):t}function Or(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.h=t}else e.h=null}function $s(e,t,n){t instanceof Rn?(e.b=t,Fh(e.b,e.a)):(n||(t=Tn(t,Lh)),e.b=new Rn(t,e.a))}function z(e,t,n){e.b.set(t,n)}function ri(e){return z(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Kt()).toString(36)),e}function kh(e){return e instanceof Ne?Qt(e):new Ne(e,void 0)}function Oh(e,t,n,r){var i=new Ne(null,void 0);return e&&Cr(i,e),t&&kr(i,t),n&&Or(i,n),r&&(i.g=r),i}function Sn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Tn(e,t,n){return typeof e=="string"?(e=encodeURI(e).replace(t,Rh),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Rh(e){return e=e.charCodeAt(0),"%"+(e>>4&15).toString(16)+(e&15).toString(16)}var Hs=/[#\/\?@]/g,xh=/[#\?:]/g,Ph=/[#\?]/g,Lh=/[#\?@]/g,Mh=/#/g;function Rn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function pe(e){e.a||(e.a=new hn,e.b=0,e.c&&Ch(e.c,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}N=Rn.prototype;N.add=function(e,t){pe(this),this.c=null,e=pn(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this};function Bu(e,t){pe(e),t=pn(e,t),Ae(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,e=e.a,Ae(e.b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Mo(e)))}function ju(e,t){return pe(e),t=pn(e,t),Ae(e.a.b,t)}N.forEach=function(e,t){pe(this),this.a.forEach(function(n,r){cu(n,function(i){e.call(t,i,r,this)},this)},this)};N.L=function(){pe(this);for(var e=this.a.K(),t=this.a.L(),n=[],r=0;r<t.length;r++)for(var i=e[r],o=0;o<i.length;o++)n.push(t[r]);return n};N.K=function(e){pe(this);var t=[];if(typeof e=="string")ju(this,e)&&(t=Ms(t,this.a.get(pn(this,e))));else{e=this.a.K();for(var n=0;n<e.length;n++)t=Ms(t,e[n])}return t};N.set=function(e,t){return pe(this),this.c=null,e=pn(this,e),ju(this,e)&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this};N.get=function(e,t){return e?(e=this.K(e),0<e.length?String(e[0]):t):t};function Ku(e,t,n){Bu(e,t),0<n.length&&(e.c=null,e.a.set(pn(e,t),wo(n)),e.b+=n.length)}N.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.L(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;r[o]!==""&&(s+="="+encodeURIComponent(String(r[o]))),e.push(s)}}return this.c=e.join("&")};function pn(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}function Fh(e,t){t&&!e.f&&(pe(e),e.c=null,e.a.forEach(function(n,r){var i=r.toLowerCase();r!=i&&(Bu(this,r),Ku(this,i,n))},e)),e.f=t}var Vh=(function(){function e(t,n){this.b=t,this.a=n}return e})();function zu(e){this.g=e||Uh,R.PerformanceNavigationTiming?(e=R.performance.getEntriesByType("navigation"),e=0<e.length&&(e[0].nextHopProtocol=="hq"||e[0].nextHopProtocol=="h2")):e=!!(R.ia&&R.ia.ya&&R.ia.ya()&&R.ia.ya().Lb),this.f=e?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var Uh=10;function Gu(e){return e.b?!0:e.a?e.a.size>=e.f:!1}function $u(e){return e.b?1:e.a?e.a.size:0}function Yi(e,t){return e.b?e.b==t:e.a?e.a.has(t):!1}function Fo(e,t){e.a?e.a.add(t):e.b=t}function Hu(e,t){e.b&&e.b==t?e.b=null:e.a&&e.a.has(t)&&e.a.delete(t)}zu.prototype.cancel=function(){var e,t;if(this.c=Qu(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&this.a.size!==0){try{for(var n=au(this.a.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.cancel()}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}};function Qu(e){var t,n;if(e.b!=null)return e.c.concat(e.b.s);if(e.a!=null&&e.a.size!==0){var r=e.c;try{for(var i=au(e.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.s)}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r}return wo(e.c)}function Vo(){}Vo.prototype.stringify=function(e){return R.JSON.stringify(e,void 0)};Vo.prototype.parse=function(e){return R.JSON.parse(e,void 0)};function qh(){this.a=new Vo}function Bh(e,t,n){var r=n||"";try{Lo(e,function(i,o){var s=i;$n(i)&&(s=Do(i)),t.push(r+o+"="+encodeURIComponent(s))})}catch(i){throw t.push(r+"type="+encodeURIComponent("_badmap")),i}}function jh(e,t){var n=new Ro;if(R.Image){var r=new Image;r.onload=lr(hr,n,r,"TestLoadImage: loaded",!0,t),r.onerror=lr(hr,n,r,"TestLoadImage: error",!1,t),r.onabort=lr(hr,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=lr(hr,n,r,"TestLoadImage: timeout",!1,t),R.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}function hr(e,t,n,r,i){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,i(r)}catch{}}var Kh=R.JSON.parse;function tt(e){kt.call(this),this.headers=new hn,this.H=e||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=zh,this.D=this.F=!1}gt(tt,kt);var zh="",Gh=/^https?$/i,$h=["POST","PUT"];N=tt.prototype;N.ba=function(e,t,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+e);t=t?t.toUpperCase():"GET",this.B=e,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?Gs(this.H):Gs(Pu),this.a.onreadystatechange=ct(this.za,this);try{this.A=!0,this.a.open(t,String(e),!0),this.A=!1}catch(o){Qs(this,o);return}e=n||"";var i=new hn(this.headers);r&&Lo(r,function(o,s){i.set(s,o)}),r=oh(i.L()),n=R.FormData&&e instanceof R.FormData,!(0<=uu($h,t))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(o,s){this.a.setRequestHeader(s,o)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Xu(this),0<this.o&&((this.D=Hh(this.a))?(this.a.timeout=this.o,this.a.ontimeout=ct(this.xa,this)):this.m=Oo(this.xa,this.o,this)),this.l=!0,this.a.send(e),this.l=!1}catch(o){Qs(this,o)}};function Hh(e){return ue&&yu(9)&&typeof e.timeout=="number"&&e.ontimeout!==void 0}function Qh(e){return e.toLowerCase()=="content-type"}N.xa=function(){typeof go<"u"&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,it(this,"timeout"),this.abort(8))};function Qs(e,t){e.b=!1,e.a&&(e.g=!0,e.a.abort(),e.g=!1),e.f=t,e.h=5,Wu(e),ii(e)}function Wu(e){e.u||(e.u=!0,it(e,"complete"),it(e,"error"))}N.abort=function(e){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=e||7,it(this,"complete"),it(this,"abort"),ii(this))};N.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),ii(this,!0)),tt.X.G.call(this)};N.za=function(){this.j||(this.A||this.l||this.g?Yu(this):this.Ua())};N.Ua=function(){Yu(this)};function Yu(e){if(e.b&&typeof go<"u"&&(!e.s[1]||oe(e)!=4||e.W()!=2)){if(e.l&&oe(e)==4)Oo(e.za,0,e);else if(it(e,"readystatechange"),oe(e)==4){e.b=!1;try{{var t=e.W();t:switch(t){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var n=!0;break t;default:n=!1}var r;if(!(r=n)){var i;if(i=t===0){var o=String(e.B).match(qu)[1]||null;if(!o&&R.self&&R.self.location){var s=R.self.location.protocol;o=s.substr(0,s.length-1)}i=!Gh.test(o?o.toLowerCase():"")}r=i}var a=r}if(a)it(e,"complete"),it(e,"success");else{e.h=6;try{var u=2<oe(e)?e.a.statusText:""}catch{u=""}e.f=u+" ["+e.W()+"]",Wu(e)}}finally{ii(e)}}}}function ii(e,t){if(e.a){Xu(e);var n=e.a,r=e.s[0]?Sr:null;e.a=null,e.s=null,t||it(e,"ready");try{n.onreadystatechange=r}catch{}}}function Xu(e){e.a&&e.D&&(e.a.ontimeout=null),e.m&&(R.clearTimeout(e.m),e.m=null)}function oe(e){return e.a?e.a.readyState:0}N.W=function(){try{return 2<oe(this)?this.a.status:-1}catch{return-1}};N.$=function(){try{return this.a?this.a.responseText:""}catch{return""}};N.Pa=function(e){if(this.a){var t=this.a.responseText;return e&&t.indexOf(e)==0&&(t=t.substring(e.length)),Kh(t)}};N.ua=function(){return this.h};N.Qa=function(){return typeof this.f=="string"?this.f:String(this.f)};function Wh(e){var t="";return bo(e,function(n,r){t+=r,t+=":",t+=n,t+=`\r
`}),t}function Uo(e,t,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Wh(n),typeof e=="string"?n!=null&&encodeURIComponent(String(n)):z(e,t,n))}function En(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function Ju(e){this.pa=0,this.g=[],this.c=new Ro,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.V=this.i=this.O=this.l=null,this.Oa=this.R=0,this.La=En("failFast",!1,e),this.H=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.oa=this.P=-1,this.T=this.o=this.u=0,this.Ha=En("baseRetryDelayMs",5e3,e),this.Ra=En("retryDelaySeedMs",1e4,e),this.Ma=En("forwardChannelMaxRetries",2,e),this.ma=En("forwardChannelRequestTimeoutMs",2e4,e),this.Na=e&&e.g||void 0,this.D=void 0,this.C=e&&e.supportsCrossDomainXhr||!1,this.J="",this.b=new zu(e&&e.concurrentRequestLimit),this.ka=new qh,this.da=e&&e.fastHandshake||!1,this.Ia=e&&e.b||!1,e&&e.f&&(this.c.a=!1),e&&e.forceLongPolling&&(this.S=!1),this.U=!this.da&&this.S&&e&&e.detectBufferingProxy||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null,(this.Ka=e&&e.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}N=Ju.prototype;N.ha=8;N.v=1;function qo(e){if(Zu(e),e.v==3){var t=e.R++,n=Qt(e.B);z(n,"SID",e.J),z(n,"RID",t),z(n,"TYPE","terminate"),Jn(e,n),t=new Yn(e,e.c,t,void 0),t.H=2,t.i=ri(Qt(n)),n=!1,R.navigator&&R.navigator.sendBeacon&&(n=R.navigator.sendBeacon(t.i.toString(),"")),!n&&R.Image&&(new Image().src=t.i,n=!0),n||(t.a=ac(t.g,null),t.a.ba(t.i)),t.u=Kt(),Xn(t)}oc(e)}function oi(e){e.a&&(jo(e),e.a.cancel(),e.a=null)}function Zu(e){oi(e),e.j&&(R.clearTimeout(e.j),e.j=null),Rr(e),e.b.cancel(),e.h&&(typeof e.h=="number"&&R.clearTimeout(e.h),e.h=null)}function Ri(e,t){e.g.push(new Vh(e.Oa++,t)),e.v==3&&si(e)}function si(e){Gu(e.b)||e.h||(e.h=!0,Tu(e.Ba,e),e.u=0)}function Yh(e,t){return $u(e.b)>=e.b.f-(e.h?1:0)?!1:e.h?(e.g=t.s.concat(e.g),!0):e.v==1||e.v==2||e.u>=(e.La?0:e.Ma)?!1:(e.h=Qn(ct(e.Ba,e,t),ic(e,e.u)),e.u++,!0)}N.Ba=function(e){if(this.h)if(this.h=null,this.v==1){if(!e){this.R=Math.floor(1e5*Math.random()),e=this.R++;var t=new Yn(this,this.c,e,void 0),n=this.l;this.O&&(n?(n=lu(n),fu(n,this.O)):n=this.O),this.i===null&&(t.B=n);var r;if(this.da)t:{for(var i=r=0;i<this.g.length;i++){e:{var o=this.g[i];if("__data__"in o.a&&(o=o.a.__data__,typeof o=="string")){o=o.length;break e}o=void 0}if(o===void 0)break;if(r+=o,4096<r){r=i;break t}if(r===4096||i===this.g.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=tc(this,t,r),i=Qt(this.B),z(i,"RID",e),z(i,"CVER",22),this.A&&z(i,"X-HTTP-Session-Id",this.A),Jn(this,i),this.i&&n&&Uo(i,this.i,n),Fo(this.b,t),this.Ia&&z(i,"TYPE","init"),this.da?(z(i,"$req",r),z(i,"SID","null"),t.U=!0,Qi(t,i,null)):Qi(t,i,r),this.v=2}}else this.v==3&&(e?Ws(this,e):this.g.length==0||Gu(this.b)||Ws(this))};function Ws(e,t){var n;t?n=t.f:n=e.R++;var r=Qt(e.B);z(r,"SID",e.J),z(r,"RID",n),z(r,"AID",e.P),Jn(e,r),e.i&&e.l&&Uo(r,e.i,e.l),n=new Yn(e,e.c,n,e.u+1),e.i===null&&(n.B=e.l),t&&(e.g=t.s.concat(e.g)),t=tc(e,n,1e3),n.setTimeout(Math.round(.5*e.ma)+Math.round(.5*e.ma*Math.random())),Fo(e.b,n),Qi(n,r,t)}function Jn(e,t){e.f&&Lo({},function(n,r){z(t,r,n)})}function tc(e,t,n){n=Math.min(e.g.length,n);var r=e.f?ct(e.f.Ja,e.f,e):null;t:for(var i=e.g,o=-1;;){var s=["count="+n];o==-1?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,l=i[u].a;if(c-=o,0>c)o=Math.max(0,i[u].b-100),a=!1;else try{Bh(l,s,"req"+c+"_")}catch{r&&r(l)}}if(a){r=s.join("&");break t}}return e=e.g.splice(0,n),t.s=e,r}function ec(e){e.a||e.j||(e.T=1,Tu(e.Aa,e),e.o=0)}function Bo(e){return e.a||e.j||3<=e.o?!1:(e.T++,e.j=Qn(ct(e.Aa,e),ic(e,e.o)),e.o++,!0)}N.Aa=function(){if(this.j=null,nc(this),this.U&&!(this.F||this.a==null||0>=this.N)){var e=2*this.N;this.c.info("BP detection timer enabled: "+e),this.s=Qn(ct(this.Ta,this),e)}};N.Ta=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,vt(10),oi(this),nc(this))};function jo(e){e.s!=null&&(R.clearTimeout(e.s),e.s=null)}function nc(e){e.a=new Yn(e,e.c,"rpc",e.T),e.i===null&&(e.a.B=e.l),e.a.O=0;var t=Qt(e.la);z(t,"RID","rpc"),z(t,"SID",e.J),z(t,"CI",e.H?"0":"1"),z(t,"AID",e.P),Jn(e,t),z(t,"TYPE","xmlhttp"),e.i&&e.l&&Uo(t,e.i,e.l),e.D&&e.a.setTimeout(e.D);var n=e.a;e=e.ga,n.H=1,n.i=ri(Qt(t)),n.j=null,n.I=!0,Fu(n,e)}N.Sa=function(){this.m!=null&&(this.m=null,oi(this),Bo(this),vt(19))};function Rr(e){e.m!=null&&(R.clearTimeout(e.m),e.m=null)}function rc(e,t){var n=null;if(e.a==t){Rr(e),jo(e),e.a=null;var r=2}else if(Yi(e.b,t))n=t.s,Hu(e.b,t),r=1;else return;if(e.I=t.N,e.v!=0){if(t.b)if(r==1){n=t.j?t.j.length:0,t=Kt()-t.u;var i=e.u;r=ti(),it(r,new ku(r)),si(e)}else ec(e);else if(i=t.h,i==3||i==0&&0<e.I||!(r==1&&Yh(e,t)||r==2&&Bo(e)))switch(n&&0<n.length&&(t=e.b,t.c=t.c.concat(n)),i){case 1:we(e,5);break;case 4:we(e,10);break;case 3:we(e,6);break;default:we(e,2)}}}function ic(e,t){var n=e.Ha+Math.floor(Math.random()*e.Ra);return e.f||(n*=2),n*t}function we(e,t){if(e.c.info("Error code "+t),t==2){var n=null;e.f&&(n=null);var r=ct(e.Ya,e);n||(n=new Ne("//www.google.com/images/cleardot.gif"),R.location&&R.location.protocol=="http"||Cr(n,"https"),ri(n)),jh(n.toString(),r)}else vt(2);e.v=0,e.f&&e.f.ra(t),oc(e),Zu(e)}N.Ya=function(e){e?(this.c.info("Successfully pinged google.com"),vt(2)):(this.c.info("Failed to ping google.com"),vt(1))};function oc(e){e.v=0,e.I=-1,e.f&&((Qu(e.b).length!=0||e.g.length!=0)&&(e.b.c.length=0,wo(e.g),e.g.length=0),e.f.qa())}function sc(e,t,n){var r=kh(n);if(r.c!="")t&&kr(r,t+"."+r.c),Or(r,r.h);else{var i=R.location;r=Oh(i.protocol,t?t+"."+i.hostname:i.hostname,+i.port,n)}return e.V&&bo(e.V,function(o,s){z(r,s,o)}),t=e.A,n=e.na,t&&n&&z(r,t,n),z(r,"VER",e.ha),Jn(e,r),r}function ac(e,t){if(t&&!e.C)throw Error("Can't create secondary domain capable XhrIo object.");return t=new tt(e.Na),t.F=e.C,t}function uc(){}N=uc.prototype;N.ta=function(){};N.sa=function(){};N.ra=function(){};N.qa=function(){};N.Ja=function(){};function xr(){if(ue&&!(10<=Number(vu)))throw Error("Environmental error: no available transport.")}xr.prototype.a=function(e,t){return new Ot(e,t)};function Ot(e,t){kt.call(this),this.a=new Ju(t),this.o=e,this.b=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.a.l=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.a&&(e?e["X-WebChannel-Client-Profile"]=t.a:e={"X-WebChannel-Client-Profile":t.a}),this.a.O=e,(e=t&&t.httpHeadersOverwriteParam)&&!Ar(e)&&(this.a.i=e),this.m=t&&t.supportsCrossDomainXhr||!1,this.l=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!Ar(t)&&(this.a.A=t,e=this.b,e!==null&&t in e&&(e=this.b,t in e&&delete e[t])),this.f=new dn(this)}gt(Ot,kt);Ot.prototype.g=function(){this.a.f=this.f,this.m&&(this.a.C=!0);var e=this.a,t=this.o,n=this.b||void 0;vt(0),e.fa=t,e.V=n||{},e.H=e.S,e.B=sc(e,null,e.fa),si(e)};Ot.prototype.close=function(){qo(this.a)};Ot.prototype.h=function(e){if(typeof e=="string"){var t={};t.__data__=e,Ri(this.a,t)}else this.l?(t={},t.__data__=Do(e),Ri(this.a,t)):Ri(this.a,e)};Ot.prototype.G=function(){this.a.f=null,delete this.f,qo(this.a),delete this.a,Ot.X.G.call(this)};function cc(e){xo.call(this);var t=e.__sm__;if(t){t:{for(var n in t){e=n;break t}e=void 0}(this.c=e)?(e=this.c,this.data=t!==null&&e in t?t[e]:void 0):this.data=t}else this.data=e}gt(cc,xo);function lc(){Po.call(this),this.status=1}gt(lc,Po);function dn(e){this.a=e}gt(dn,uc);dn.prototype.ta=function(){it(this.a,"a")};dn.prototype.sa=function(e){it(this.a,new cc(e))};dn.prototype.ra=function(e){it(this.a,new lc)};dn.prototype.qa=function(){it(this.a,"b")};xr.prototype.createWebChannel=xr.prototype.a;Ot.prototype.send=Ot.prototype.h;Ot.prototype.open=Ot.prototype.g;Ot.prototype.close=Ot.prototype.close;ei.NO_ERROR=0;ei.TIMEOUT=8;ei.HTTP_ERROR=6;Ou.COMPLETE="complete";xu.EventType=Wn;Wn.OPEN="a";Wn.CLOSE="b";Wn.ERROR="c";Wn.MESSAGE="d";kt.prototype.listen=kt.prototype.va;tt.prototype.listenOnce=tt.prototype.wa;tt.prototype.getLastError=tt.prototype.Qa;tt.prototype.getLastErrorCode=tt.prototype.ua;tt.prototype.getStatus=tt.prototype.W;tt.prototype.getResponseJson=tt.prototype.Pa;tt.prototype.getResponseText=tt.prototype.$;tt.prototype.send=tt.prototype.ba;var Xh=function(){return new xr},Jh=function(){return ti()},xi=ei,Zh=Ou,tp=Oe,Ys={gb:0,jb:1,kb:2,Db:3,Ib:4,Fb:5,Gb:6,Eb:7,Cb:8,Hb:9,PROXY:10,NOPROXY:11,Ab:12,wb:13,xb:14,vb:15,yb:16,zb:17,bb:18,ab:19,cb:20},pr=xu,ep=tt,np={};var Nt=(function(){function e(t,n){var r=this;this.previousValue=t,n&&(n.sequenceNumberHandler=function(i){return r.t(i)},this.i=function(i){return n.writeSequenceNumber(i)})}return e.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},e.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},e})();Nt.o=-1;var y={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},w=(function(e){function t(n,r){var i=this;return(i=e.call(this,r)||this).code=n,i.message=r,i.name="FirebaseError",i.toString=function(){return i.name+": [code="+i.code+"]: "+i.message},i}return k(t,e),t})(Error),Lt=new iu("@firebase/firestore");function Xi(){return Lt.logLevel}function T(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Lt.logLevel<=V.DEBUG){var r=t.map(Ko);Lt.debug.apply(Lt,H(["Firestore (8.5.0): "+e],r))}}function Y(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Lt.logLevel<=V.ERROR){var r=t.map(Ko);Lt.error.apply(Lt,H(["Firestore (8.5.0): "+e],r))}}function Ji(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Lt.logLevel<=V.WARN){var r=t.map(Ko);Lt.warn.apply(Lt,H(["Firestore (8.5.0): "+e],r))}}function Ko(e){if(typeof e=="string")return e;try{return t=e,JSON.stringify(t)}catch{return e}var t}function D(e){e===void 0&&(e="Unexpected state");var t="FIRESTORE (8.5.0) INTERNAL ASSERTION FAILED: "+e;throw Y(t),new Error(t)}function O(e,t){e||D()}function _(e,t){return e}function rp(e){var t=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var fc=(function(){function e(){}return e.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/t.length)*t.length,r="";r.length<20;)for(var i=rp(40),o=0;o<i.length;++o)r.length<20&&i[o]<n&&(r+=t.charAt(i[o]%t.length));return r},e})();function L(e,t){return e<t?-1:e>t?1:0}function We(e,t,n){return e.length===t.length&&e.every((function(r,i){return n(r,t[i])}))}function hc(e){return e+"\0"}var Et=(function(){function e(t,n){if(this.seconds=t,this.nanoseconds=n,n<0)throw new w(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new w(y.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new w(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new w(y.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return e.now=function(){return e.fromMillis(Date.now())},e.fromDate=function(t){return e.fromMillis(t.getTime())},e.fromMillis=function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))},e.prototype.toDate=function(){return new Date(this.toMillis())},e.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},e.prototype._compareTo=function(t){return this.seconds===t.seconds?L(this.nanoseconds,t.nanoseconds):L(this.seconds,t.seconds)},e.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},e.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},e.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},e.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},e})(),P=(function(){function e(t){this.timestamp=t}return e.fromTimestamp=function(t){return new e(t)},e.min=function(){return new e(new Et(0,0))},e.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},e.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},e.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},e.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},e.prototype.toTimestamp=function(){return this.timestamp},e})();function Xs(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Zn(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function pc(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var dc=(function(){function e(t,n,r){n===void 0?n=0:n>t.length&&D(),r===void 0?r=t.length-n:r>t.length-n&&D(),this.segments=t,this.offset=n,this.len=r}return Object.defineProperty(e.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return e.comparator(this,t)===0},e.prototype.child=function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(r){n.push(r)})):n.push(t),this.construct(n)},e.prototype.limit=function(){return this.offset+this.length},e.prototype.popFirst=function(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)},e.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},e.prototype.firstSegment=function(){return this.segments[this.offset]},e.prototype.lastSegment=function(){return this.get(this.length-1)},e.prototype.get=function(t){return this.segments[this.offset+t]},e.prototype.isEmpty=function(){return this.length===0},e.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var n=0;n<this.length;n++)if(this.get(n)!==t.get(n))return!1;return!0},e.prototype.forEach=function(t){for(var n=this.offset,r=this.limit();n<r;n++)t(this.segments[n])},e.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},e.comparator=function(t,n){for(var r=Math.min(t.length,n.length),i=0;i<r;i++){var o=t.get(i),s=n.get(i);if(o<s)return-1;if(o>s)return 1}return t.length<n.length?-1:t.length>n.length?1:0},e})(),U=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.prototype.canonicalString=function(){return this.toArray().join("/")},t.prototype.toString=function(){return this.canonicalString()},t.fromString=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];for(var i=[],o=0,s=n;o<s.length;o++){var a=s[o];if(a.indexOf("//")>=0)throw new w(y.INVALID_ARGUMENT,"Invalid segment ("+a+"). Paths must not contain // in them.");i.push.apply(i,a.split("/").filter((function(u){return u.length>0})))}return new t(i)},t.emptyPath=function(){return new t([])},t})(dc),ip=/^[_a-zA-Z][_a-zA-Z0-9]*$/,xt=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.construct=function(n,r,i){return new t(n,r,i)},t.isValidIdentifier=function(n){return ip.test(n)},t.prototype.canonicalString=function(){return this.toArray().map((function(n){return n=n.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),t.isValidIdentifier(n)||(n="`"+n+"`"),n})).join(".")},t.prototype.toString=function(){return this.canonicalString()},t.prototype.isKeyField=function(){return this.length===1&&this.get(0)==="__name__"},t.keyField=function(){return new t(["__name__"])},t.fromServerFormat=function(n){for(var r=[],i="",o=0,s=function(){if(i.length===0)throw new w(y.INVALID_ARGUMENT,"Invalid field path ("+n+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");r.push(i),i=""},a=!1;o<n.length;){var u=n[o];if(u==="\\"){if(o+1===n.length)throw new w(y.INVALID_ARGUMENT,"Path has trailing escape character: "+n);var c=n[o+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new w(y.INVALID_ARGUMENT,"Path has invalid escape sequence: "+n);i+=c,o+=2}else u==="`"?(a=!a,o++):u!=="."||a?(i+=u,o++):(s(),o++)}if(s(),a)throw new w(y.INVALID_ARGUMENT,"Unterminated ` in path: "+n);return new t(r)},t.emptyPath=function(){return new t([])},t})(dc),Ye=(function(){function e(t){this.fields=t,t.sort(xt.comparator)}return e.prototype.covers=function(t){for(var n=0,r=this.fields;n<r.length;n++)if(r[n].isPrefixOf(t))return!0;return!1},e.prototype.isEqual=function(t){return We(this.fields,t.fields,(function(n,r){return n.isEqual(r)}))},e})(),It=(function(){function e(t){this.binaryString=t}return e.fromBase64String=function(t){return new e(atob(t))},e.fromUint8Array=function(t){return new e((function(n){for(var r="",i=0;i<n.length;++i)r+=String.fromCharCode(n[i]);return r})(t))},e.prototype.toBase64=function(){return t=this.binaryString,btoa(t);var t},e.prototype.toUint8Array=function(){return(function(t){for(var n=new Uint8Array(t.length),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n})(this.binaryString)},e.prototype.approximateByteSize=function(){return 2*this.binaryString.length},e.prototype.compareTo=function(t){return L(this.binaryString,t.binaryString)},e.prototype.isEqual=function(t){return this.binaryString===t.binaryString},e})();It.EMPTY_BYTE_STRING=new It("");var op=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ce(e){if(O(!!e),typeof e=="string"){var t=0,n=op.exec(e);if(O(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:W(e.seconds),nanos:W(e.nanos)}}function W(e){return typeof e=="number"?e:typeof e=="string"?Number(e):0}function Xe(e){return typeof e=="string"?It.fromBase64String(e):It.fromUint8Array(e)}function zo(e){var t,n;return((n=(((t=e?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function yc(e){var t=e.mapValue.fields.__previous_value__;return zo(t)?yc(t):t}function xn(e){var t=ce(e.mapValue.fields.__local_write_time__.timestampValue);return new Et(t.seconds,t.nanos)}function Re(e){return e==null}function Pr(e){return e===0&&1/e==-1/0}function vc(e){return typeof e=="number"&&Number.isInteger(e)&&!Pr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var C=(function(){function e(t){this.path=t}return e.fromPath=function(t){return new e(U.fromString(t))},e.fromName=function(t){return new e(U.fromString(t).popFirst(5))},e.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},e.prototype.isEqual=function(t){return t!==null&&U.comparator(this.path,t.path)===0},e.prototype.toString=function(){return this.path.toString()},e.comparator=function(t,n){return U.comparator(t.path,n.path)},e.isDocumentKey=function(t){return t.length%2==0},e.fromSegments=function(t){return new e(new U(t.slice()))},e})();function le(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?zo(e)?4:10:D()}function Bt(e,t){var n=le(e);if(n!==le(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return xn(e).isEqual(xn(t));case 3:return(function(r,i){if(typeof r.timestampValue=="string"&&typeof i.timestampValue=="string"&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;var o=ce(r.timestampValue),s=ce(i.timestampValue);return o.seconds===s.seconds&&o.nanos===s.nanos})(e,t);case 5:return e.stringValue===t.stringValue;case 6:return(function(r,i){return Xe(r.bytesValue).isEqual(Xe(i.bytesValue))})(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return(function(r,i){return W(r.geoPointValue.latitude)===W(i.geoPointValue.latitude)&&W(r.geoPointValue.longitude)===W(i.geoPointValue.longitude)})(e,t);case 2:return(function(r,i){if("integerValue"in r&&"integerValue"in i)return W(r.integerValue)===W(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){var o=W(r.doubleValue),s=W(i.doubleValue);return o===s?Pr(o)===Pr(s):isNaN(o)&&isNaN(s)}return!1})(e,t);case 9:return We(e.arrayValue.values||[],t.arrayValue.values||[],Bt);case 10:return(function(r,i){var o=r.mapValue.fields||{},s=i.mapValue.fields||{};if(Xs(o)!==Xs(s))return!1;for(var a in o)if(o.hasOwnProperty(a)&&(s[a]===void 0||!Bt(o[a],s[a])))return!1;return!0})(e,t);default:return D()}}function Pn(e,t){return(e.values||[]).find((function(n){return Bt(n,t)}))!==void 0}function Je(e,t){var n=le(e),r=le(t);if(n!==r)return L(n,r);switch(n){case 0:return 0;case 1:return L(e.booleanValue,t.booleanValue);case 2:return(function(i,o){var s=W(i.integerValue||i.doubleValue),a=W(o.integerValue||o.doubleValue);return s<a?-1:s>a?1:s===a?0:isNaN(s)?isNaN(a)?0:-1:1})(e,t);case 3:return Js(e.timestampValue,t.timestampValue);case 4:return Js(xn(e),xn(t));case 5:return L(e.stringValue,t.stringValue);case 6:return(function(i,o){var s=Xe(i),a=Xe(o);return s.compareTo(a)})(e.bytesValue,t.bytesValue);case 7:return(function(i,o){for(var s=i.split("/"),a=o.split("/"),u=0;u<s.length&&u<a.length;u++){var c=L(s[u],a[u]);if(c!==0)return c}return L(s.length,a.length)})(e.referenceValue,t.referenceValue);case 8:return(function(i,o){var s=L(W(i.latitude),W(o.latitude));return s!==0?s:L(W(i.longitude),W(o.longitude))})(e.geoPointValue,t.geoPointValue);case 9:return(function(i,o){for(var s=i.values||[],a=o.values||[],u=0;u<s.length&&u<a.length;++u){var c=Je(s[u],a[u]);if(c)return c}return L(s.length,a.length)})(e.arrayValue,t.arrayValue);case 10:return(function(i,o){var s=i.fields||{},a=Object.keys(s),u=o.fields||{},c=Object.keys(u);a.sort(),c.sort();for(var l=0;l<a.length&&l<c.length;++l){var f=L(a[l],c[l]);if(f!==0)return f;var h=Je(s[a[l]],u[c[l]]);if(h!==0)return h}return L(a.length,c.length)})(e.mapValue,t.mapValue);default:throw D()}}function Js(e,t){if(typeof e=="string"&&typeof t=="string"&&e.length===t.length)return L(e,t);var n=ce(e),r=ce(t),i=L(n.seconds,r.seconds);return i!==0?i:L(n.nanos,r.nanos)}function Go(e){return Zi(e)}function Zi(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(function(r){var i=ce(r);return"time("+i.seconds+","+i.nanos+")"})(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Xe(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,C.fromName(n).toString()):"geoPointValue"in e?"geo("+(t=e.geoPointValue).latitude+","+t.longitude+")":"arrayValue"in e?(function(r){for(var i="[",o=!0,s=0,a=r.values||[];s<a.length;s++)o?o=!1:i+=",",i+=Zi(a[s]);return i+"]"})(e.arrayValue):"mapValue"in e?(function(r){for(var i="{",o=!0,s=0,a=Object.keys(r.fields||{}).sort();s<a.length;s++){var u=a[s];o?o=!1:i+=",",i+=u+":"+Zi(r.fields[u])}return i+"}"})(e.mapValue):D();var t,n}function Lr(e,t){return{referenceValue:"projects/"+e.projectId+"/databases/"+e.database+"/documents/"+t.path.canonicalString()}}function to(e){return!!e&&"integerValue"in e}function $o(e){return!!e&&"arrayValue"in e}function Zs(e){return!!e&&"nullValue"in e}function ta(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function eo(e){return!!e&&"mapValue"in e}var At=(function(){function e(t){this.overlayMap=new Map,this.partialValue=t}return e.empty=function(){return new e({mapValue:{}})},e.prototype.field=function(t){return e.extractNestedValue(this.buildProto(),t)},e.prototype.toProto=function(){return this.field(xt.emptyPath())},e.prototype.set=function(t,n){this.setOverlay(t,n)},e.prototype.setAll=function(t){var n=this;t.forEach((function(r,i){r?n.set(i,r):n.delete(i)}))},e.prototype.delete=function(t){this.setOverlay(t,null)},e.prototype.isEqual=function(t){return Bt(this.buildProto(),t.buildProto())},e.prototype.setOverlay=function(t,n){for(var r=this.overlayMap,i=0;i<t.length-1;++i){var o=t.get(i),s=r.get(o);s instanceof Map?r=s:s&&le(s)===10?(s=new Map(Object.entries(s.mapValue.fields||{})),r.set(o,s),r=s):(s=new Map,r.set(o,s),r=s)}r.set(t.lastSegment(),n)},e.prototype.applyOverlay=function(t,n){var r=this,i=!1,o=e.extractNestedValue(this.partialValue,t),s=eo(o)?Object.assign({},o.mapValue.fields):{};return n.forEach((function(a,u){if(a instanceof Map){var c=r.applyOverlay(t.child(u),a);c!=null&&(s[u]=c,i=!0)}else a!==null?(s[u]=a,i=!0):s.hasOwnProperty(u)&&(delete s[u],i=!0)})),i?{mapValue:{fields:s}}:null},e.prototype.buildProto=function(){var t=this.applyOverlay(xt.emptyPath(),this.overlayMap);return t!=null&&(this.partialValue=t,this.overlayMap.clear()),this.partialValue},e.extractNestedValue=function(t,n){if(n.isEmpty())return t;for(var r=t,i=0;i<n.length-1;++i)if(!r.mapValue.fields||!eo(r=r.mapValue.fields[n.get(i)]))return null;return(r=(r.mapValue.fields||{})[n.lastSegment()])||null},e.prototype.clone=function(){return new e(this.buildProto())},e})();function mc(e){var t=[];return Zn(e.fields||{},(function(n,r){var i=new xt([n]);if(eo(r)){var o=mc(r.mapValue).fields;if(o.length===0)t.push(i);else for(var s=0,a=o;s<a.length;s++){var u=a[s];t.push(i.child(u))}}else t.push(i)})),new Ye(t)}var ft=(function(){function e(t,n,r,i,o){this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=o}return e.newInvalidDocument=function(t){return new e(t,0,P.min(),At.empty(),0)},e.newFoundDocument=function(t,n,r){return new e(t,1,n,r,0)},e.newNoDocument=function(t,n){return new e(t,2,n,At.empty(),0)},e.newUnknownDocument=function(t,n){return new e(t,3,n,At.empty(),2)},e.prototype.convertToFoundDocument=function(t,n){return this.version=t,this.documentType=1,this.data=n,this.documentState=0,this},e.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=At.empty(),this.documentState=0,this},e.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=At.empty(),this.documentState=2,this},e.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},e.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(e.prototype,"hasLocalMutations",{get:function(){return this.documentState===1},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCommittedMutations",{get:function(){return this.documentState===2},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),e.prototype.isValidDocument=function(){return this.documentType!==0},e.prototype.isFoundDocument=function(){return this.documentType===1},e.prototype.isNoDocument=function(){return this.documentType===2},e.prototype.isUnknownDocument=function(){return this.documentType===3},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)},e.prototype.clone=function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.toProto())+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},e})(),sp=function(e,t,n,r,i,o,s){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function ea(e,t,n,r,i,o,s){return t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o=null),s===void 0&&(s=null),new sp(e,t,n,r,i,o,s)}function tr(e){var t=_(e);if(t.h===null){var n=t.path.canonicalString();t.collectionGroup!==null&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(r){return(function(i){return i.field.canonicalString()+i.op.toString()+Go(i.value)})(r)})).join(","),n+="|ob:",n+=t.orderBy.map((function(r){return(function(i){return i.field.canonicalString()+i.dir})(r)})).join(","),Re(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=Fr(t.startAt)),t.endAt&&(n+="|ub:",n+=Fr(t.endAt)),t.h=n}return t.h}function ai(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!dp(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],o=t.filters[r],i.op!==o.op||!i.field.isEqual(o.field)||!Bt(i.value,o.value))return!1;var i,o;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ra(e.startAt,t.startAt)&&ra(e.endAt,t.endAt)}function Mr(e){return C.isDocumentKey(e.path)&&e.collectionGroup===null&&e.filters.length===0}var Dt=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).field=n,o.op=r,o.value=i,o}return k(t,e),t.create=function(n,r,i){return n.isKeyField()?r==="in"||r==="not-in"?this.l(n,r,i):new ap(n,r,i):r==="array-contains"?new lp(n,i):r==="in"?new fp(n,i):r==="not-in"?new hp(n,i):r==="array-contains-any"?new pp(n,i):new t(n,r,i)},t.l=function(n,r,i){return r==="in"?new up(n,i):new cp(n,i)},t.prototype.matches=function(n){var r=n.data.field(this.field);return this.op==="!="?r!==null&&this.m(Je(r,this.value)):r!==null&&le(this.value)===le(r)&&this.m(Je(r,this.value))},t.prototype.m=function(n){switch(this.op){case"<":return n<0;case"<=":return n<=0;case"==":return n===0;case"!=":return n!==0;case">":return n>0;case">=":return n>=0;default:return D()}},t.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},t})((function(){})),ap=(function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,i)||this).key=C.fromName(i.referenceValue),o}return k(t,e),t.prototype.matches=function(n){var r=C.comparator(n.key,this.key);return this.m(r)},t})(Dt),up=(function(e){function t(n,r){var i=this;return(i=e.call(this,n,"in",r)||this).keys=gc("in",r),i}return k(t,e),t.prototype.matches=function(n){return this.keys.some((function(r){return r.isEqual(n.key)}))},t})(Dt),cp=(function(e){function t(n,r){var i=this;return(i=e.call(this,n,"not-in",r)||this).keys=gc("not-in",r),i}return k(t,e),t.prototype.matches=function(n){return!this.keys.some((function(r){return r.isEqual(n.key)}))},t})(Dt);function gc(e,t){var n;return(((n=t.arrayValue)===null||n===void 0?void 0:n.values)||[]).map((function(r){return C.fromName(r.referenceValue)}))}var lp=(function(e){function t(n,r){return e.call(this,n,"array-contains",r)||this}return k(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return $o(r)&&Pn(r.arrayValue,this.value)},t})(Dt),fp=(function(e){function t(n,r){return e.call(this,n,"in",r)||this}return k(t,e),t.prototype.matches=function(n){var r=n.data.field(this.field);return r!==null&&Pn(this.value.arrayValue,r)},t})(Dt),hp=(function(e){function t(n,r){return e.call(this,n,"not-in",r)||this}return k(t,e),t.prototype.matches=function(n){if(Pn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var r=n.data.field(this.field);return r!==null&&!Pn(this.value.arrayValue,r)},t})(Dt),pp=(function(e){function t(n,r){return e.call(this,n,"array-contains-any",r)||this}return k(t,e),t.prototype.matches=function(n){var r=this,i=n.data.field(this.field);return!(!$o(i)||!i.arrayValue.values)&&i.arrayValue.values.some((function(o){return Pn(r.value.arrayValue,o)}))},t})(Dt),Ln=function(e,t){this.position=e,this.before=t};function Fr(e){return(e.before?"b":"a")+":"+e.position.map((function(t){return Go(t)})).join(",")}var $e=function(e,t){t===void 0&&(t="asc"),this.field=e,this.dir=t};function dp(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function na(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var o=t[i],s=e.position[i];if(r=o.field.isKeyField()?C.comparator(C.fromName(s.referenceValue),n.key):Je(s,n.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return e.before?r<=0:r<0}function ra(e,t){if(e===null)return t===null;if(t===null||e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Bt(e.position[n],t.position[n]))return!1;return!0}var Wt=(function(e,t,n,r,i,o,s,a){t===void 0&&(t=null),n===void 0&&(n=[]),r===void 0&&(r=[]),i===void 0&&(i=null),o===void 0&&(o="F"),s===void 0&&(s=null),a===void 0&&(a=null),this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null,this.startAt,this.endAt});function wc(e,t,n,r,i,o,s,a){return new Wt(e,t,n,r,i,o,s,a)}function er(e){return new Wt(e)}function wr(e){return!Re(e.limit)&&e.limitType==="F"}function Vr(e){return!Re(e.limit)&&e.limitType==="L"}function Ho(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function Qo(e){for(var t=0,n=e.filters;t<n.length;t++){var r=n[t];if(r.g())return r.field}return null}function Wo(e){return e.collectionGroup!==null}function Ze(e){var t=_(e);if(t.p===null){t.p=[];var n=Qo(t),r=Ho(t);if(n!==null&&r===null)n.isKeyField()||t.p.push(new $e(n)),t.p.push(new $e(xt.keyField(),"asc"));else{for(var i=!1,o=0,s=t.explicitOrderBy;o<s.length;o++){var a=s[o];t.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.p.push(new $e(xt.keyField(),u))}}}return t.p}function jt(e){var t=_(e);if(!t.T)if(t.limitType==="F")t.T=ea(t.path,t.collectionGroup,Ze(t),t.filters,t.limit,t.startAt,t.endAt);else{for(var n=[],r=0,i=Ze(t);r<i.length;r++){var o=i[r],s=o.dir==="desc"?"asc":"desc";n.push(new $e(o.field,s))}var a=t.endAt?new Ln(t.endAt.position,!t.endAt.before):null,u=t.startAt?new Ln(t.startAt.position,!t.startAt.before):null;t.T=ea(t.path,t.collectionGroup,n,t.filters,t.limit,a,u)}return t.T}function bc(e,t,n){return new Wt(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function nr(e,t){return ai(jt(e),jt(t))&&e.limitType===t.limitType}function Ec(e){return tr(jt(e))+"|lt:"+e.limitType}function no(e){return"Query(target="+(function(t){var n=t.path.canonicalString();return t.collectionGroup!==null&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=", filters: ["+t.filters.map((function(r){return(i=r).field.canonicalString()+" "+i.op+" "+Go(i.value);var i})).join(", ")+"]"),Re(t.limit)||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=", orderBy: ["+t.orderBy.map((function(r){return(function(i){return i.field.canonicalString()+" ("+i.dir+")"})(r)})).join(", ")+"]"),t.startAt&&(n+=", startAt: "+Fr(t.startAt)),t.endAt&&(n+=", endAt: "+Fr(t.endAt)),"Target("+n+")"})(jt(e))+"; limitType="+e.limitType+")"}function rr(e,t){return t.isFoundDocument()&&(function(n,r){var i=r.key.path;return n.collectionGroup!==null?r.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(i):C.isDocumentKey(n.path)?n.path.isEqual(i):n.path.isImmediateParentOf(i)})(e,t)&&(function(n,r){for(var i=0,o=n.explicitOrderBy;i<o.length;i++){var s=o[i];if(!s.field.isKeyField()&&r.data.field(s.field)===null)return!1}return!0})(e,t)&&(function(n,r){for(var i=0,o=n.filters;i<o.length;i++)if(!o[i].matches(r))return!1;return!0})(e,t)&&(function(n,r){return!(n.startAt&&!na(n.startAt,Ze(n),r))&&(!n.endAt||!na(n.endAt,Ze(n),r))})(e,t)}function Ic(e){return function(t,n){for(var r=!1,i=0,o=Ze(e);i<o.length;i++){var s=o[i],a=yp(s,t,n);if(a!==0)return a;r=r||s.field.isKeyField()}return 0}}function yp(e,t,n){var r=e.field.isKeyField()?C.comparator(t.key,n.key):(function(i,o,s){var a=o.data.field(i),u=s.data.field(i);return a!==null&&u!==null?Je(a,u):D()})(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return D()}}function Tc(e,t){if(e.I){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(t)?"-0":t}}function _c(e){return{integerValue:""+e}}function Sc(e,t){return vc(t)?_c(t):Tc(e,t)}var ui=function(){this._=void 0};function vp(e,t,n){return e instanceof tn?(function(r,i){var o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(o.fields.__previous_value__=i),{mapValue:o}})(n,t):e instanceof De?Nc(e,t):e instanceof Ce?Dc(e,t):(function(r,i){var o=Ac(r,i),s=ia(o)+ia(r.A);return to(o)&&to(r.A)?_c(s):Tc(r.R,s)})(e,t)}function mp(e,t,n){return e instanceof De?Nc(e,t):e instanceof Ce?Dc(e,t):n}function Ac(e,t){return e instanceof en?to(n=t)||(function(r){return!!r&&"doubleValue"in r})(n)?t:{integerValue:0}:null;var n}var tn=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t})(ui),De=(function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return k(t,e),t})(ui);function Nc(e,t){for(var n=Cc(t),r=function(s){n.some((function(a){return Bt(a,s)}))||n.push(s)},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ce=(function(e){function t(n){var r=this;return(r=e.call(this)||this).elements=n,r}return k(t,e),t})(ui);function Dc(e,t){for(var n=Cc(t),r=function(s){n=n.filter((function(a){return!Bt(a,s)}))},i=0,o=e.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var en=(function(e){function t(n,r){var i=this;return(i=e.call(this)||this).R=n,i.A=r,i}return k(t,e),t})(ui);function ia(e){return W(e.integerValue||e.doubleValue)}function Cc(e){return $o(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var ir=function(e,t){this.field=e,this.transform=t},gp=function(e,t){this.version=e,this.transformResults=t},ut=(function(){function e(t,n){this.updateTime=t,this.exists=n}return e.none=function(){return new e},e.exists=function(t){return new e(void 0,t)},e.updateTime=function(t){return new e(t)},Object.defineProperty(e.prototype,"isNone",{get:function(){return this.updateTime===void 0&&this.exists===void 0},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},e})();function br(e,t){return e.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(e.updateTime):e.exists===void 0||e.exists===t.isFoundDocument()}var ci=function(){};function wp(e,t,n){e instanceof or?(function(r,i,o){var s=r.value.clone(),a=aa(r.fieldTransforms,i,o.transformResults);s.setAll(a),i.convertToFoundDocument(o.version,s).setHasCommittedMutations()})(e,t,n):e instanceof de?(function(r,i,o){if(br(r.precondition,i)){var s=aa(r.fieldTransforms,i,o.transformResults),a=i.data;a.setAll(kc(r)),a.setAll(s),i.convertToFoundDocument(o.version,a).setHasCommittedMutations()}else i.convertToUnknownDocument(o.version)})(e,t,n):(function(r,i,o){i.convertToNoDocument(o.version).setHasCommittedMutations()})(0,t,n)}function ro(e,t,n){e instanceof or?(function(r,i,o){if(br(r.precondition,i)){var s=r.value.clone(),a=ua(r.fieldTransforms,o,i);s.setAll(a),i.convertToFoundDocument(sa(i),s).setHasLocalMutations()}})(e,t,n):e instanceof de?(function(r,i,o){if(br(r.precondition,i)){var s=ua(r.fieldTransforms,o,i),a=i.data;a.setAll(kc(r)),a.setAll(s),i.convertToFoundDocument(sa(i),a).setHasLocalMutations()}})(e,t,n):(function(r,i){br(r.precondition,i)&&i.convertToNoDocument(P.min())})(e,t)}function bp(e,t){for(var n=null,r=0,i=e.fieldTransforms;r<i.length;r++){var o=i[r],s=t.data.field(o.field),a=Ac(o.transform,s||null);a!=null&&(n==null&&(n=At.empty()),n.set(o.field,a))}return n||null}function oa(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!(function(n,r){return n===void 0&&r===void 0||!(!n||!r)&&We(n,r,(function(i,o){return(function(s,a){return s.field.isEqual(a.field)&&(function(u,c){return u instanceof De&&c instanceof De||u instanceof Ce&&c instanceof Ce?We(u.elements,c.elements,Bt):u instanceof en&&c instanceof en?Bt(u.A,c.A):u instanceof tn&&c instanceof tn})(s.transform,a.transform)})(i,o)}))})(e.fieldTransforms,t.fieldTransforms)&&(e.type===0?e.value.isEqual(t.value):e.type!==1||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function sa(e){return e.isFoundDocument()?e.version:P.min()}var or=(function(e){function t(n,r,i,o){o===void 0&&(o=[]);var s=this;return(s=e.call(this)||this).key=n,s.value=r,s.precondition=i,s.fieldTransforms=o,s.type=0,s}return k(t,e),t})(ci),de=(function(e){function t(n,r,i,o,s){s===void 0&&(s=[]);var a=this;return(a=e.call(this)||this).key=n,a.data=r,a.fieldMask=i,a.precondition=o,a.fieldTransforms=s,a.type=1,a}return k(t,e),t})(ci);function kc(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function aa(e,t,n){var r=new Map;O(e.length===n.length);for(var i=0;i<n.length;i++){var o=e[i],s=o.transform,a=t.data.field(o.field);r.set(o.field,mp(s,a,n[i]))}return r}function ua(e,t,n){for(var r=new Map,i=0,o=e;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,vp(a,u,t))}return r}var Q,F,sr=(function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return k(t,e),t})(ci),Yo=(function(e){function t(n,r){var i=this;return(i=e.call(this)||this).key=n,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return k(t,e),t})(ci),Ep=(function(e){this.count=e});function Oc(e){switch(e){case y.OK:return D();case y.CANCELLED:case y.UNKNOWN:case y.DEADLINE_EXCEEDED:case y.RESOURCE_EXHAUSTED:case y.INTERNAL:case y.UNAVAILABLE:case y.UNAUTHENTICATED:return!1;case y.INVALID_ARGUMENT:case y.NOT_FOUND:case y.ALREADY_EXISTS:case y.PERMISSION_DENIED:case y.FAILED_PRECONDITION:case y.ABORTED:case y.OUT_OF_RANGE:case y.UNIMPLEMENTED:case y.DATA_LOSS:return!0;default:return D()}}function Rc(e){if(e===void 0)return Y("GRPC error has no .code"),y.UNKNOWN;switch(e){case Q.OK:return y.OK;case Q.CANCELLED:return y.CANCELLED;case Q.UNKNOWN:return y.UNKNOWN;case Q.DEADLINE_EXCEEDED:return y.DEADLINE_EXCEEDED;case Q.RESOURCE_EXHAUSTED:return y.RESOURCE_EXHAUSTED;case Q.INTERNAL:return y.INTERNAL;case Q.UNAVAILABLE:return y.UNAVAILABLE;case Q.UNAUTHENTICATED:return y.UNAUTHENTICATED;case Q.INVALID_ARGUMENT:return y.INVALID_ARGUMENT;case Q.NOT_FOUND:return y.NOT_FOUND;case Q.ALREADY_EXISTS:return y.ALREADY_EXISTS;case Q.PERMISSION_DENIED:return y.PERMISSION_DENIED;case Q.FAILED_PRECONDITION:return y.FAILED_PRECONDITION;case Q.ABORTED:return y.ABORTED;case Q.OUT_OF_RANGE:return y.OUT_OF_RANGE;case Q.UNIMPLEMENTED:return y.UNIMPLEMENTED;case Q.DATA_LOSS:return y.DATA_LOSS;default:return D()}}(F=Q||(Q={}))[F.OK=0]="OK",F[F.CANCELLED=1]="CANCELLED",F[F.UNKNOWN=2]="UNKNOWN",F[F.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",F[F.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",F[F.NOT_FOUND=5]="NOT_FOUND",F[F.ALREADY_EXISTS=6]="ALREADY_EXISTS",F[F.PERMISSION_DENIED=7]="PERMISSION_DENIED",F[F.UNAUTHENTICATED=16]="UNAUTHENTICATED",F[F.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",F[F.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",F[F.ABORTED=10]="ABORTED",F[F.OUT_OF_RANGE=11]="OUT_OF_RANGE",F[F.UNIMPLEMENTED=12]="UNIMPLEMENTED",F[F.INTERNAL=13]="INTERNAL",F[F.UNAVAILABLE=14]="UNAVAILABLE",F[F.DATA_LOSS=15]="DATA_LOSS";var ht=(function(){function e(t,n){this.comparator=t,this.root=n||ee.EMPTY}return e.prototype.insert=function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,ee.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ee.BLACK,null,null))},e.prototype.get=function(t){for(var n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null},e.prototype.indexOf=function(t){for(var n=0,r=this.root;!r.isEmpty();){var i=this.comparator(t,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1},e.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(e.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),e.prototype.minKey=function(){return this.root.minKey()},e.prototype.maxKey=function(){return this.root.maxKey()},e.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},e.prototype.forEach=function(t){this.inorderTraversal((function(n,r){return t(n,r),!1}))},e.prototype.toString=function(){var t=[];return this.inorderTraversal((function(n,r){return t.push(n+":"+r),!1})),"{"+t.join(", ")+"}"},e.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},e.prototype.getIterator=function(){return new dr(this.root,null,this.comparator,!1)},e.prototype.getIteratorFrom=function(t){return new dr(this.root,t,this.comparator,!1)},e.prototype.getReverseIterator=function(){return new dr(this.root,null,this.comparator,!0)},e.prototype.getReverseIteratorFrom=function(t){return new dr(this.root,t,this.comparator,!0)},e})(),dr=(function(){function e(t,n,r,i){this.isReverse=i,this.nodeStack=[];for(var o=1;!t.isEmpty();)if(o=n?r(t.key,n):1,i&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return e.prototype.getNext=function(){var t=this.nodeStack.pop(),n={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return n},e.prototype.hasNext=function(){return this.nodeStack.length>0},e.prototype.peek=function(){if(this.nodeStack.length===0)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},e})(),ee=(function(){function e(t,n,r,i,o){this.key=t,this.value=n,this.color=r??e.RED,this.left=i??e.EMPTY,this.right=o??e.EMPTY,this.size=this.left.size+1+this.right.size}return e.prototype.copy=function(t,n,r,i,o){return new e(t??this.key,n??this.value,r??this.color,i??this.left,o??this.right)},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},e.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},e.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},e.prototype.minKey=function(){return this.min().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(t,n,r){var i=this,o=r(t,i.key);return(i=o<0?i.copy(null,null,null,i.left.insert(t,n,r),null):o===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(t,n,r))).fixUp()},e.prototype.removeMin=function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()},e.prototype.remove=function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(t,i.key)===0){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()},e.prototype.isRed=function(){return this.color},e.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},e.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},e.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},e.prototype.rotateLeft=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,n)},e.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},e.prototype.check=function(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw D();var t=this.left.check();if(t!==this.right.check())throw D();return t+(this.isRed()?0:1)},e})();ee.EMPTY=null,ee.RED=!0,ee.BLACK=!1,ee.EMPTY=new((function(){function e(){this.size=0}return Object.defineProperty(e.prototype,"key",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){throw D()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){throw D()},enumerable:!1,configurable:!0}),e.prototype.copy=function(t,n,r,i,o){return this},e.prototype.insert=function(t,n,r){return new ee(t,n)},e.prototype.remove=function(t,n){return this},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(t){return!1},e.prototype.reverseTraversal=function(t){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.isRed=function(){return!1},e.prototype.checkMaxDepth=function(){return!0},e.prototype.check=function(){return 0},e})());var Z=(function(){function e(t){this.comparator=t,this.data=new ht(this.comparator)}return e.prototype.has=function(t){return this.data.get(t)!==null},e.prototype.first=function(){return this.data.minKey()},e.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(e.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),e.prototype.indexOf=function(t){return this.data.indexOf(t)},e.prototype.forEach=function(t){this.data.inorderTraversal((function(n,r){return t(n),!1}))},e.prototype.forEachInRange=function(t,n){for(var r=this.data.getIteratorFrom(t[0]);r.hasNext();){var i=r.getNext();if(this.comparator(i.key,t[1])>=0)return;n(i.key)}},e.prototype.forEachWhile=function(t,n){var r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return},e.prototype.firstAfterOrEqual=function(t){var n=this.data.getIteratorFrom(t);return n.hasNext()?n.getNext().key:null},e.prototype.getIterator=function(){return new ca(this.data.getIterator())},e.prototype.getIteratorFrom=function(t){return new ca(this.data.getIteratorFrom(t))},e.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},e.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},e.prototype.isEmpty=function(){return this.data.isEmpty()},e.prototype.unionWith=function(t){var n=this;return n.size<t.size&&(n=t,t=this),t.forEach((function(r){n=n.add(r)})),n},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(this.comparator(i,o)!==0)return!1}return!0},e.prototype.toArray=function(){var t=[];return this.forEach((function(n){t.push(n)})),t},e.prototype.toString=function(){var t=[];return this.forEach((function(n){return t.push(n)})),"SortedSet("+t.toString()+")"},e.prototype.copy=function(t){var n=new e(this.comparator);return n.data=t,n},e})(),ca=(function(){function e(t){this.iter=t}return e.prototype.getNext=function(){return this.iter.getNext().key},e.prototype.hasNext=function(){return this.iter.hasNext()},e})(),Ip=new ht(C.comparator);function Mt(){return Ip}var Tp=new ht(C.comparator);function io(){return Tp}var _p=new ht(C.comparator);function Sp(){return _p}var Ap=new Z(C.comparator);function j(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=Ap,r=0,i=e;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Np=new Z(L);function li(){return Np}var Xo=(function(){function e(t,n,r,i,o){this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=o}return e.createSynthesizedRemoteEventForCurrentChange=function(t,n){var r=new Map;return r.set(t,Jo.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(P.min(),r,li(),Mt(),j())},e})(),Jo=(function(){function e(t,n,r,i,o){this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=o}return e.createSynthesizedTargetChangeForCurrentChange=function(t,n){return new e(It.EMPTY_BYTE_STRING,n,j(),j(),j())},e})(),Er=function(e,t,n,r){this.v=e,this.removedTargetIds=t,this.key=n,this.P=r},xc=function(e,t){this.targetId=e,this.V=t},Pc=function(e,t,n,r){n===void 0&&(n=It.EMPTY_BYTE_STRING),r===void 0&&(r=null),this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r},la=(function(){function e(){this.S=0,this.D=ha(),this.C=It.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(e.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"k",{get:function(){return this.S!==0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"O",{get:function(){return this.F},enumerable:!1,configurable:!0}),e.prototype.$=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},e.prototype.M=function(){var t=j(),n=j(),r=j();return this.D.forEach((function(i,o){switch(o){case 0:t=t.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:D()}})),new Jo(this.C,this.N,t,n,r)},e.prototype.L=function(){this.F=!1,this.D=ha()},e.prototype.B=function(t,n){this.F=!0,this.D=this.D.insert(t,n)},e.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},e.prototype.U=function(){this.S+=1},e.prototype.K=function(){this.S-=1},e.prototype.j=function(){this.F=!0,this.N=!0},e})(),Dp=(function(){function e(t){this.W=t,this.G=new Map,this.H=Mt(),this.J=fa(),this.Y=new Z(L)}return e.prototype.X=function(t){for(var n=0,r=t.v;n<r.length;n++){var i=r[n];t.P&&t.P.isFoundDocument()?this.Z(i,t.P):this.tt(i,t.key,t.P)}for(var o=0,s=t.removedTargetIds;o<s.length;o++)i=s[o],this.tt(i,t.key,t.P)},e.prototype.et=function(t){var n=this;this.forEachTarget(t,(function(r){var i=n.nt(r);switch(t.state){case 0:n.st(r)&&i.$(t.resumeToken);break;case 1:i.K(),i.k||i.L(),i.$(t.resumeToken);break;case 2:i.K(),i.k||n.removeTarget(r);break;case 3:n.st(r)&&(i.j(),i.$(t.resumeToken));break;case 4:n.st(r)&&(n.it(r),i.$(t.resumeToken));break;default:D()}}))},e.prototype.forEachTarget=function(t,n){var r=this;t.targetIds.length>0?t.targetIds.forEach(n):this.G.forEach((function(i,o){r.st(o)&&n(o)}))},e.prototype.rt=function(t){var n=t.targetId,r=t.V.count,i=this.ot(n);if(i){var o=i.target;if(Mr(o))if(r===0){var s=new C(o.path);this.tt(n,s,ft.newNoDocument(s,P.min()))}else O(r===1);else this.ct(n)!==r&&(this.it(n),this.Y=this.Y.add(n))}},e.prototype.ut=function(t){var n=this,r=new Map;this.G.forEach((function(s,a){var u=n.ot(a);if(u){if(s.current&&Mr(u.target)){var c=new C(u.target.path);n.H.get(c)!==null||n.at(a,c)||n.tt(a,c,ft.newNoDocument(c,t))}s.O&&(r.set(a,s.M()),s.L())}}));var i=j();this.J.forEach((function(s,a){var u=!0;a.forEachWhile((function(c){var l=n.ot(c);return!l||l.purpose===2||(u=!1,!1)})),u&&(i=i.add(s))}));var o=new Xo(t,r,this.Y,this.H,i);return this.H=Mt(),this.J=fa(),this.Y=new Z(L),o},e.prototype.Z=function(t,n){if(this.st(t)){var r=this.at(t,n.key)?2:0;this.nt(t).B(n.key,r),this.H=this.H.insert(n.key,n),this.J=this.J.insert(n.key,this.ht(n.key).add(t))}},e.prototype.tt=function(t,n,r){if(this.st(t)){var i=this.nt(t);this.at(t,n)?i.B(n,1):i.q(n),this.J=this.J.insert(n,this.ht(n).delete(t)),r&&(this.H=this.H.insert(n,r))}},e.prototype.removeTarget=function(t){this.G.delete(t)},e.prototype.ct=function(t){var n=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+n.addedDocuments.size-n.removedDocuments.size},e.prototype.U=function(t){this.nt(t).U()},e.prototype.nt=function(t){var n=this.G.get(t);return n||(n=new la,this.G.set(t,n)),n},e.prototype.ht=function(t){var n=this.J.get(t);return n||(n=new Z(L),this.J=this.J.insert(t,n)),n},e.prototype.st=function(t){var n=this.ot(t)!==null;return n||T("WatchChangeAggregator","Detected inactive target",t),n},e.prototype.ot=function(t){var n=this.G.get(t);return n&&n.k?null:this.W.lt(t)},e.prototype.it=function(t){var n=this;this.G.set(t,new la),this.W.getRemoteKeysForTarget(t).forEach((function(r){n.tt(t,r,null)}))},e.prototype.at=function(t,n){return this.W.getRemoteKeysForTarget(t).has(n)},e})();function fa(){return new ht(C.comparator)}function ha(){return new ht(C.comparator)}var Cp={asc:"ASCENDING",desc:"DESCENDING"},kp={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Op=function(e,t){this.databaseId=e,this.I=t};function Mn(e,t){return e.I?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}}function Lc(e,t){return e.I?t.toBase64():t.toUint8Array()}function Rp(e,t){return Mn(e,t.toTimestamp())}function mt(e){return O(!!e),P.fromTimestamp((function(t){var n=ce(t);return new Et(n.seconds,n.nanos)})(e))}function Zo(e,t){return(function(n){return new U(["projects",n.projectId,"databases",n.database])})(e).child("documents").child(t).canonicalString()}function Mc(e){var t=U.fromString(e);return O(Kc(t)),t}function Fn(e,t){return Zo(e.databaseId,t.path)}function Gt(e,t){var n=Mc(t);if(n.get(1)!==e.databaseId.projectId)throw new w(y.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new w(y.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new C(Vc(n))}function oo(e,t){return Zo(e.databaseId,t)}function Fc(e){var t=Mc(e);return t.length===4?U.emptyPath():Vc(t)}function Vn(e){return new U(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Vc(e){return O(e.length>4&&e.get(4)==="documents"),e.popFirst(5)}function pa(e,t,n){return{name:Fn(e,t),fields:n.toProto().mapValue.fields}}function xp(e,t,n){var r=Gt(e,t.name),i=mt(t.updateTime),o=new At({mapValue:{fields:t.fields}}),s=ft.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Ur(e,t){var n;if(t instanceof or)n={update:pa(e,t.key,t.value)};else if(t instanceof sr)n={delete:Fn(e,t.key)};else if(t instanceof de)n={update:pa(e,t.key,t.data),updateMask:Vp(t.fieldMask)};else{if(!(t instanceof Yo))return D();n={verify:Fn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(r){return(function(i,o){var s=o.transform;if(s instanceof tn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(s instanceof De)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:s.elements}};if(s instanceof Ce)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:s.elements}};if(s instanceof en)return{fieldPath:o.field.canonicalString(),increment:s.A};throw D()})(0,r)}))),t.precondition.isNone||(n.currentDocument=(function(r,i){return i.updateTime!==void 0?{updateTime:Rp(r,i.updateTime)}:i.exists!==void 0?{exists:i.exists}:D()})(e,t.precondition)),n}function da(e,t){var n=t.currentDocument?(function(c){return c.updateTime!==void 0?ut.updateTime(mt(c.updateTime)):c.exists!==void 0?ut.exists(c.exists):ut.none()})(t.currentDocument):ut.none(),r=t.updateTransforms?t.updateTransforms.map((function(c){return(function(l,f){var h=null;if("setToServerValue"in f)O(f.setToServerValue==="REQUEST_TIME"),h=new tn;else if("appendMissingElements"in f){var p=f.appendMissingElements.values||[];h=new De(p)}else if("removeAllFromArray"in f){var d=f.removeAllFromArray.values||[];h=new Ce(d)}else"increment"in f?h=new en(l,f.increment):D();var v=xt.fromServerFormat(f.fieldPath);return new ir(v,h)})(e,c)})):[];if(t.update){t.update.name;var i=Gt(e,t.update.name),o=new At({mapValue:{fields:t.update.fields}});if(t.updateMask){var s=(function(c){var l=c.fieldPaths||[];return new Ye(l.map((function(f){return xt.fromServerFormat(f)})))})(t.updateMask);return new de(i,o,s,n,r)}return new or(i,o,n,r)}if(t.delete){var a=Gt(e,t.delete);return new sr(a,n)}if(t.verify){var u=Gt(e,t.verify);return new Yo(u,n)}return D()}function Uc(e,t){return{documents:[oo(e,t.path)]}}function qc(e,t){var n={structuredQuery:{}},r=t.path;t.collectionGroup!==null?(n.parent=oo(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=oo(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=(function(a){if(a.length!==0){var u=a.map((function(c){return(function(l){if(l.op==="=="){if(ta(l.value))return{unaryFilter:{field:Ve(l.field),op:"IS_NAN"}};if(Zs(l.value))return{unaryFilter:{field:Ve(l.field),op:"IS_NULL"}}}else if(l.op==="!="){if(ta(l.value))return{unaryFilter:{field:Ve(l.field),op:"IS_NOT_NAN"}};if(Zs(l.value))return{unaryFilter:{field:Ve(l.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ve(l.field),op:Lp(l.op),value:l.value}}})(c)}));return u.length===1?u[0]:{compositeFilter:{op:"AND",filters:u}}}})(t.filters);i&&(n.structuredQuery.where=i);var o=(function(a){if(a.length!==0)return a.map((function(u){return(function(c){return{field:Ve(c.field),direction:Pp(c.dir)}})(u)}))})(t.orderBy);o&&(n.structuredQuery.orderBy=o);var s=(function(a,u){return a.I||Re(u)?u:{value:u}})(e,t.limit);return s!==null&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt=ya(t.startAt)),t.endAt&&(n.structuredQuery.endAt=ya(t.endAt)),n}function Bc(e){var t=Fc(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){O(r===1);var o=n.from[0];o.allDescendants?i=o.collectionId:t=t.child(o.collectionId)}var s=[];n.where&&(s=jc(n.where));var a=[];n.orderBy&&(a=n.orderBy.map((function(f){return(function(h){return new $e(ze(h.field),(function(p){switch(p){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(h.direction))})(f)})));var u=null;n.limit&&(u=(function(f){var h;return Re(h=typeof f=="object"?f.value:f)?null:h})(n.limit));var c=null;n.startAt&&(c=va(n.startAt));var l=null;return n.endAt&&(l=va(n.endAt)),wc(t,i,a,s,u,"F",c,l)}function jc(e){return e?e.unaryFilter!==void 0?[Fp(e)]:e.fieldFilter!==void 0?[Mp(e)]:e.compositeFilter!==void 0?e.compositeFilter.filters.map((function(t){return jc(t)})).reduce((function(t,n){return t.concat(n)})):D():[]}function ya(e){return{before:e.before,values:e.position}}function va(e){var t=!!e.before,n=e.values||[];return new Ln(n,t)}function Pp(e){return Cp[e]}function Lp(e){return kp[e]}function Ve(e){return{fieldPath:e.canonicalString()}}function ze(e){return xt.fromServerFormat(e.fieldPath)}function Mp(e){return Dt.create(ze(e.fieldFilter.field),(function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return D()}})(e.fieldFilter.op),e.fieldFilter.value)}function Fp(e){switch(e.unaryFilter.op){case"IS_NAN":var t=ze(e.unaryFilter.field);return Dt.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=ze(e.unaryFilter.field);return Dt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ze(e.unaryFilter.field);return Dt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ze(e.unaryFilter.field);return Dt.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return D()}}function Vp(e){var t=[];return e.fields.forEach((function(n){return t.push(n.canonicalString())})),{fieldPaths:t}}function Kc(e){return e.length>=4&&e.get(0)==="projects"&&e.get(2)==="databases"}function Ft(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=ma(t)),t=Up(e.get(n),t);return ma(t)}function Up(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var o=e.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function ma(e){return e+""}function zt(e){var t=e.length;if(O(t>=2),t===2)return O(e.charAt(0)===""&&e.charAt(1)===""),U.emptyPath();for(var n=t-2,r=[],i="",o=0;o<t;){var s=e.indexOf("",o);switch((s<0||s>n)&&D(),e.charAt(s+1)){case"":var a=e.substring(o,s),u=void 0;i.length===0?u=a:(u=i+=a,i=""),r.push(u);break;case"":i+=e.substring(o,s),i+="\0";break;case"":i+=e.substring(o,s+1);break;default:D()}o=s+2}return new U(r)}var qp=function(e,t){this.seconds=e,this.nanoseconds=t},_t=function(e,t,n){this.ownerId=e,this.allowTabSynchronization=t,this.leaseTimestampMs=n};_t.store="owner",_t.key="owner";var se=function(e,t,n){this.userId=e,this.lastAcknowledgedBatchId=t,this.lastStreamToken=n};se.store="mutationQueues",se.keyPath="userId";var K=function(e,t,n,r,i){this.userId=e,this.batchId=t,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};K.store="mutations",K.keyPath="batchId",K.userMutationsIndex="userMutationsIndex",K.userMutationsKeyPath=["userId","batchId"];var st=(function(){function e(){}return e.prefixForUser=function(t){return[t]},e.prefixForPath=function(t,n){return[t,Ft(n)]},e.key=function(t,n,r){return[t,Ft(n),r]},e})();st.store="documentMutations",st.PLACEHOLDER=new st;var Bp=function(e,t){this.path=e,this.readTime=t},jp=function(e,t){this.path=e,this.version=t},$=(function(e,t,n,r,i,o){this.unknownDocument=e,this.noDocument=t,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o});$.store="remoteDocuments",$.readTimeIndex="readTimeIndex",$.readTimeIndexPath="readTime",$.collectionReadTimeIndex="collectionReadTimeIndex",$.collectionReadTimeIndexPath=["parentPath","readTime"];var Ut=(function(e){this.byteSize=e});Ut.store="remoteDocumentGlobal",Ut.key="remoteDocumentGlobalKey";var bt=function(e,t,n,r,i,o,s){this.targetId=e,this.canonicalId=t,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};bt.store="targets",bt.keyPath="targetId",bt.queryTargetsIndexName="queryTargetsIndex",bt.queryTargetsKeyPath=["canonicalId","targetId"];var rt=function(e,t,n){this.targetId=e,this.path=t,this.sequenceNumber=n};rt.store="targetDocuments",rt.keyPath=["targetId","path"],rt.documentTargetsIndex="documentTargetsIndex",rt.documentTargetsKeyPath=["path","targetId"];var St=function(e,t,n,r){this.highestTargetId=e,this.highestListenSequenceNumber=t,this.lastRemoteSnapshotVersion=n,this.targetCount=r};St.key="targetGlobalKey",St.store="targetGlobal";var Ie=function(e,t){this.collectionId=e,this.parent=t};Ie.store="collectionParents",Ie.keyPath=["collectionId","parent"];var $t=function(e,t,n,r){this.clientId=e,this.updateTimeMs=t,this.networkEnabled=n,this.inForeground=r};$t.store="clientMetadata",$t.keyPath="clientId";var nn=function(e,t,n){this.bundleId=e,this.createTime=t,this.version=n};nn.store="bundles",nn.keyPath="bundleId";var rn=function(e,t,n){this.name=e,this.readTime=t,this.bundledQuery=n};rn.store="namedQueries",rn.keyPath="name";var Kp=H(H([],H(H([],H(H([],H(H([],[se.store,K.store,st.store,$.store,bt.store,_t.store,St.store,rt.store]),[$t.store])),[Ut.store])),[Ie.store])),[nn.store,rn.store]),zc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Gc=(function(){function e(){this.onCommittedListeners=[]}return e.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},e.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach((function(t){return t()}))},e})(),Rt=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))},E=(function(){function e(t){var n=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(r){n.isDone=!0,n.result=r,n.nextCallback&&n.nextCallback(r)}),(function(r){n.isDone=!0,n.error=r,n.catchCallback&&n.catchCallback(r)}))}return e.prototype.catch=function(t){return this.next(void 0,t)},e.prototype.next=function(t,n){var r=this;return this.callbackAttached&&D(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(i,o){r.nextCallback=function(s){r.wrapSuccess(t,s).next(i,o)},r.catchCallback=function(s){r.wrapFailure(n,s).next(i,o)}}))},e.prototype.toPromise=function(){var t=this;return new Promise((function(n,r){t.next(n,r)}))},e.prototype.wrapUserFunction=function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(r){return e.reject(r)}},e.prototype.wrapSuccess=function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)},e.prototype.wrapFailure=function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)},e.resolve=function(t){return new e((function(n,r){n(t)}))},e.reject=function(t){return new e((function(n,r){r(t)}))},e.waitFor=function(t){return new e((function(n,r){var i=0,o=0,s=!1;t.forEach((function(a){++i,a.next((function(){++o,s&&o===i&&n()}),(function(u){return r(u)}))})),s=!0,o===i&&n()}))},e.or=function(t){for(var n=e.resolve(!1),r=function(s){n=n.next((function(a){return a?e.resolve(a):s()}))},i=0,o=t;i<o.length;i++)r(o[i]);return n},e.forEach=function(t,n){var r=this,i=[];return t.forEach((function(o,s){i.push(n.call(r,o,s))})),this.waitFor(i)},e})(),$c=(function(){function e(t,n){var r=this;this.action=t,this.transaction=n,this.aborted=!1,this.ft=new Rt,this.transaction.oncomplete=function(){r.ft.resolve()},this.transaction.onabort=function(){n.error?r.ft.reject(new An(t,n.error)):r.ft.resolve()},this.transaction.onerror=function(i){var o=ts(i.target.error);r.ft.reject(new An(t,o))}}return e.open=function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(o){throw new An(n,o)}},Object.defineProperty(e.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),e.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(T("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},e.prototype.store=function(t){var n=this.transaction.objectStore(t);return new Gp(n)},e})(),on=(function(){function e(t,n,r){this.name=t,this.version=n,this.wt=r,e._t(Se())===12.2&&Y("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return e.delete=function(t){return T("SimpleDb","Removing database:",t),ge(window.indexedDB.deleteDatabase(t)).toPromise()},e.yt=function(){if(typeof indexedDB>"u")return!1;if(e.gt())return!0;var t=Se(),n=e._t(t),r=0<n&&n<10,i=e.Et(t),o=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||o)},e.gt=function(){var t;return typeof process<"u"&&((t=np)===null||t===void 0?void 0:t.Tt)==="YES"},e.It=function(t,n){return t.store(n)},e._t=function(t){var n=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)},e.Et=function(t){var n=t.match(/Android ([\d.]+)/i),r=n?n[1].split(".").slice(0,2).join("."):"-1";return Number(r)},e.prototype.At=function(t){return g(this,void 0,void 0,(function(){var n,r=this;return m(this,(function(i){switch(i.label){case 0:return this.db?[3,2]:(T("SimpleDb","Opening database:",this.name),n=this,[4,new Promise((function(o,s){var a=indexedDB.open(r.name,r.version);a.onsuccess=function(u){var c=u.target.result;o(c)},a.onblocked=function(){s(new An(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(u){var c=u.target.error;c.name==="VersionError"?s(new w(y.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):s(new An(t,c))},a.onupgradeneeded=function(u){T("SimpleDb",'Database "'+r.name+'" requires upgrade from version:',u.oldVersion);var c=u.target.result;r.wt.Rt(c,a.transaction,u.oldVersion,r.version).next((function(){T("SimpleDb","Database upgrade to version "+r.version+" complete")}))}}))]);case 1:n.db=i.sent(),i.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(o){return r.bt(o)}),this.db)]}}))}))},e.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(n){return t(n)})},e.prototype.runTransaction=function(t,n,r,i){return g(this,void 0,void 0,(function(){var o,s,a,u,c;return m(this,(function(l){switch(l.label){case 0:o=n==="readonly",s=0,a=function(){var f,h,p,d,v;return m(this,(function(b){switch(b.label){case 0:++s,b.label=1;case 1:return b.trys.push([1,4,,5]),[4,u.At(t)];case 2:return u.db=b.sent(),f=$c.open(u.db,t,o?"readonly":"readwrite",r),h=i(f).catch((function(I){return f.abort(I),E.reject(I)})).toPromise(),p={},h.catch((function(){})),[4,f.dt];case 3:return[2,(p.value=(b.sent(),h),p)];case 4:return d=b.sent(),v=d.name!=="FirebaseError"&&s<3,T("SimpleDb","Transaction failed with error:",d.message,"Retrying:",v),u.close(),v?[3,5]:[2,{value:Promise.reject(d)}];case 5:return[2]}}))},u=this,l.label=1;case 1:return[5,a()];case 2:if(typeof(c=l.sent())=="object")return[2,c.value];l.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},e})(),zp=(function(){function e(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(e.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),e.prototype.done=function(){this.Vt=!0},e.prototype.Ct=function(t){this.St=t},e.prototype.delete=function(){return ge(this.Pt.delete())},e})(),An=(function(e){function t(n,r){var i=this;return(i=e.call(this,y.UNAVAILABLE,"IndexedDB transaction '"+n+"' failed: "+r)||this).name="IndexedDbTransactionError",i}return k(t,e),t})(w);function xe(e){return e.name==="IndexedDbTransactionError"}var Gp=(function(){function e(t){this.store=t}return e.prototype.put=function(t,n){var r;return n!==void 0?(T("SimpleDb","PUT",this.store.name,t,n),r=this.store.put(n,t)):(T("SimpleDb","PUT",this.store.name,"<auto-key>",t),r=this.store.put(t)),ge(r)},e.prototype.add=function(t){return T("SimpleDb","ADD",this.store.name,t,t),ge(this.store.add(t))},e.prototype.get=function(t){var n=this;return ge(this.store.get(t)).next((function(r){return r===void 0&&(r=null),T("SimpleDb","GET",n.store.name,t,r),r}))},e.prototype.delete=function(t){return T("SimpleDb","DELETE",this.store.name,t),ge(this.store.delete(t))},e.prototype.count=function(){return T("SimpleDb","COUNT",this.store.name),ge(this.store.count())},e.prototype.Nt=function(t,n){var r=this.cursor(this.options(t,n)),i=[];return this.xt(r,(function(o,s){i.push(s)})).next((function(){return i}))},e.prototype.Ft=function(t,n){T("SimpleDb","DELETE ALL",this.store.name);var r=this.options(t,n);r.kt=!1;var i=this.cursor(r);return this.xt(i,(function(o,s,a){return a.delete()}))},e.prototype.Ot=function(t,n){var r;n?r=t:(r={},n=t);var i=this.cursor(r);return this.xt(i,n)},e.prototype.$t=function(t){var n=this.cursor({});return new E((function(r,i){n.onerror=function(o){var s=ts(o.target.error);i(s)},n.onsuccess=function(o){var s=o.target.result;s?t(s.primaryKey,s.value).next((function(a){a?s.continue():r()})):r()}}))},e.prototype.xt=function(t,n){var r=[];return new E((function(i,o){t.onerror=function(s){o(s.target.error)},t.onsuccess=function(s){var a=s.target.result;if(a){var u=new zp(a),c=n(a.primaryKey,a.value,u);if(c instanceof E){var l=c.catch((function(f){return u.done(),E.reject(f)}));r.push(l)}u.isDone?i():u.Dt===null?a.continue():a.continue(u.Dt)}else i()}})).next((function(){return E.waitFor(r)}))},e.prototype.options=function(t,n){var r;return t!==void 0&&(typeof t=="string"?r=t:n=t),{index:r,range:n}},e.prototype.cursor=function(t){var n="next";if(t.reverse&&(n="prev"),t.index){var r=this.store.index(t.index);return t.kt?r.openKeyCursor(t.range,n):r.openCursor(t.range,n)}return this.store.openCursor(t.range,n)},e})();function ge(e){return new E((function(t,n){e.onsuccess=function(r){var i=r.target.result;t(i)},e.onerror=function(r){var i=ts(r.target.error);n(i)}}))}var ga=!1;function ts(e){var t=on._t(Se());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new w("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return ga||(ga=!0,setTimeout((function(){throw r}),0)),r}}return e}var wa=(function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Mt=n,i.currentSequenceNumber=r,i}return k(t,e),t})(Gc);function Tt(e,t){var n=_(e);return on.It(n.Mt,t)}var es=(function(){function e(t,n,r,i){this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return e.prototype.applyToRemoteDocument=function(t,n){for(var r=n.mutationResults,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t.key)&&wp(o,t,r[i])}},e.prototype.applyToLocalView=function(t){for(var n=0,r=this.baseMutations;n<r.length;n++)(s=r[n]).key.isEqual(t.key)&&ro(s,t,this.localWriteTime);for(var i=0,o=this.mutations;i<o.length;i++){var s;(s=o[i]).key.isEqual(t.key)&&ro(s,t,this.localWriteTime)}},e.prototype.applyToLocalDocumentSet=function(t){var n=this;this.mutations.forEach((function(r){var i=t.get(r.key),o=i;n.applyToLocalView(o),i.isValidDocument()||o.convertToNoDocument(P.min())}))},e.prototype.keys=function(){return this.mutations.reduce((function(t,n){return t.add(n.key)}),j())},e.prototype.isEqual=function(t){return this.batchId===t.batchId&&We(this.mutations,t.mutations,(function(n,r){return oa(n,r)}))&&We(this.baseMutations,t.baseMutations,(function(n,r){return oa(n,r)}))},e})(),$p=(function(){function e(t,n,r,i){this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return e.from=function(t,n,r){O(t.mutations.length===r.length);for(var i=Sp(),o=t.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new e(t,n,r,i)},e})(),fi=(function(){function e(t,n,r,i,o,s,a){o===void 0&&(o=P.min()),s===void 0&&(s=P.min()),a===void 0&&(a=It.EMPTY_BYTE_STRING),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=a}return e.prototype.withSequenceNumber=function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},e.prototype.withResumeToken=function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)},e.prototype.withLastLimboFreeSnapshotVersion=function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)},e})(),Hc=function(e){this.Lt=e};function so(e,t){if(t.document)return xp(e.Lt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=C.fromSegments(t.noDocument.path),r=an(t.noDocument.readTime),i=ft.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var o=C.fromSegments(t.unknownDocument.path);return r=an(t.unknownDocument.version),ft.newUnknownDocument(o,r)}return D()}function ba(e,t,n){var r=ns(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var o=(function(f,h){return{name:Fn(f,h.key),fields:h.data.toProto().mapValue.fields,updateTime:Mn(f,h.version.toTimestamp())}})(e.Lt,t),s=t.hasCommittedMutations;return new $(null,null,o,s,r,i)}if(t.isNoDocument()){var a=t.key.path.toArray(),u=sn(t.version);return s=t.hasCommittedMutations,new $(null,new Bp(a,u),null,s,r,i)}if(t.isUnknownDocument()){var c=t.key.path.toArray(),l=sn(t.version);return new $(new jp(c,l),null,null,!0,r,i)}return D()}function ns(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Qc(e){var t=new Et(e[0],e[1]);return P.fromTimestamp(t)}function sn(e){var t=e.toTimestamp();return new qp(t.seconds,t.nanoseconds)}function an(e){var t=new Et(e.seconds,e.nanoseconds);return P.fromTimestamp(t)}function Be(e,t){for(var n=(t.baseMutations||[]).map((function(u){return da(e.Lt,u)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&t.mutations[r+1].transform!==void 0){var o=t.mutations[r+1];i.updateTransforms=o.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var s=t.mutations.map((function(u){return da(e.Lt,u)})),a=Et.fromMillis(t.localWriteTimeMs);return new es(t.batchId,a,n,s)}function _n(e){var t,n,r=an(e.readTime),i=e.lastLimboFreeSnapshotVersion!==void 0?an(e.lastLimboFreeSnapshotVersion):P.min();return e.query.documents!==void 0?(O((n=e.query).documents.length===1),t=jt(er(Fc(n.documents[0])))):t=(function(o){return jt(Bc(o))})(e.query),new fi(t,e.targetId,0,e.lastListenSequenceNumber,r,i,It.fromBase64String(e.resumeToken))}function Wc(e,t){var n,r=sn(t.snapshotVersion),i=sn(t.lastLimboFreeSnapshotVersion);n=Mr(t.target)?Uc(e.Lt,t.target):qc(e.Lt,t.target);var o=t.resumeToken.toBase64();return new bt(t.targetId,tr(t.target),r,o,t.sequenceNumber,i,n)}function Yc(e){var t=Bc({parent:e.parent,structuredQuery:e.structuredQuery});return e.limitType==="LAST"?bc(t,t.limit,"L"):t}var Hp=(function(){function e(){}return e.prototype.getBundleMetadata=function(t,n){return Ea(t).get(n).next((function(r){if(r)return{id:(i=r).bundleId,createTime:an(i.createTime),version:i.version};var i}))},e.prototype.saveBundleMetadata=function(t,n){return Ea(t).put({bundleId:(r=n).id,createTime:sn(mt(r.createTime)),version:r.version});var r},e.prototype.getNamedQuery=function(t,n){return Ia(t).get(n).next((function(r){if(r)return{name:(i=r).name,query:Yc(i.bundledQuery),readTime:an(i.readTime)};var i}))},e.prototype.saveNamedQuery=function(t,n){return Ia(t).put((function(r){return{name:r.name,readTime:sn(mt(r.readTime)),bundledQuery:r.bundledQuery}})(n))},e})();function Ea(e){return Tt(e,nn.store)}function Ia(e){return Tt(e,rn.store)}var Qp=(function(){function e(){this.Bt=new rs}return e.prototype.addToCollectionParentIndex=function(t,n){return this.Bt.add(n),E.resolve()},e.prototype.getCollectionParents=function(t,n){return E.resolve(this.Bt.getEntries(n))},e})(),rs=(function(){function e(){this.index={}}return e.prototype.add=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n]||new Z(U.comparator),o=!i.has(r);return this.index[n]=i.add(r),o},e.prototype.has=function(t){var n=t.lastSegment(),r=t.popLast(),i=this.index[n];return i&&i.has(r)},e.prototype.getEntries=function(t){return(this.index[t]||new Z(U.comparator)).toArray()},e})(),Wp=(function(){function e(){this.qt=new rs}return e.prototype.addToCollectionParentIndex=function(t,n){var r=this;if(!this.qt.has(n)){var i=n.lastSegment(),o=n.popLast();t.addOnCommittedListener((function(){r.qt.add(n)}));var s={collectionId:i,parent:Ft(o)};return Ta(t).put(s)}return E.resolve()},e.prototype.getCollectionParents=function(t,n){var r=[],i=IDBKeyRange.bound([n,""],[hc(n),""],!1,!0);return Ta(t).Nt(i).next((function(o){for(var s=0,a=o;s<a.length;s++){var u=a[s];if(u.collectionId!==n)break;r.push(zt(u.parent))}return r}))},e})();function Ta(e){return Tt(e,Ie.store)}var _a={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Vt=(function(){function e(t,n,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return e.withCacheSize=function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},e})();function Xc(e,t,n){var r=e.store(K.store),i=e.store(st.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.Ot({range:s},(function(d,v,b){return a++,b.delete()}));o.push(u.next((function(){O(a===1)})));for(var c=[],l=0,f=n.mutations;l<f.length;l++){var h=f[l],p=st.key(t,h.key.path,n.batchId);o.push(i.delete(p)),c.push(h.key)}return E.waitFor(o).next((function(){return c}))}function qr(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw D();t=e.noDocument}return JSON.stringify(t).length}Vt.DEFAULT_COLLECTION_PERCENTILE=10,Vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Vt.DEFAULT=new Vt(41943040,Vt.DEFAULT_COLLECTION_PERCENTILE,Vt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Vt.DISABLED=new Vt(-1,0,0);var Yp=(function(){function e(t,n,r,i){this.userId=t,this.R=n,this.Ut=r,this.referenceDelegate=i,this.Qt={}}return e.Kt=function(t,n,r,i){return O(t.uid!==""),new e(t.isAuthenticated()?t.uid:"",n,r,i)},e.prototype.checkEmpty=function(t){var n=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Xt(t).Ot({index:K.userMutationsIndex,range:r},(function(i,o,s){n=!1,s.done()})).next((function(){return n}))},e.prototype.addMutationBatch=function(t,n,r,i){var o=this,s=je(t),a=Xt(t);return a.add({}).next((function(u){O(typeof u=="number");for(var c=new es(u,n,r,i),l=(function(I,A,S){var x=S.baseMutations.map((function(B){return Ur(I.Lt,B)})),M=S.mutations.map((function(B){return Ur(I.Lt,B)}));return new K(A,S.batchId,S.localWriteTime.toMillis(),x,M)})(o.R,o.userId,c),f=[],h=new Z((function(I,A){return L(I.canonicalString(),A.canonicalString())})),p=0,d=i;p<d.length;p++){var v=d[p],b=st.key(o.userId,v.key.path,u);h=h.add(v.key.path.popLast()),f.push(a.put(l)),f.push(s.put(b,st.PLACEHOLDER))}return h.forEach((function(I){f.push(o.Ut.addToCollectionParentIndex(t,I))})),t.addOnCommittedListener((function(){o.Qt[u]=c.keys()})),E.waitFor(f).next((function(){return c}))}))},e.prototype.lookupMutationBatch=function(t,n){var r=this;return Xt(t).get(n).next((function(i){return i?(O(i.userId===r.userId),Be(r.R,i)):null}))},e.prototype.jt=function(t,n){var r=this;return this.Qt[n]?E.resolve(this.Qt[n]):this.lookupMutationBatch(t,n).next((function(i){if(i){var o=i.keys();return r.Qt[n]=o,o}return null}))},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=this,i=n+1,o=IDBKeyRange.lowerBound([this.userId,i]),s=null;return Xt(t).Ot({index:K.userMutationsIndex,range:o},(function(a,u,c){u.userId===r.userId&&(O(u.batchId>=i),s=Be(r.R,u)),c.done()})).next((function(){return s}))},e.prototype.getHighestUnacknowledgedBatchId=function(t){var n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Xt(t).Ot({index:K.userMutationsIndex,range:n,reverse:!0},(function(i,o,s){r=o.batchId,s.done()})).next((function(){return r}))},e.prototype.getAllMutationBatches=function(t){var n=this,r=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Xt(t).Nt(K.userMutationsIndex,r).next((function(i){return i.map((function(o){return Be(n.R,o)}))}))},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=st.prefixForPath(this.userId,n.path),o=IDBKeyRange.lowerBound(i),s=[];return je(t).Ot({range:o},(function(a,u,c){var l=a[0],f=a[1],h=a[2],p=zt(f);if(l===r.userId&&n.path.isEqual(p))return Xt(t).get(h).next((function(d){if(!d)throw D();O(d.userId===r.userId),s.push(Be(r.R,d))}));c.done()})).next((function(){return s}))},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new Z(L),o=[];return n.forEach((function(s){var a=st.prefixForPath(r.userId,s.path),u=IDBKeyRange.lowerBound(a),c=je(t).Ot({range:u},(function(l,f,h){var p=l[0],d=l[1],v=l[2],b=zt(d);p===r.userId&&s.path.isEqual(b)?i=i.add(v):h.done()}));o.push(c)})),E.waitFor(o).next((function(){return r.Wt(t,i)}))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=this,i=n.path,o=i.length+1,s=st.prefixForPath(this.userId,i),a=IDBKeyRange.lowerBound(s),u=new Z(L);return je(t).Ot({range:a},(function(c,l,f){var h=c[0],p=c[1],d=c[2],v=zt(p);h===r.userId&&i.isPrefixOf(v)?v.length===o&&(u=u.add(d)):f.done()})).next((function(){return r.Wt(t,u)}))},e.prototype.Wt=function(t,n){var r=this,i=[],o=[];return n.forEach((function(s){o.push(Xt(t).get(s).next((function(a){if(a===null)throw D();O(a.userId===r.userId),i.push(Be(r.R,a))})))})),E.waitFor(o).next((function(){return i}))},e.prototype.removeMutationBatch=function(t,n){var r=this;return Xc(t.Mt,this.userId,n).next((function(i){return t.addOnCommittedListener((function(){r.Gt(n.batchId)})),E.forEach(i,(function(o){return r.referenceDelegate.markPotentiallyOrphaned(t,o)}))}))},e.prototype.Gt=function(t){delete this.Qt[t]},e.prototype.performConsistencyCheck=function(t){var n=this;return this.checkEmpty(t).next((function(r){if(!r)return E.resolve();var i=IDBKeyRange.lowerBound(st.prefixForUser(n.userId)),o=[];return je(t).Ot({range:i},(function(s,a,u){if(s[0]===n.userId){var c=zt(s[1]);o.push(c)}else u.done()})).next((function(){O(o.length===0)}))}))},e.prototype.containsKey=function(t,n){return Jc(t,this.userId,n)},e.prototype.zt=function(t){var n=this;return Zc(t).get(this.userId).next((function(r){return r||new se(n.userId,-1,"")}))},e})();function Jc(e,t,n){var r=st.prefixForPath(t,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return je(e).Ot({range:o,kt:!0},(function(a,u,c){var l=a[0],f=a[1];a[2],l===t&&f===i&&(s=!0),c.done()})).next((function(){return s}))}function Xt(e){return Tt(e,K.store)}function je(e){return Tt(e,st.store)}function Zc(e){return Tt(e,se.store)}var Br=(function(){function e(t){this.Ht=t}return e.prototype.next=function(){return this.Ht+=2,this.Ht},e.Jt=function(){return new e(0)},e.Yt=function(){return new e(-1)},e})(),Xp=(function(){function e(t,n){this.referenceDelegate=t,this.R=n}return e.prototype.allocateTargetId=function(t){var n=this;return this.Xt(t).next((function(r){var i=new Br(r.highestTargetId);return r.highestTargetId=i.next(),n.Zt(t,r).next((function(){return r.highestTargetId}))}))},e.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next((function(n){return P.fromTimestamp(new Et(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds))}))},e.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next((function(n){return n.highestListenSequenceNumber}))},e.prototype.setTargetsMetadata=function(t,n,r){var i=this;return this.Xt(t).next((function(o){return o.highestListenSequenceNumber=n,r&&(o.lastRemoteSnapshotVersion=r.toTimestamp()),n>o.highestListenSequenceNumber&&(o.highestListenSequenceNumber=n),i.Zt(t,o)}))},e.prototype.addTargetData=function(t,n){var r=this;return this.te(t,n).next((function(){return r.Xt(t).next((function(i){return i.targetCount+=1,r.ee(n,i),r.Zt(t,i)}))}))},e.prototype.updateTargetData=function(t,n){return this.te(t,n)},e.prototype.removeTargetData=function(t,n){var r=this;return this.removeMatchingKeysForTargetId(t,n.targetId).next((function(){return Ue(t).delete(n.targetId)})).next((function(){return r.Xt(t)})).next((function(i){return O(i.targetCount>0),i.targetCount-=1,r.Zt(t,i)}))},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return Ue(t).Ot((function(a,u){var c=_n(u);c.sequenceNumber<=n&&r.get(c.targetId)===null&&(o++,s.push(i.removeTargetData(t,c)))})).next((function(){return E.waitFor(s)})).next((function(){return o}))},e.prototype.forEachTarget=function(t,n){return Ue(t).Ot((function(r,i){var o=_n(i);n(o)}))},e.prototype.Xt=function(t){return Sa(t).get(St.key).next((function(n){return O(n!==null),n}))},e.prototype.Zt=function(t,n){return Sa(t).put(St.key,n)},e.prototype.te=function(t,n){return Ue(t).put(Wc(this.R,n))},e.prototype.ee=function(t,n){var r=!1;return t.targetId>n.highestTargetId&&(n.highestTargetId=t.targetId,r=!0),t.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=t.sequenceNumber,r=!0),r},e.prototype.getTargetCount=function(t){return this.Xt(t).next((function(n){return n.targetCount}))},e.prototype.getTargetData=function(t,n){var r=tr(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Ue(t).Ot({range:i,index:bt.queryTargetsIndexName},(function(s,a,u){var c=_n(a);ai(n,c.target)&&(o=c,u.done())})).next((function(){return o}))},e.prototype.addMatchingKeys=function(t,n,r){var i=this,o=[],s=ne(t);return n.forEach((function(a){var u=Ft(a.path);o.push(s.put(new rt(r,u))),o.push(i.referenceDelegate.addReference(t,r,a))})),E.waitFor(o)},e.prototype.removeMatchingKeys=function(t,n,r){var i=this,o=ne(t);return E.forEach(n,(function(s){var a=Ft(s.path);return E.waitFor([o.delete([r,a]),i.referenceDelegate.removeReference(t,r,s)])}))},e.prototype.removeMatchingKeysForTargetId=function(t,n){var r=ne(t),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=IDBKeyRange.bound([n],[n+1],!1,!0),i=ne(t),o=j();return i.Ot({range:r,kt:!0},(function(s,a,u){var c=zt(s[1]),l=new C(c);o=o.add(l)})).next((function(){return o}))},e.prototype.containsKey=function(t,n){var r=Ft(n.path),i=IDBKeyRange.bound([r],[hc(r)],!1,!0),o=0;return ne(t).Ot({index:rt.documentTargetsIndex,kt:!0,range:i},(function(s,a,u){var c=s[0];s[1],c!==0&&(o++,u.done())})).next((function(){return o>0}))},e.prototype.lt=function(t,n){return Ue(t).get(n).next((function(r){return r?_n(r):null}))},e})();function Ue(e){return Tt(e,bt.store)}function Sa(e){return Tt(e,St.store)}function ne(e){return Tt(e,rt.store)}function Pe(e){return g(this,void 0,void 0,(function(){return m(this,(function(t){if(e.code!==y.FAILED_PRECONDITION||e.message!==zc)throw e;return T("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}function Aa(e,t){var n=e[0],r=e[1],i=t[0],o=t[1],s=L(n,i);return s===0?L(r,o):s}var Jp=(function(){function e(t){this.ne=t,this.buffer=new Z(Aa),this.se=0}return e.prototype.ie=function(){return++this.se},e.prototype.re=function(t){var n=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(n);else{var r=this.buffer.last();Aa(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}},Object.defineProperty(e.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),e})(),Zp=(function(){function e(t,n){this.garbageCollector=t,this.asyncQueue=n,this.oe=!1,this.ce=null}return e.prototype.start=function(t){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.ue(t)},e.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(e.prototype,"started",{get:function(){return this.ce!==null},enumerable:!1,configurable:!0}),e.prototype.ue=function(t){var n=this,r=this.oe?3e5:6e4;T("LruGarbageCollector","Garbage collection scheduled in "+r+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",r,(function(){return g(n,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:this.ce=null,this.oe=!0,o.label=1;case 1:return o.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return o.sent(),[3,7];case 3:return xe(i=o.sent())?(T("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i),[3,6]):[3,4];case 4:return[4,Pe(i)];case 5:o.sent(),o.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return o.sent(),[2]}}))}))}))},e})(),td=(function(){function e(t,n){this.ae=t,this.params=n}return e.prototype.calculateTargetCount=function(t,n){return this.ae.he(t).next((function(r){return Math.floor(n/100*r)}))},e.prototype.nthSequenceNumber=function(t,n){var r=this;if(n===0)return E.resolve(Nt.o);var i=new Jp(n);return this.ae.forEachTarget(t,(function(o){return i.re(o.sequenceNumber)})).next((function(){return r.ae.le(t,(function(o){return i.re(o)}))})).next((function(){return i.maxValue}))},e.prototype.removeTargets=function(t,n,r){return this.ae.removeTargets(t,n,r)},e.prototype.removeOrphanedDocuments=function(t,n){return this.ae.removeOrphanedDocuments(t,n)},e.prototype.collect=function(t,n){var r=this;return this.params.cacheSizeCollectionThreshold===-1?(T("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(_a)):this.getCacheSize(t).next((function(i){return i<r.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector","Garbage collection skipped; Cache size "+i+" is lower than threshold "+r.params.cacheSizeCollectionThreshold),_a):r.fe(t,n)}))},e.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},e.prototype.fe=function(t,n){var r,i,o,s,a,u,c,l=this,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((function(h){return h>l.params.maximumSequenceNumbersToCollect?(T("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.maximumSequenceNumbersToCollect+" from "+h),i=l.params.maximumSequenceNumbersToCollect):i=h,s=Date.now(),l.nthSequenceNumber(t,i)})).next((function(h){return r=h,a=Date.now(),l.removeTargets(t,r,n)})).next((function(h){return o=h,u=Date.now(),l.removeOrphanedDocuments(t,r)})).next((function(h){return c=Date.now(),Xi()<=V.DEBUG&&T("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in `+(s-f)+`ms
	Determined least recently used `+i+" in "+(a-s)+`ms
	Removed `+o+" targets in "+(u-a)+`ms
	Removed `+h+" documents in "+(c-u)+`ms
Total Duration: `+(c-f)+"ms"),E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:o,documentsRemoved:h})}))},e})(),ed=(function(){function e(t,n){this.db=t,this.garbageCollector=(function(r,i){return new td(r,i)})(this,n)}return e.prototype.he=function(t){var n=this.de(t);return this.db.getTargetCache().getTargetCount(t).next((function(r){return n.next((function(i){return r+i}))}))},e.prototype.de=function(t){var n=0;return this.le(t,(function(r){n++})).next((function(){return n}))},e.prototype.forEachTarget=function(t,n){return this.db.getTargetCache().forEachTarget(t,n)},e.prototype.le=function(t,n){return this.we(t,(function(r,i){return n(i)}))},e.prototype.addReference=function(t,n,r){return yr(t,r)},e.prototype.removeReference=function(t,n,r){return yr(t,r)},e.prototype.removeTargets=function(t,n,r){return this.db.getTargetCache().removeTargets(t,n,r)},e.prototype.markPotentiallyOrphaned=function(t,n){return yr(t,n)},e.prototype._e=function(t,n){return(function(r,i){var o=!1;return Zc(r).$t((function(s){return Jc(r,s,i).next((function(a){return a&&(o=!0),E.resolve(!a)}))})).next((function(){return o}))})(t,n)},e.prototype.removeOrphanedDocuments=function(t,n){var r=this,i=this.db.getRemoteDocumentCache().newChangeBuffer(),o=[],s=0;return this.we(t,(function(a,u){if(u<=n){var c=r._e(t,a).next((function(l){if(!l)return s++,i.getEntry(t,a).next((function(){return i.removeEntry(a),ne(t).delete([0,Ft(a.path)])}))}));o.push(c)}})).next((function(){return E.waitFor(o)})).next((function(){return i.apply(t)})).next((function(){return s}))},e.prototype.removeTarget=function(t,n){var r=n.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,r)},e.prototype.updateLimboDocument=function(t,n){return yr(t,n)},e.prototype.we=function(t,n){var r,i=ne(t),o=Nt.o;return i.Ot({index:rt.documentTargetsIndex},(function(s,a){var u=s[0],c=(s[1],a.path),l=a.sequenceNumber;u===0?(o!==Nt.o&&n(new C(zt(r)),o),o=l,r=c):o=Nt.o})).next((function(){o!==Nt.o&&n(new C(zt(r)),o)}))},e.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},e})();function yr(e,t){return ne(e).put((function(n,r){return new rt(0,Ft(n.path),r)})(t,e.currentSequenceNumber))}var yn=(function(){function e(t,n){this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return e.prototype.get=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r!==void 0)for(var i=0,o=r;i<o.length;i++){var s=o[i],a=s[0],u=s[1];if(this.equalsFn(a,t))return u}},e.prototype.has=function(t){return this.get(t)!==void 0},e.prototype.set=function(t,n){var r=this.mapKeyFn(t),i=this.inner[r];if(i!==void 0){for(var o=0;o<i.length;o++)if(this.equalsFn(i[o][0],t))return void(i[o]=[t,n]);i.push([t,n])}else this.inner[r]=[[t,n]]},e.prototype.delete=function(t){var n=this.mapKeyFn(t),r=this.inner[n];if(r===void 0)return!1;for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return r.length===1?delete this.inner[n]:r.splice(i,1),!0;return!1},e.prototype.forEach=function(t){Zn(this.inner,(function(n,r){for(var i=0,o=r;i<o.length;i++){var s=o[i],a=s[0],u=s[1];t(a,u)}}))},e.prototype.isEmpty=function(){return pc(this.inner)},e})(),tl=(function(){function e(){this.changes=new yn((function(t){return t.toString()}),(function(t,n){return t.isEqual(n)})),this.changesApplied=!1}return e.prototype.getReadTime=function(t){var n=this.changes.get(t);return n?n.readTime:P.min()},e.prototype.addEntry=function(t,n){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:n})},e.prototype.removeEntry=function(t,n){n===void 0&&(n=null),this.assertNotApplied(),this.changes.set(t,{document:ft.newInvalidDocument(t),readTime:n})},e.prototype.getEntry=function(t,n){this.assertNotApplied();var r=this.changes.get(n);return r!==void 0?E.resolve(r.document):this.getFromCache(t,n)},e.prototype.getEntries=function(t,n){return this.getAllFromCache(t,n)},e.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},e.prototype.assertNotApplied=function(){},e})(),nd=(function(){function e(t,n){this.R=t,this.Ut=n}return e.prototype.addEntry=function(t,n,r){return te(t).put(vr(n),r)},e.prototype.removeEntry=function(t,n){var r=te(t),i=vr(n);return r.delete(i)},e.prototype.updateMetadata=function(t,n){var r=this;return this.getMetadata(t).next((function(i){return i.byteSize+=n,r.me(t,i)}))},e.prototype.getEntry=function(t,n){var r=this;return te(t).get(vr(n)).next((function(i){return r.ye(n,i)}))},e.prototype.ge=function(t,n){var r=this;return te(t).get(vr(n)).next((function(i){return{document:r.ye(n,i),size:qr(i)}}))},e.prototype.getEntries=function(t,n){var r=this,i=Mt();return this.pe(t,n,(function(o,s){var a=r.ye(o,s);i=i.insert(o,a)})).next((function(){return i}))},e.prototype.Ee=function(t,n){var r=this,i=Mt(),o=new ht(C.comparator);return this.pe(t,n,(function(s,a){var u=r.ye(s,a);i=i.insert(s,u),o=o.insert(s,qr(a))})).next((function(){return{documents:i,Te:o}}))},e.prototype.pe=function(t,n,r){if(n.isEmpty())return E.resolve();var i=IDBKeyRange.bound(n.first().path.toArray(),n.last().path.toArray()),o=n.getIterator(),s=o.getNext();return te(t).Ot({range:i},(function(a,u,c){for(var l=C.fromSegments(a);s&&C.comparator(s,l)<0;)r(s,null),s=o.getNext();s&&s.isEqual(l)&&(r(s,u),s=o.hasNext()?o.getNext():null),s?c.Ct(s.path.toArray()):c.done()})).next((function(){for(;s;)r(s,null),s=o.hasNext()?o.getNext():null}))},e.prototype.getDocumentsMatchingQuery=function(t,n,r){var i=this,o=Mt(),s=n.path.length+1,a={};if(r.isEqual(P.min())){var u=n.path.toArray();a.range=IDBKeyRange.lowerBound(u)}else{var c=n.path.toArray(),l=ns(r);a.range=IDBKeyRange.lowerBound([c,l],!0),a.index=$.collectionReadTimeIndex}return te(t).Ot(a,(function(f,h,p){if(f.length===s){var d=so(i.R,h);n.path.isPrefixOf(d.key.path)?rr(n,d)&&(o=o.insert(d.key,d)):p.done()}})).next((function(){return o}))},e.prototype.newChangeBuffer=function(t){return new rd(this,!!t&&t.trackRemovals)},e.prototype.getSize=function(t){return this.getMetadata(t).next((function(n){return n.byteSize}))},e.prototype.getMetadata=function(t){return Na(t).get(Ut.key).next((function(n){return O(!!n),n}))},e.prototype.me=function(t,n){return Na(t).put(Ut.key,n)},e.prototype.ye=function(t,n){if(n){var r=so(this.R,n);if(!r.isNoDocument()||!r.version.isEqual(P.min()))return r}return ft.newInvalidDocument(t)},e})(),rd=(function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Ie=n,i.trackRemovals=r,i.Ae=new yn((function(o){return o.toString()}),(function(o,s){return o.isEqual(s)})),i}return k(t,e),t.prototype.applyChanges=function(n){var r=this,i=[],o=0,s=new Z((function(a,u){return L(a.canonicalString(),u.canonicalString())}));return this.changes.forEach((function(a,u){var c=r.Ae.get(a);if(u.document.isValidDocument()){var l=ba(r.Ie.R,u.document,r.getReadTime(a));s=s.add(a.path.popLast());var f=qr(l);o+=f-c,i.push(r.Ie.addEntry(n,a,l))}else if(o-=c,r.trackRemovals){var h=ba(r.Ie.R,ft.newNoDocument(a,P.min()),r.getReadTime(a));i.push(r.Ie.addEntry(n,a,h))}else i.push(r.Ie.removeEntry(n,a))})),s.forEach((function(a){i.push(r.Ie.Ut.addToCollectionParentIndex(n,a))})),i.push(this.Ie.updateMetadata(n,o)),E.waitFor(i)},t.prototype.getFromCache=function(n,r){var i=this;return this.Ie.ge(n,r).next((function(o){return i.Ae.set(r,o.size),o.document}))},t.prototype.getAllFromCache=function(n,r){var i=this;return this.Ie.Ee(n,r).next((function(o){var s=o.documents;return o.Te.forEach((function(a,u){i.Ae.set(a,u)})),s}))},t})(tl);function Na(e){return Tt(e,Ut.store)}function te(e){return Tt(e,$.store)}function vr(e){return e.path.toArray()}var id=(function(){function e(t){this.R=t}return e.prototype.Rt=function(t,n,r,i){var o=this;O(r<i&&r>=0&&i<=11);var s=new $c("createOrUpgrade",n);r<1&&i>=1&&((function(u){u.createObjectStore(_t.store)})(t),(function(u){u.createObjectStore(se.store,{keyPath:se.keyPath}),u.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0}),u.createObjectStore(st.store)})(t),Da(t),(function(u){u.createObjectStore($.store)})(t));var a=E.resolve();return r<3&&i>=3&&(r!==0&&((function(u){u.deleteObjectStore(rt.store),u.deleteObjectStore(bt.store),u.deleteObjectStore(St.store)})(t),Da(t)),a=a.next((function(){return(function(u){var c=u.store(St.store),l=new St(0,0,P.min().toTimestamp(),0);return c.put(St.key,l)})(s)}))),r<4&&i>=4&&(r!==0&&(a=a.next((function(){return(function(u,c){return c.store(K.store).Nt().next((function(l){u.deleteObjectStore(K.store),u.createObjectStore(K.store,{keyPath:K.keyPath,autoIncrement:!0}).createIndex(K.userMutationsIndex,K.userMutationsKeyPath,{unique:!0});var f=c.store(K.store),h=l.map((function(p){return f.put(p)}));return E.waitFor(h)}))})(t,s)}))),a=a.next((function(){(function(u){u.createObjectStore($t.store,{keyPath:$t.keyPath})})(t)}))),r<5&&i>=5&&(a=a.next((function(){return o.Re(s)}))),r<6&&i>=6&&(a=a.next((function(){return(function(u){u.createObjectStore(Ut.store)})(t),o.be(s)}))),r<7&&i>=7&&(a=a.next((function(){return o.ve(s)}))),r<8&&i>=8&&(a=a.next((function(){return o.Pe(t,s)}))),r<9&&i>=9&&(a=a.next((function(){(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(t),(function(u){var c=u.objectStore($.store);c.createIndex($.readTimeIndex,$.readTimeIndexPath,{unique:!1}),c.createIndex($.collectionReadTimeIndex,$.collectionReadTimeIndexPath,{unique:!1})})(n)}))),r<10&&i>=10&&(a=a.next((function(){return o.Ve(s)}))),r<11&&i>=11&&(a=a.next((function(){(function(u){u.createObjectStore(nn.store,{keyPath:nn.keyPath})})(t),(function(u){u.createObjectStore(rn.store,{keyPath:rn.keyPath})})(t)}))),a},e.prototype.be=function(t){var n=0;return t.store($.store).Ot((function(r,i){n+=qr(i)})).next((function(){var r=new Ut(n);return t.store(Ut.store).put(Ut.key,r)}))},e.prototype.Re=function(t){var n=this,r=t.store(se.store),i=t.store(K.store);return r.Nt().next((function(o){return E.forEach(o,(function(s){var a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.Nt(K.userMutationsIndex,a).next((function(u){return E.forEach(u,(function(c){O(c.userId===s.userId);var l=Be(n.R,c);return Xc(t,s.userId,l).next((function(){}))}))}))}))}))},e.prototype.ve=function(t){var n=t.store(rt.store),r=t.store($.store);return t.store(St.store).get(St.key).next((function(i){var o=[];return r.Ot((function(s,a){var u=new U(s),c=(function(l){return[0,Ft(l)]})(u);o.push(n.get(c).next((function(l){return l?E.resolve():(function(f){return n.put(new rt(0,Ft(f),i.highestListenSequenceNumber))})(u)})))})).next((function(){return E.waitFor(o)}))}))},e.prototype.Pe=function(t,n){t.createObjectStore(Ie.store,{keyPath:Ie.keyPath});var r=n.store(Ie.store),i=new rs,o=function(s){if(i.add(s)){var a=s.lastSegment(),u=s.popLast();return r.put({collectionId:a,parent:Ft(u)})}};return n.store($.store).Ot({kt:!0},(function(s,a){var u=new U(s);return o(u.popLast())})).next((function(){return n.store(st.store).Ot({kt:!0},(function(s,a){s[0];var u=s[1],c=(s[2],zt(u));return o(c.popLast())}))}))},e.prototype.Ve=function(t){var n=this,r=t.store(bt.store);return r.Ot((function(i,o){var s=_n(o),a=Wc(n.R,s);return r.put(a)}))},e})();function Da(e){e.createObjectStore(rt.store,{keyPath:rt.keyPath}).createIndex(rt.documentTargetsIndex,rt.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(bt.store,{keyPath:bt.keyPath}).createIndex(bt.queryTargetsIndexName,bt.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(St.store)}var Pi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",od=(function(){function e(t,n,r,i,o,s,a,u,c,l){if(this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=l,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.Oe=null,this.$e=Number.NEGATIVE_INFINITY,this.Me=function(f){return Promise.resolve()},!e.yt())throw new w(y.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new ed(this,i),this.Le=n+"main",this.R=new Hc(u),this.Be=new on(this.Le,11,new id(this.R)),this.qe=new Xp(this.referenceDelegate,this.R),this.Ut=new Wp,this.Ue=(function(f,h){return new nd(f,h)})(this.R,this.Ut),this.Qe=new Hp,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,l===!1&&Y("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return e.prototype.start=function(){var t=this;return this.je().then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new w(y.FAILED_PRECONDITION,Pi);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",(function(n){return t.qe.getHighestSequenceNumber(n)}))})).then((function(n){t.Ne=new Nt(n,t.De)})).then((function(){t.xe=!0})).catch((function(n){return t.Be&&t.Be.close(),Promise.reject(n)}))},e.prototype.He=function(t){var n=this;return this.Me=function(r){return g(n,void 0,void 0,(function(){return m(this,(function(i){return this.started?[2,t(r)]:[2]}))}))},t(this.isPrimary)},e.prototype.setDatabaseDeletedListener=function(t){var n=this;this.Be.vt((function(r){return g(n,void 0,void 0,(function(){return m(this,(function(i){switch(i.label){case 0:return r.newVersion===null?[4,t()]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}}))}))}))},e.prototype.setNetworkEnabled=function(t){var n=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget((function(){return g(n,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))})))},e.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(n){return mr(n).put(new $t(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.Je(n).next((function(r){r||(t.isPrimary=!1,t.Se.enqueueRetryable((function(){return t.Me(!1)})))}))})).next((function(){return t.Ye(n)})).next((function(r){return t.isPrimary&&!r?t.Xe(n).next((function(){return!1})):!!r&&t.Ze(n).next((function(){return!0}))}))})).catch((function(n){if(xe(n))return T("IndexedDbPersistence","Failed to extend owner lease: ",n),t.isPrimary;if(!t.allowTabSynchronization)throw n;return T("IndexedDbPersistence","Releasing owner lease after error during lease refresh",n),!1})).then((function(n){t.isPrimary!==n&&t.Se.enqueueRetryable((function(){return t.Me(n)})),t.isPrimary=n}))},e.prototype.Je=function(t){var n=this;return In(t).get(_t.key).next((function(r){return E.resolve(n.tn(r))}))},e.prototype.en=function(t){return mr(t).delete(this.clientId)},e.prototype.nn=function(){return g(this,void 0,void 0,(function(){var t,n,r,i,o=this;return m(this,(function(s){switch(s.label){case 0:return!this.isPrimary||this.sn(this.$e,18e5)?[3,2]:(this.$e=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(a){var u=Tt(a,$t.store);return u.Nt().next((function(c){var l=o.rn(c,18e5),f=c.filter((function(h){return l.indexOf(h)===-1}));return E.forEach(f,(function(h){return u.delete(h.clientId)})).next((function(){return f}))}))})).catch((function(){return[]}))]);case 1:if(t=s.sent(),this.Ke)for(n=0,r=t;n<r.length;n++)i=r[n],this.Ke.removeItem(this.on(i.clientId));s.label=2;case 2:return[2]}}))}))},e.prototype.ze=function(){var t=this;this.Oe=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return t.je().then((function(){return t.nn()})).then((function(){return t.ze()}))}))},e.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},e.prototype.Ye=function(t){var n=this;return this.Ce?E.resolve(!0):In(t).get(_t.key).next((function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)){if(n.tn(r)&&n.networkEnabled)return!0;if(!n.tn(r)){if(!r.allowTabSynchronization)throw new w(y.FAILED_PRECONDITION,Pi);return!1}}return!(!n.networkEnabled||!n.inForeground)||mr(t).Nt().next((function(i){return n.rn(i,5e3).find((function(o){if(n.clientId!==o.clientId){var s=!n.networkEnabled&&o.networkEnabled,a=!n.inForeground&&o.inForeground,u=n.networkEnabled===o.networkEnabled;if(s||a&&u)return!0}return!1}))===void 0}))})).next((function(r){return n.isPrimary!==r&&T("IndexedDbPersistence","Client "+(r?"is":"is not")+" eligible for a primary lease."),r}))},e.prototype.shutdown=function(){return g(this,void 0,void 0,(function(){var t=this;return m(this,(function(n){switch(n.label){case 0:return this.xe=!1,this.un(),this.Oe&&(this.Oe.cancel(),this.Oe=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[_t.store,$t.store],(function(r){var i=new wa(r,Nt.o);return t.Xe(i).next((function(){return t.en(i)}))}))];case 1:return n.sent(),this.Be.close(),this.ln(),[2]}}))}))},e.prototype.rn=function(t,n){var r=this;return t.filter((function(i){return r.sn(i.updateTimeMs,n)&&!r.cn(i.clientId)}))},e.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(n){return mr(n).Nt().next((function(r){return t.rn(r,18e5).map((function(i){return i.clientId}))}))}))},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.getMutationQueue=function(t){return Yp.Kt(t,this.R,this.Ut,this.referenceDelegate)},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getBundleCache=function(){return this.Qe},e.prototype.runTransaction=function(t,n,r){var i=this;T("IndexedDbPersistence","Starting transaction:",t);var o,s=n==="readonly"?"readonly":"readwrite";return this.Be.runTransaction(t,s,Kp,(function(a){return o=new wa(a,i.Ne?i.Ne.next():Nt.o),n==="readwrite-primary"?i.Je(o).next((function(u){return!!u||i.Ye(o)})).next((function(u){if(!u)throw Y("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable((function(){return i.Me(!1)})),new w(y.FAILED_PRECONDITION,zc);return r(o)})).next((function(u){return i.Ze(o).next((function(){return u}))})):i.dn(o).next((function(){return r(o)}))})).then((function(a){return o.raiseOnCommittedEvent(),a}))},e.prototype.dn=function(t){var n=this;return In(t).get(_t.key).next((function(r){if(r!==null&&n.sn(r.leaseTimestampMs,5e3)&&!n.cn(r.ownerId)&&!n.tn(r)&&!(n.Ce||n.allowTabSynchronization&&r.allowTabSynchronization))throw new w(y.FAILED_PRECONDITION,Pi)}))},e.prototype.Ze=function(t){var n=new _t(this.clientId,this.allowTabSynchronization,Date.now());return In(t).put(_t.key,n)},e.yt=function(){return on.yt()},e.prototype.Xe=function(t){var n=this,r=In(t);return r.get(_t.key).next((function(i){return n.tn(i)?(T("IndexedDbPersistence","Releasing primary lease."),r.delete(_t.key)):E.resolve()}))},e.prototype.sn=function(t,n){var r=Date.now();return!(t<r-n||t>r&&(Y("Detected an update time that is in the future: "+t+" > "+r),1))},e.prototype.We=function(){var t=this;this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ke=function(){t.Se.enqueueAndForget((function(){return t.inForeground=t.document.visibilityState==="visible",t.je()}))},this.document.addEventListener("visibilitychange",this.ke),this.inForeground=this.document.visibilityState==="visible")},e.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},e.prototype.Ge=function(){var t,n=this;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.Fe=function(){n.un(),n.Se.enqueueAndForget((function(){return n.shutdown()}))},this.window.addEventListener("unload",this.Fe))},e.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("unload",this.Fe),this.Fe=null)},e.prototype.cn=function(t){var n;try{var r=((n=this.Ke)===null||n===void 0?void 0:n.getItem(this.on(t)))!==null;return T("IndexedDbPersistence","Client '"+t+"' "+(r?"is":"is not")+" zombied in LocalStorage"),r}catch(i){return Y("IndexedDbPersistence","Failed to get zombied client id.",i),!1}},e.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Y("Failed to set zombie client id.",t)}},e.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch{}},e.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},e})();function In(e){return Tt(e,_t.store)}function mr(e){return Tt(e,$t.store)}function is(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var el=(function(){function e(t,n,r){this.Ue=t,this._n=n,this.Ut=r}return e.prototype.mn=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,n).next((function(i){return r.yn(t,n,i)}))},e.prototype.yn=function(t,n,r){return this.Ue.getEntry(t,n).next((function(i){for(var o=0,s=r;o<s.length;o++)s[o].applyToLocalView(i);return i}))},e.prototype.gn=function(t,n){t.forEach((function(r,i){for(var o=0,s=n;o<s.length;o++)s[o].applyToLocalView(i)}))},e.prototype.pn=function(t,n){var r=this;return this.Ue.getEntries(t,n).next((function(i){return r.En(t,i).next((function(){return i}))}))},e.prototype.En=function(t,n){var r=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,n).next((function(i){return r.gn(n,i)}))},e.prototype.getDocumentsMatchingQuery=function(t,n,r){return(function(i){return C.isDocumentKey(i.path)&&i.collectionGroup===null&&i.filters.length===0})(n)?this.Tn(t,n.path):Wo(n)?this.In(t,n,r):this.An(t,n,r)},e.prototype.Tn=function(t,n){return this.mn(t,new C(n)).next((function(r){var i=io();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i}))},e.prototype.In=function(t,n,r){var i=this,o=n.collectionGroup,s=io();return this.Ut.getCollectionParents(t,o).next((function(a){return E.forEach(a,(function(u){var c=(function(l,f){return new Wt(f,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)})(n,u.child(o));return i.An(t,c,r).next((function(l){l.forEach((function(f,h){s=s.insert(f,h)}))}))})).next((function(){return s}))}))},e.prototype.An=function(t,n,r){var i,o,s=this;return this.Ue.getDocumentsMatchingQuery(t,n,r).next((function(a){return i=a,s._n.getAllMutationBatchesAffectingQuery(t,n)})).next((function(a){return o=a,s.Rn(t,o,i).next((function(u){i=u;for(var c=0,l=o;c<l.length;c++)for(var f=l[c],h=0,p=f.mutations;h<p.length;h++){var d=p[h],v=d.key,b=i.get(v);b==null&&(b=ft.newInvalidDocument(v),i=i.insert(v,b)),ro(d,b,f.localWriteTime),b.isFoundDocument()||(i=i.remove(v))}}))})).next((function(){return i.forEach((function(a,u){rr(n,u)||(i=i.remove(a))})),i}))},e.prototype.Rn=function(t,n,r){for(var i=j(),o=0,s=n;o<s.length;o++)for(var a=0,u=s[o].mutations;a<u.length;a++){var c=u[a];c instanceof de&&r.get(c.key)===null&&(i=i.add(c.key))}var l=r;return this.Ue.getEntries(t,i).next((function(f){return f.forEach((function(h,p){p.isFoundDocument()&&(l=l.insert(h,p))})),l}))},e})(),sd=(function(){function e(t,n,r,i){this.targetId=t,this.fromCache=n,this.bn=r,this.vn=i}return e.Pn=function(t,n){for(var r=j(),i=j(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new e(t,n.fromCache,r,i)},e})(),nl=(function(){function e(){}return e.prototype.Vn=function(t){this.Sn=t},e.prototype.getDocumentsMatchingQuery=function(t,n,r,i){var o=this;return(function(s){return s.filters.length===0&&s.limit===null&&s.startAt==null&&s.endAt==null&&(s.explicitOrderBy.length===0||s.explicitOrderBy.length===1&&s.explicitOrderBy[0].field.isKeyField())})(n)||r.isEqual(P.min())?this.Dn(t,n):this.Sn.pn(t,i).next((function(s){var a=o.Cn(n,s);return(wr(n)||Vr(n))&&o.Nn(n.limitType,a,i,r)?o.Dn(t,n):(Xi()<=V.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),no(n)),o.Sn.getDocumentsMatchingQuery(t,n,r).next((function(u){return a.forEach((function(c){u=u.insert(c.key,c)})),u})))}))},e.prototype.Cn=function(t,n){var r=new Z(Ic(t));return n.forEach((function(i,o){rr(t,o)&&(r=r.add(o))})),r},e.prototype.Nn=function(t,n,r,i){if(r.size!==n.size)return!0;var o=t==="F"?n.last():n.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(i)>0)},e.prototype.Dn=function(t,n){return Xi()<=V.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",no(n)),this.Sn.getDocumentsMatchingQuery(t,n,P.min())},e})(),ad=(function(){function e(t,n,r,i){this.persistence=t,this.xn=n,this.R=i,this.Fn=new ht(L),this.kn=new yn((function(o){return tr(o)}),ai),this.On=P.min(),this._n=t.getMutationQueue(r),this.$n=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new el(this.$n,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return e.prototype.collectGarbage=function(t){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(r){return t.collect(r,n.Fn)}))},e})();function rl(e,t,n,r){return new ad(e,t,n,r)}function il(e,t){return g(this,void 0,void 0,(function(){var n,r,i,o;return m(this,(function(s){switch(s.label){case 0:return n=_(e),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",(function(a){var u;return n._n.getAllMutationBatches(a).next((function(c){return u=c,r=n.persistence.getMutationQueue(t),i=new el(n.$n,r,n.persistence.getIndexManager()),r.getAllMutationBatches(a)})).next((function(c){for(var l=[],f=[],h=j(),p=0,d=u;p<d.length;p++){var v=d[p];l.push(v.batchId);for(var b=0,I=v.mutations;b<I.length;b++){var A=I[b];h=h.add(A.key)}}for(var S=0,x=c;S<x.length;S++){var M=x[S];f.push(M.batchId);for(var B=0,nt=M.mutations;B<nt.length;B++){var Ti=nt[B];h=h.add(Ti.key)}}return i.pn(a,h).next((function(bn){return{Ln:bn,removedBatchIds:l,addedBatchIds:f}}))}))}))];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}}))}))}function ud(e,t){var n=_(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(r){var i=t.batch.keys(),o=n.$n.newChangeBuffer({trackRemovals:!0});return(function(s,a,u,c){var l=u.batch,f=l.keys(),h=E.resolve();return f.forEach((function(p){h=h.next((function(){return c.getEntry(a,p)})).next((function(d){var v=u.docVersions.get(p);O(v!==null),d.version.compareTo(v)<0&&(l.applyToRemoteDocument(d,u),d.isValidDocument()&&c.addEntry(d,u.commitVersion))}))})),h.next((function(){return s._n.removeMutationBatch(a,l)}))})(n,r,t,o).next((function(){return o.apply(r)})).next((function(){return n._n.performConsistencyCheck(r)})).next((function(){return n.Mn.pn(r,i)}))}))}function ol(e){var t=_(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(n){return t.qe.getLastRemoteSnapshotVersion(n)}))}function cd(e,t){var n=_(e),r=t.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(o){var s=n.$n.newChangeBuffer({trackRemovals:!0});i=n.Fn;var a=[];t.targetChanges.forEach((function(l,f){var h=i.get(f);if(h){a.push(n.qe.removeMatchingKeys(o,l.removedDocuments,f).next((function(){return n.qe.addMatchingKeys(o,l.addedDocuments,f)})));var p=l.resumeToken;if(p.approximateByteSize()>0){var d=h.withResumeToken(p,r).withSequenceNumber(o.currentSequenceNumber);i=i.insert(f,d),(function(v,b,I){return O(b.resumeToken.approximateByteSize()>0),v.resumeToken.approximateByteSize()===0||b.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=3e8||I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0})(h,d,l)&&a.push(n.qe.updateTargetData(o,d))}}}));var u=Mt();if(t.documentUpdates.forEach((function(l,f){t.resolvedLimboDocuments.has(l)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(o,l))})),a.push(ld(o,s,t.documentUpdates,r).next((function(l){u=l}))),!r.isEqual(P.min())){var c=n.qe.getLastRemoteSnapshotVersion(o).next((function(l){return n.qe.setTargetsMetadata(o,o.currentSequenceNumber,r)}));a.push(c)}return E.waitFor(a).next((function(){return s.apply(o)})).next((function(){return n.Mn.En(o,u)})).next((function(){return u}))})).then((function(o){return n.Fn=i,o}))}function ld(e,t,n,r,i){var o=j();return n.forEach((function(s){return o=o.add(s)})),t.getEntries(e,o).next((function(s){var a=Mt();return n.forEach((function(u,c){var l=s.get(u),f=r;c.isNoDocument()&&c.version.isEqual(P.min())?(t.removeEntry(u,f),a=a.insert(u,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(t.addEntry(c,f),a=a.insert(u,c)):T("LocalStore","Ignoring outdated watch update for ",u,". Current version:",l.version," Watch version:",c.version)})),a}))}function fd(e,t){var n=_(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(r){return t===void 0&&(t=-1),n._n.getNextMutationBatchAfterBatchId(r,t)}))}function jr(e,t){var n=_(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(r){var i;return n.qe.getTargetData(r,t).next((function(o){return o?(i=o,E.resolve(i)):n.qe.allocateTargetId(r).next((function(s){return i=new fi(t,s,0,r.currentSequenceNumber),n.qe.addTargetData(r,i).next((function(){return i}))}))}))})).then((function(r){var i=n.Fn.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(r.targetId,r),n.kn.set(t,r.targetId)),r}))}function un(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o,s;return m(this,(function(a){switch(a.label){case 0:r=_(e),i=r.Fn.get(t),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,(function(u){return r.persistence.referenceDelegate.removeTarget(u,i)}))];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!xe(s=a.sent()))throw s;return T("LocalStore","Failed to update sequence numbers for target "+t+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(t),r.kn.delete(i.target),[2]}}))}))}function Kr(e,t,n){var r=_(e),i=P.min(),o=j();return r.persistence.runTransaction("Execute query","readonly",(function(s){return(function(a,u,c){var l=_(a),f=l.kn.get(c);return f!==void 0?E.resolve(l.Fn.get(f)):l.qe.getTargetData(u,c)})(r,s,jt(t)).next((function(a){if(a)return i=a.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(s,a.targetId).next((function(u){o=u}))})).next((function(){return r.xn.getDocumentsMatchingQuery(s,t,n?i:P.min(),n?o:j())})).next((function(a){return{documents:a,Bn:o}}))}))}function sl(e,t){var n=_(e),r=_(n.qe),i=n.Fn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(o){return r.lt(o,t).next((function(s){return s?s.target:null}))}))}function al(e){var t=_(e);return t.persistence.runTransaction("Get new document changes","readonly",(function(n){return(function(r,i,o){var s=_(r),a=Mt(),u=ns(o),c=te(i),l=IDBKeyRange.lowerBound(u,!0);return c.Ot({index:$.readTimeIndex,range:l},(function(f,h){var p=so(s.R,h);a=a.insert(p.key,p),u=h.readTime})).next((function(){return{wn:a,readTime:Qc(u)}}))})(t.$n,n,t.On)})).then((function(n){var r=n.wn,i=n.readTime;return t.On=i,r}))}function hd(e){return g(this,void 0,void 0,(function(){var t;return m(this,(function(n){return[2,(t=_(e)).persistence.runTransaction("Synchronize last document change read time","readonly",(function(r){return(function(i){var o=te(i),s=P.min();return o.Ot({index:$.readTimeIndex,reverse:!0},(function(a,u,c){u.readTime&&(s=Qc(u.readTime)),c.done()})).next((function(){return s}))})(r)})).then((function(r){t.On=r}))]}))}))}var pd=(function(){function e(t){this.R=t,this.Kn=new Map,this.jn=new Map}return e.prototype.getBundleMetadata=function(t,n){return E.resolve(this.Kn.get(n))},e.prototype.saveBundleMetadata=function(t,n){var r;return this.Kn.set(n.id,{id:(r=n).id,version:r.version,createTime:mt(r.createTime)}),E.resolve()},e.prototype.getNamedQuery=function(t,n){return E.resolve(this.jn.get(n))},e.prototype.saveNamedQuery=function(t,n){return this.jn.set(n.name,(function(r){return{name:r.name,query:Yc(r.bundledQuery),readTime:mt(r.readTime)}})(n)),E.resolve()},e})(),os=(function(){function e(){this.Wn=new Z(et.Gn),this.zn=new Z(et.Hn)}return e.prototype.isEmpty=function(){return this.Wn.isEmpty()},e.prototype.addReference=function(t,n){var r=new et(t,n);this.Wn=this.Wn.add(r),this.zn=this.zn.add(r)},e.prototype.Jn=function(t,n){var r=this;t.forEach((function(i){return r.addReference(i,n)}))},e.prototype.removeReference=function(t,n){this.Yn(new et(t,n))},e.prototype.Xn=function(t,n){var r=this;t.forEach((function(i){return r.removeReference(i,n)}))},e.prototype.Zn=function(t){var n=this,r=new C(new U([])),i=new et(r,t),o=new et(r,t+1),s=[];return this.zn.forEachInRange([i,o],(function(a){n.Yn(a),s.push(a.key)})),s},e.prototype.ts=function(){var t=this;this.Wn.forEach((function(n){return t.Yn(n)}))},e.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},e.prototype.es=function(t){var n=new C(new U([])),r=new et(n,t),i=new et(n,t+1),o=j();return this.zn.forEachInRange([r,i],(function(s){o=o.add(s.key)})),o},e.prototype.containsKey=function(t){var n=new et(t,0),r=this.Wn.firstAfterOrEqual(n);return r!==null&&t.isEqual(r.key)},e})(),et=(function(){function e(t,n){this.key=t,this.ns=n}return e.Gn=function(t,n){return C.comparator(t.key,n.key)||L(t.ns,n.ns)},e.Hn=function(t,n){return L(t.ns,n.ns)||C.comparator(t.key,n.key)},e})(),dd=(function(){function e(t,n){this.Ut=t,this.referenceDelegate=n,this._n=[],this.ss=1,this.rs=new Z(et.Gn)}return e.prototype.checkEmpty=function(t){return E.resolve(this._n.length===0)},e.prototype.addMutationBatch=function(t,n,r,i){var o=this.ss;this.ss++,this._n.length>0&&this._n[this._n.length-1];var s=new es(o,n,r,i);this._n.push(s);for(var a=0,u=i;a<u.length;a++){var c=u[a];this.rs=this.rs.add(new et(c.key,o)),this.Ut.addToCollectionParentIndex(t,c.key.path.popLast())}return E.resolve(s)},e.prototype.lookupMutationBatch=function(t,n){return E.resolve(this.os(n))},e.prototype.getNextMutationBatchAfterBatchId=function(t,n){var r=n+1,i=this.cs(r),o=i<0?0:i;return E.resolve(this._n.length>o?this._n[o]:null)},e.prototype.getHighestUnacknowledgedBatchId=function(){return E.resolve(this._n.length===0?-1:this.ss-1)},e.prototype.getAllMutationBatches=function(t){return E.resolve(this._n.slice())},e.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,n){var r=this,i=new et(n,0),o=new et(n,Number.POSITIVE_INFINITY),s=[];return this.rs.forEachInRange([i,o],(function(a){var u=r.os(a.ns);s.push(u)})),E.resolve(s)},e.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,n){var r=this,i=new Z(L);return n.forEach((function(o){var s=new et(o,0),a=new et(o,Number.POSITIVE_INFINITY);r.rs.forEachInRange([s,a],(function(u){i=i.add(u.ns)}))})),E.resolve(this.us(i))},e.prototype.getAllMutationBatchesAffectingQuery=function(t,n){var r=n.path,i=r.length+1,o=r;C.isDocumentKey(o)||(o=o.child(""));var s=new et(new C(o),0),a=new Z(L);return this.rs.forEachWhile((function(u){var c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.ns)),!0)}),s),E.resolve(this.us(a))},e.prototype.us=function(t){var n=this,r=[];return t.forEach((function(i){var o=n.os(i);o!==null&&r.push(o)})),r},e.prototype.removeMutationBatch=function(t,n){var r=this;O(this.hs(n.batchId,"removed")===0),this._n.shift();var i=this.rs;return E.forEach(n.mutations,(function(o){var s=new et(o.key,n.batchId);return i=i.delete(s),r.referenceDelegate.markPotentiallyOrphaned(t,o.key)})).next((function(){r.rs=i}))},e.prototype.Gt=function(t){},e.prototype.containsKey=function(t,n){var r=new et(n,0),i=this.rs.firstAfterOrEqual(r);return E.resolve(n.isEqual(i&&i.key))},e.prototype.performConsistencyCheck=function(t){return this._n.length,E.resolve()},e.prototype.hs=function(t,n){return this.cs(t)},e.prototype.cs=function(t){return this._n.length===0?0:t-this._n[0].batchId},e.prototype.os=function(t){var n=this.cs(t);return n<0||n>=this._n.length?null:this._n[n]},e})(),yd=(function(){function e(t,n){this.Ut=t,this.ls=n,this.docs=new ht(C.comparator),this.size=0}return e.prototype.addEntry=function(t,n,r){var i=n.key,o=this.docs.get(i),s=o?o.size:0,a=this.ls(n);return this.docs=this.docs.insert(i,{document:n.clone(),size:a,readTime:r}),this.size+=a-s,this.Ut.addToCollectionParentIndex(t,i.path.popLast())},e.prototype.removeEntry=function(t){var n=this.docs.get(t);n&&(this.docs=this.docs.remove(t),this.size-=n.size)},e.prototype.getEntry=function(t,n){var r=this.docs.get(n);return E.resolve(r?r.document.clone():ft.newInvalidDocument(n))},e.prototype.getEntries=function(t,n){var r=this,i=Mt();return n.forEach((function(o){var s=r.docs.get(o);i=i.insert(o,s?s.document.clone():ft.newInvalidDocument(o))})),E.resolve(i)},e.prototype.getDocumentsMatchingQuery=function(t,n,r){for(var i=Mt(),o=new C(n.path.child("")),s=this.docs.getIteratorFrom(o);s.hasNext();){var a=s.getNext(),u=a.key,c=a.value,l=c.document,f=c.readTime;if(!n.path.isPrefixOf(u.path))break;f.compareTo(r)<=0||rr(n,l)&&(i=i.insert(l.key,l.clone()))}return E.resolve(i)},e.prototype.fs=function(t,n){return E.forEach(this.docs,(function(r){return n(r)}))},e.prototype.newChangeBuffer=function(t){return new vd(this)},e.prototype.getSize=function(t){return E.resolve(this.size)},e})(),vd=(function(e){function t(n){var r=this;return(r=e.call(this)||this).Ie=n,r}return k(t,e),t.prototype.applyChanges=function(n){var r=this,i=[];return this.changes.forEach((function(o,s){s.document.isValidDocument()?i.push(r.Ie.addEntry(n,s.document,r.getReadTime(o))):r.Ie.removeEntry(o)})),E.waitFor(i)},t.prototype.getFromCache=function(n,r){return this.Ie.getEntry(n,r)},t.prototype.getAllFromCache=function(n,r){return this.Ie.getEntries(n,r)},t})(tl),md=(function(){function e(t){this.persistence=t,this.ds=new yn((function(n){return tr(n)}),ai),this.lastRemoteSnapshotVersion=P.min(),this.highestTargetId=0,this.ws=0,this._s=new os,this.targetCount=0,this.ys=Br.Jt()}return e.prototype.forEachTarget=function(t,n){return this.ds.forEach((function(r,i){return n(i)})),E.resolve()},e.prototype.getLastRemoteSnapshotVersion=function(t){return E.resolve(this.lastRemoteSnapshotVersion)},e.prototype.getHighestSequenceNumber=function(t){return E.resolve(this.ws)},e.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),E.resolve(this.highestTargetId)},e.prototype.setTargetsMetadata=function(t,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.ws&&(this.ws=n),E.resolve()},e.prototype.te=function(t){this.ds.set(t.target,t);var n=t.targetId;n>this.highestTargetId&&(this.ys=new Br(n),this.highestTargetId=n),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},e.prototype.addTargetData=function(t,n){return this.te(n),this.targetCount+=1,E.resolve()},e.prototype.updateTargetData=function(t,n){return this.te(n),E.resolve()},e.prototype.removeTargetData=function(t,n){return this.ds.delete(n.target),this._s.Zn(n.targetId),this.targetCount-=1,E.resolve()},e.prototype.removeTargets=function(t,n,r){var i=this,o=0,s=[];return this.ds.forEach((function(a,u){u.sequenceNumber<=n&&r.get(u.targetId)===null&&(i.ds.delete(a),s.push(i.removeMatchingKeysForTargetId(t,u.targetId)),o++)})),E.waitFor(s).next((function(){return o}))},e.prototype.getTargetCount=function(t){return E.resolve(this.targetCount)},e.prototype.getTargetData=function(t,n){var r=this.ds.get(n)||null;return E.resolve(r)},e.prototype.addMatchingKeys=function(t,n,r){return this._s.Jn(n,r),E.resolve()},e.prototype.removeMatchingKeys=function(t,n,r){this._s.Xn(n,r);var i=this.persistence.referenceDelegate,o=[];return i&&n.forEach((function(s){o.push(i.markPotentiallyOrphaned(t,s))})),E.waitFor(o)},e.prototype.removeMatchingKeysForTargetId=function(t,n){return this._s.Zn(n),E.resolve()},e.prototype.getMatchingKeysForTargetId=function(t,n){var r=this._s.es(n);return E.resolve(r)},e.prototype.containsKey=function(t,n){return E.resolve(this._s.containsKey(n))},e})(),gd=(function(){function e(t,n){var r=this;this.gs={},this.Ne=new Nt(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new md(this),this.Ut=new Qp,this.Ue=(function(i,o){return new yd(i,(function(s){return r.referenceDelegate.ps(s)}))})(this.Ut),this.R=new Hc(n),this.Qe=new pd(this.R)}return e.prototype.start=function(){return Promise.resolve()},e.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(e.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),e.prototype.setDatabaseDeletedListener=function(){},e.prototype.setNetworkEnabled=function(){},e.prototype.getIndexManager=function(){return this.Ut},e.prototype.getMutationQueue=function(t){var n=this.gs[t.toKey()];return n||(n=new dd(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=n),n},e.prototype.getTargetCache=function(){return this.qe},e.prototype.getRemoteDocumentCache=function(){return this.Ue},e.prototype.getBundleCache=function(){return this.Qe},e.prototype.runTransaction=function(t,n,r){var i=this;T("MemoryPersistence","Starting transaction:",t);var o=new wd(this.Ne.next());return this.referenceDelegate.Es(),r(o).next((function(s){return i.referenceDelegate.Ts(o).next((function(){return s}))})).toPromise().then((function(s){return o.raiseOnCommittedEvent(),s}))},e.prototype.Is=function(t,n){return E.or(Object.values(this.gs).map((function(r){return function(){return r.containsKey(t,n)}})))},e})(),wd=(function(e){function t(n){var r=this;return(r=e.call(this)||this).currentSequenceNumber=n,r}return k(t,e),t})(Gc),bd=(function(){function e(t){this.persistence=t,this.As=new os,this.Rs=null}return e.bs=function(t){return new e(t)},Object.defineProperty(e.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw D()},enumerable:!1,configurable:!0}),e.prototype.addReference=function(t,n,r){return this.As.addReference(r,n),this.vs.delete(r.toString()),E.resolve()},e.prototype.removeReference=function(t,n,r){return this.As.removeReference(r,n),this.vs.add(r.toString()),E.resolve()},e.prototype.markPotentiallyOrphaned=function(t,n){return this.vs.add(n.toString()),E.resolve()},e.prototype.removeTarget=function(t,n){var r=this;this.As.Zn(n.targetId).forEach((function(o){return r.vs.add(o.toString())}));var i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,n.targetId).next((function(o){o.forEach((function(s){return r.vs.add(s.toString())}))})).next((function(){return i.removeTargetData(t,n)}))},e.prototype.Es=function(){this.Rs=new Set},e.prototype.Ts=function(t){var n=this,r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.vs,(function(i){var o=C.fromPath(i);return n.Ps(t,o).next((function(s){s||r.removeEntry(o)}))})).next((function(){return n.Rs=null,r.apply(t)}))},e.prototype.updateLimboDocument=function(t,n){var r=this;return this.Ps(t,n).next((function(i){i?r.vs.delete(n.toString()):r.vs.add(n.toString())}))},e.prototype.ps=function(t){return 0},e.prototype.Ps=function(t,n){var r=this;return E.or([function(){return E.resolve(r.As.containsKey(n))},function(){return r.persistence.getTargetCache().containsKey(t,n)},function(){return r.persistence.Is(t,n)}])},e})(),wt=(function(){function e(t){this.uid=t}return e.prototype.isAuthenticated=function(){return this.uid!=null},e.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},e.prototype.isEqual=function(t){return t.uid===this.uid},e})();function Ca(e,t){return"firestore_clients_"+e+"_"+t}function ka(e,t,n){var r="firestore_mutations_"+e+"_"+n;return t.isAuthenticated()&&(r+="_"+t.uid),r}function Li(e,t){return"firestore_targets_"+e+"_"+t}wt.UNAUTHENTICATED=new wt(null),wt.GOOGLE_CREDENTIALS=new wt("google-credentials-uid"),wt.FIRST_PARTY=new wt("first-party-uid");var Oa=(function(){function e(t,n,r,i){this.user=t,this.batchId=n,this.state=r,this.error=i}return e.Vs=function(t,n,r){var i,o=JSON.parse(r),s=typeof o=="object"&&["pending","acknowledged","rejected"].indexOf(o.state)!==-1&&(o.error===void 0||typeof o.error=="object");return s&&o.error&&(s=typeof o.error.message=="string"&&typeof o.error.code=="string")&&(i=new w(o.error.code,o.error.message)),s?new e(t,n,o.state,i):(Y("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e})(),Mi=(function(){function e(t,n,r){this.targetId=t,this.state=n,this.error=r}return e.Vs=function(t,n){var r,i=JSON.parse(n),o=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string")&&(r=new w(i.error.code,i.error.message)),o?new e(t,i.state,r):(Y("SharedClientState","Failed to parse target state for ID '"+t+"': "+n),null)},e.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},e})(),Ra=(function(){function e(t,n){this.clientId=t,this.activeTargetIds=n}return e.Vs=function(t,n){for(var r=JSON.parse(n),i=typeof r=="object"&&r.activeTargetIds instanceof Array,o=li(),s=0;i&&s<r.activeTargetIds.length;++s)i=vc(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new e(t,o):(Y("SharedClientState","Failed to parse client data for instance '"+t+"': "+n),null)},e})(),Ed=(function(){function e(t,n){this.clientId=t,this.onlineState=n}return e.Vs=function(t){var n=JSON.parse(t);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new e(n.clientId,n.onlineState):(Y("SharedClientState","Failed to parse online state: "+t),null)},e})(),ao=(function(){function e(){this.activeTargetIds=li()}return e.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},e.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},e.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},e})(),Fi=(function(){function e(t,n,r,i,o){this.window=t,this.Se=n,this.persistenceKey=r,this.Ns=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new ht(L),this.started=!1,this.Os=[];var s=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=o,this.$s=Ca(this.persistenceKey,this.Ns),this.Ms=(function(a){return"firestore_sequence_number_"+a})(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new ao),this.Ls=new RegExp("^firestore_clients_"+s+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+s+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+s+"_(\\d+)$"),this.Us=(function(a){return"firestore_online_state_"+a})(this.persistenceKey),this.Qs=(function(a){return"firestore_bundle_loaded_"+a})(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return e.yt=function(t){return!(!t||!t.localStorage)},e.prototype.start=function(){return g(this,void 0,void 0,(function(){var t,n,r,i,o,s,a,u,c,l,f,h=this;return m(this,(function(p){switch(p.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=p.sent(),n=0,r=t;n<r.length;n++)(i=r[n])!==this.Ns&&(o=this.getItem(Ca(this.persistenceKey,i)))&&(s=Ra.Vs(i,o))&&(this.ks=this.ks.insert(s.clientId,s));for(this.Ks(),(a=this.storage.getItem(this.Us))&&(u=this.js(a))&&this.Ws(u),c=0,l=this.Os;c<l.length;c++)f=l[c],this.Fs(f);return this.Os=[],this.window.addEventListener("unload",(function(){return h.shutdown()})),this.started=!0,[2]}}))}))},e.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},e.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},e.prototype.isActiveQueryTarget=function(t){var n=!1;return this.ks.forEach((function(r,i){i.activeTargetIds.has(t)&&(n=!0)})),n},e.prototype.addPendingMutation=function(t){this.zs(t,"pending")},e.prototype.updateMutationState=function(t,n,r){this.zs(t,n,r),this.Hs(t)},e.prototype.addLocalQueryTarget=function(t){var n="not-current";if(this.isActiveQueryTarget(t)){var r=this.storage.getItem(Li(this.persistenceKey,t));if(r){var i=Mi.Vs(t,r);i&&(n=i.state)}}return this.Js.Ds(t),this.Ks(),n},e.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},e.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){this.removeItem(Li(this.persistenceKey,t))},e.prototype.updateQueryState=function(t,n,r){this.Ys(t,n,r)},e.prototype.handleUserChange=function(t,n,r){var i=this;n.forEach((function(o){i.Hs(o)})),this.currentUser=t,r.forEach((function(o){i.addPendingMutation(o)}))},e.prototype.setOnlineState=function(t){this.Xs(t)},e.prototype.notifyBundleLoaded=function(){this.Zs()},e.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.$s),this.started=!1)},e.prototype.getItem=function(t){var n=this.storage.getItem(t);return T("SharedClientState","READ",t,n),n},e.prototype.setItem=function(t,n){T("SharedClientState","SET",t,n),this.storage.setItem(t,n)},e.prototype.removeItem=function(t){T("SharedClientState","REMOVE",t),this.storage.removeItem(t)},e.prototype.Fs=function(t){var n=this,r=t;if(r.storageArea===this.storage){if(T("SharedClientState","EVENT",r.key,r.newValue),r.key===this.$s)return void Y("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable((function(){return g(n,void 0,void 0,(function(){var i,o,s,a,u,c;return m(this,(function(l){if(this.started){if(r.key!==null){if(this.Ls.test(r.key)){if(r.newValue==null)return i=this.ti(r.key),[2,this.ei(i,null)];if(o=this.ni(r.key,r.newValue))return[2,this.ei(o.clientId,o)]}else if(this.Bs.test(r.key)){if(r.newValue!==null&&(s=this.si(r.key,r.newValue)))return[2,this.ii(s)]}else if(this.qs.test(r.key)){if(r.newValue!==null&&(a=this.ri(r.key,r.newValue)))return[2,this.oi(a)]}else if(r.key===this.Us){if(r.newValue!==null&&(u=this.js(r.newValue)))return[2,this.Ws(u)]}else if(r.key===this.Ms)(c=(function(f){var h=Nt.o;if(f!=null)try{var p=JSON.parse(f);O(typeof p=="number"),h=p}catch(d){Y("SharedClientState","Failed to read sequence number from WebStorage",d)}return h})(r.newValue))!==Nt.o&&this.sequenceNumberHandler(c);else if(r.key===this.Qs)return[2,this.syncEngine.ci()]}}else this.Os.push(r);return[2]}))}))}))}},Object.defineProperty(e.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),e.prototype.Ks=function(){this.setItem(this.$s,this.Js.Ss())},e.prototype.zs=function(t,n,r){var i=new Oa(this.currentUser,t,n,r),o=ka(this.persistenceKey,this.currentUser,t);this.setItem(o,i.Ss())},e.prototype.Hs=function(t){var n=ka(this.persistenceKey,this.currentUser,t);this.removeItem(n)},e.prototype.Xs=function(t){var n={clientId:this.Ns,onlineState:t};this.storage.setItem(this.Us,JSON.stringify(n))},e.prototype.Ys=function(t,n,r){var i=Li(this.persistenceKey,t),o=new Mi(t,n,r);this.setItem(i,o.Ss())},e.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},e.prototype.ti=function(t){var n=this.Ls.exec(t);return n?n[1]:null},e.prototype.ni=function(t,n){var r=this.ti(t);return Ra.Vs(r,n)},e.prototype.si=function(t,n){var r=this.Bs.exec(t),i=Number(r[1]),o=r[2]!==void 0?r[2]:null;return Oa.Vs(new wt(o),i,n)},e.prototype.ri=function(t,n){var r=this.qs.exec(t),i=Number(r[1]);return Mi.Vs(i,n)},e.prototype.js=function(t){return Ed.Vs(t)},e.prototype.ii=function(t){return g(this,void 0,void 0,(function(){return m(this,(function(n){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(T("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},e.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},e.prototype.ei=function(t,n){var r=this,i=n?this.ks.insert(t,n):this.ks.remove(t),o=this.Gs(this.ks),s=this.Gs(i),a=[],u=[];return s.forEach((function(c){o.has(c)||a.push(c)})),o.forEach((function(c){s.has(c)||u.push(c)})),this.syncEngine.hi(a,u).then((function(){r.ks=i}))},e.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},e.prototype.Gs=function(t){var n=li();return t.forEach((function(r,i){n=n.unionWith(i.activeTargetIds)})),n},e})(),ul=(function(){function e(){this.li=new ao,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return e.prototype.addPendingMutation=function(t){},e.prototype.updateMutationState=function(t,n,r){},e.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},e.prototype.updateQueryState=function(t,n,r){this.fi[t]=n},e.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},e.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.clearQueryState=function(t){delete this.fi[t]},e.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},e.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},e.prototype.start=function(){return this.li=new ao,Promise.resolve()},e.prototype.handleUserChange=function(t,n,r){},e.prototype.setOnlineState=function(t){},e.prototype.shutdown=function(){},e.prototype.writeSequenceNumber=function(t){},e.prototype.notifyBundleLoaded=function(){},e})(),Id=(function(){function e(){}return e.prototype.di=function(t){},e.prototype.shutdown=function(){},e})(),xa=(function(){function e(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return e.prototype.di=function(t){this.gi.push(t)},e.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},e.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},e.prototype._i=function(){T("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(0)},e.prototype.yi=function(){T("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,n=this.gi;t<n.length;t++)(0,n[t])(1)},e.yt=function(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0},e})(),Td={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},_d=(function(){function e(t){this.Ei=t.Ei,this.Ti=t.Ti}return e.prototype.Ii=function(t){this.Ai=t},e.prototype.Ri=function(t){this.bi=t},e.prototype.onMessage=function(t){this.vi=t},e.prototype.close=function(){this.Ti()},e.prototype.send=function(t){this.Ei(t)},e.prototype.Pi=function(){this.Ai()},e.prototype.Vi=function(t){this.bi(t)},e.prototype.Si=function(t){this.vi(t)},e})(),Sd=(function(e){function t(n){var r=this;return(r=e.call(this,n)||this).forceLongPolling=n.forceLongPolling,r.autoDetectLongPolling=n.autoDetectLongPolling,r}return k(t,e),t.prototype.ki=function(n,r,i,o){return new Promise((function(s,a){var u=new ep;u.listenOnce(Zh.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case xi.NO_ERROR:var l=u.getResponseJson();T("Connection","XHR received:",JSON.stringify(l)),s(l);break;case xi.TIMEOUT:T("Connection",'RPC "'+n+'" timed out'),a(new w(y.DEADLINE_EXCEEDED,"Request time out"));break;case xi.HTTP_ERROR:var f=u.getStatus();if(T("Connection",'RPC "'+n+'" failed with status:',f,"response text:",u.getResponseText()),f>0){var h=u.getResponseJson().error;if(h&&h.status&&h.message){var p=(function(d){var v=d.toLowerCase().replace(/_/g,"-");return Object.values(y).indexOf(v)>=0?v:y.UNKNOWN})(h.status);a(new w(p,h.message))}else a(new w(y.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new w(y.UNAVAILABLE,"Connection failed."));break;default:D()}}finally{T("Connection",'RPC "'+n+'" completed.')}}));var c=JSON.stringify(o);u.send(r,"POST",c,i,15)}))},t.prototype.$i=function(n,r){var i=[this.Di,"/","google.firestore.v1.Firestore","/",n,"/channel"],o=Xh(),s=Jh(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.Fi(a.initMessageHeaders,r),af()||ff()||hf()||pf()||df()||lf()||(a.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");T("Connection","Creating WebChannel: "+u,a);var c=o.createWebChannel(u,a),l=!1,f=!1,h=new _d({Ei:function(d){f?T("Connection","Not sending because WebChannel is closed:",d):(l||(T("Connection","Opening WebChannel transport."),c.open(),l=!0),T("Connection","WebChannel sending:",d),c.send(d))},Ti:function(){return c.close()}}),p=function(d,v,b){d.listen(v,(function(I){try{b(I)}catch(A){setTimeout((function(){throw A}),0)}}))};return p(c,pr.EventType.OPEN,(function(){f||T("Connection","WebChannel transport opened.")})),p(c,pr.EventType.CLOSE,(function(){f||(f=!0,T("Connection","WebChannel transport closed"),h.Vi())})),p(c,pr.EventType.ERROR,(function(d){f||(f=!0,Ji("Connection","WebChannel transport errored:",d),h.Vi(new w(y.UNAVAILABLE,"The operation could not be completed")))})),p(c,pr.EventType.MESSAGE,(function(d){var v;if(!f){var b=d.data[0];O(!!b);var I=b,A=I.error||((v=I[0])===null||v===void 0?void 0:v.error);if(A){T("Connection","WebChannel received error:",A);var S=A.status,x=(function(B){var nt=Q[B];if(nt!==void 0)return Rc(nt)})(S),M=A.message;x===void 0&&(x=y.INTERNAL,M="Unknown error status: "+S+" with message "+A.message),f=!0,h.Vi(new w(x,M)),c.close()}else T("Connection","WebChannel received:",b),h.Si(b)}})),p(s,tp.STAT_EVENT,(function(d){d.stat===Ys.PROXY?T("Connection","Detected buffering proxy"):d.stat===Ys.NOPROXY&&T("Connection","Detected no buffering proxy")})),setTimeout((function(){h.Pi()}),0),h},t})((function(){function e(t){this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Di=n+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return e.prototype.Ni=function(t,n,r,i){var o=this.xi(t,n);T("RestConnection","Sending: ",o,r);var s={};return this.Fi(s,i),this.ki(t,o,s,r).then((function(a){return T("RestConnection","Received: ",a),a}),(function(a){throw Ji("RestConnection",t+" failed with error: ",a,"url: ",o,"request:",r),a}))},e.prototype.Oi=function(t,n,r,i){return this.Ni(t,n,r,i)},e.prototype.Fi=function(t,n){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.5.0",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),n)for(var r in n.authHeaders)n.authHeaders.hasOwnProperty(r)&&(t[r]=n.authHeaders[r])},e.prototype.xi=function(t,n){var r=Td[t];return this.Di+"/v1/"+n+":"+r},e})());function cl(){return typeof window<"u"?window:null}function Ir(){return typeof document<"u"?document:null}function hi(e){return new Op(e,!0)}var ss=(function(){function e(t,n,r,i,o){r===void 0&&(r=1e3),i===void 0&&(i=1.5),o===void 0&&(o=6e4),this.Se=t,this.timerId=n,this.Mi=r,this.Li=i,this.Bi=o,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return e.prototype.reset=function(){this.qi=0},e.prototype.Ki=function(){this.qi=this.Bi},e.prototype.ji=function(t){var n=this;this.cancel();var r=Math.floor(this.qi+this.Wi()),i=Math.max(0,Date.now()-this.Qi),o=Math.max(0,r-i);o>0&&T("ExponentialBackoff","Backing off for "+o+" ms (base delay: "+this.qi+" ms, delay with jitter: "+r+" ms, last attempt: "+i+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,o,(function(){return n.Qi=Date.now(),t()})),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},e.prototype.Gi=function(){this.Ui!==null&&(this.Ui.skipDelay(),this.Ui=null)},e.prototype.cancel=function(){this.Ui!==null&&(this.Ui.cancel(),this.Ui=null)},e.prototype.Wi=function(){return(Math.random()-.5)*this.qi},e})(),ll=(function(){function e(t,n,r,i,o,s){this.Se=t,this.zi=r,this.Hi=i,this.Ji=o,this.listener=s,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new ss(t,n)}return e.prototype.tr=function(){return this.state===1||this.state===2||this.state===4},e.prototype.er=function(){return this.state===2},e.prototype.start=function(){this.state!==3?this.auth():this.nr()},e.prototype.stop=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},e.prototype.sr=function(){this.state=0,this.Zi.reset()},e.prototype.ir=function(){var t=this;this.er()&&this.Xi===null&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,(function(){return t.rr()})))},e.prototype.cr=function(t){this.ur(),this.stream.send(t)},e.prototype.rr=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){return this.er()?[2,this.close(0)]:[2]}))}))},e.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},e.prototype.close=function(t,n){return g(this,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,t!==3?this.Zi.reset():n&&n.code===y.RESOURCE_EXHAUSTED?(Y(n.toString()),Y("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):n&&n.code===y.UNAUTHENTICATED&&this.Ji.invalidateToken(),this.stream!==null&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(n)];case 1:return r.sent(),[2]}}))}))},e.prototype.ar=function(){},e.prototype.auth=function(){var t=this;this.state=1;var n=this.hr(this.Yi),r=this.Yi;this.Ji.getToken().then((function(i){t.Yi===r&&t.lr(i)}),(function(i){n((function(){var o=new w(y.UNKNOWN,"Fetching auth token failed: "+i.message);return t.dr(o)}))}))},e.prototype.lr=function(t){var n=this,r=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii((function(){r((function(){return n.state=2,n.listener.Ii()}))})),this.stream.Ri((function(i){r((function(){return n.dr(i)}))})),this.stream.onMessage((function(i){r((function(){return n.onMessage(i)}))}))},e.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji((function(){return g(t,void 0,void 0,(function(){return m(this,(function(n){return this.state=0,this.start(),[2]}))}))}))},e.prototype.dr=function(t){return T("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},e.prototype.hr=function(t){var n=this;return function(r){n.Se.enqueueAndForget((function(){return n.Yi===t?r():(T("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},e})(),Ad=(function(e){function t(n,r,i,o,s){var a=this;return(a=e.call(this,n,"listen_stream_connection_backoff","listen_stream_idle",r,i,s)||this).R=o,a}return k(t,e),t.prototype.wr=function(n){return this.Hi.$i("Listen",n)},t.prototype.onMessage=function(n){this.Zi.reset();var r=(function(o,s){var a;if("targetChange"in s){s.targetChange;var u=(function(b){return b==="NO_CHANGE"?0:b==="ADD"?1:b==="REMOVE"?2:b==="CURRENT"?3:b==="RESET"?4:D()})(s.targetChange.targetChangeType||"NO_CHANGE"),c=s.targetChange.targetIds||[],l=(function(b,I){return b.I?(O(I===void 0||typeof I=="string"),It.fromBase64String(I||"")):(O(I===void 0||I instanceof Uint8Array),It.fromUint8Array(I||new Uint8Array))})(o,s.targetChange.resumeToken),f=(h=s.targetChange.cause)&&(function(b){var I=b.code===void 0?y.UNKNOWN:Rc(b.code);return new w(I,b.message||"")})(h);a=new Pc(u,c,l,f||null)}else if("documentChange"in s){s.documentChange,(u=s.documentChange).document,u.document.name,u.document.updateTime,c=Gt(o,u.document.name),l=mt(u.document.updateTime);var h=new At({mapValue:{fields:u.document.fields}}),p=(f=ft.newFoundDocument(c,l,h),u.targetIds||[]),d=u.removedTargetIds||[];a=new Er(p,d,f.key,f)}else if("documentDelete"in s)s.documentDelete,(u=s.documentDelete).document,c=Gt(o,u.document),l=u.readTime?mt(u.readTime):P.min(),h=ft.newNoDocument(c,l),f=u.removedTargetIds||[],a=new Er([],f,h.key,h);else if("documentRemove"in s)s.documentRemove,(u=s.documentRemove).document,c=Gt(o,u.document),l=u.removedTargetIds||[],a=new Er([],l,c,null);else{if(!("filter"in s))return D();s.filter;var v=s.filter;v.targetId,u=v.count||0,c=new Ep(u),l=v.targetId,a=new xc(l,c)}return a})(this.R,n),i=(function(o){if(!("targetChange"in o))return P.min();var s=o.targetChange;return s.targetIds&&s.targetIds.length?P.min():s.readTime?mt(s.readTime):P.min()})(n);return this.listener._r(r,i)},t.prototype.mr=function(n){var r={};r.database=Vn(this.R),r.addTarget=(function(o,s){var a,u=s.target;return(a=Mr(u)?{documents:Uc(o,u)}:{query:qc(o,u)}).targetId=s.targetId,s.resumeToken.approximateByteSize()>0?a.resumeToken=Lc(o,s.resumeToken):s.snapshotVersion.compareTo(P.min())>0&&(a.readTime=Mn(o,s.snapshotVersion.toTimestamp())),a})(this.R,n);var i=(function(o,s){var a=(function(u,c){switch(c){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return D()}})(0,s.purpose);return a==null?null:{"goog-listen-tags":a}})(this.R,n);i&&(r.labels=i),this.cr(r)},t.prototype.yr=function(n){var r={};r.database=Vn(this.R),r.removeTarget=n,this.cr(r)},t})(ll),Nd=(function(e){function t(n,r,i,o,s){var a=this;return(a=e.call(this,n,"write_stream_connection_backoff","write_stream_idle",r,i,s)||this).R=o,a.gr=!1,a}return k(t,e),Object.defineProperty(t.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),t.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,e.prototype.start.call(this)},t.prototype.ar=function(){this.gr&&this.Er([])},t.prototype.wr=function(n){return this.Hi.$i("Write",n)},t.prototype.onMessage=function(n){if(O(!!n.streamToken),this.lastStreamToken=n.streamToken,this.gr){this.Zi.reset();var r=(function(o,s){return o&&o.length>0?(O(s!==void 0),o.map((function(a){return(function(u,c){var l=u.updateTime?mt(u.updateTime):mt(c);return l.isEqual(P.min())&&(l=mt(c)),new gp(l,u.transformResults||[])})(a,s)}))):[]})(n.writeResults,n.commitTime),i=mt(n.commitTime);return this.listener.Tr(i,r)}return O(!n.writeResults||n.writeResults.length===0),this.gr=!0,this.listener.Ir()},t.prototype.Ar=function(){var n={};n.database=Vn(this.R),this.cr(n)},t.prototype.Er=function(n){var r=this,i={streamToken:this.lastStreamToken,writes:n.map((function(o){return Ur(r.R,o)}))};this.cr(i)},t})(ll),Dd=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).credentials=n,o.Hi=r,o.R=i,o.Rr=!1,o}return k(t,e),t.prototype.br=function(){if(this.Rr)throw new w(y.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.Ni=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then((function(s){return o.Hi.Ni(n,r,i,s)})).catch((function(s){throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(y.UNKNOWN,s.toString())}))},t.prototype.Oi=function(n,r,i){var o=this;return this.br(),this.credentials.getToken().then((function(s){return o.Hi.Oi(n,r,i,s)})).catch((function(s){throw s.name==="FirebaseError"?(s.code===y.UNAUTHENTICATED&&o.credentials.invalidateToken(),s):new w(y.UNKNOWN,s.toString())}))},t.prototype.terminate=function(){this.Rr=!0},t})((function(){})),Cd=(function(){function e(t,n){this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return e.prototype.Sr=function(){var t=this;this.vr===0&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()})))},e.prototype.Nr=function(t){this.state==="Online"?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},e.prototype.set=function(t){this.Fr(),this.vr=0,t==="Online"&&(this.Vr=!1),this.Dr(t)},e.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},e.prototype.Cr=function(t){var n="Could not reach Cloud Firestore backend. "+t+`
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Vr?(Y(n),this.Vr=!1):T("OnlineStateTracker",n)},e.prototype.Fr=function(){this.Pr!==null&&(this.Pr.cancel(),this.Pr=null)},e})(),kd=function(e,t,n,r,i){var o=this;this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.Or=new Map,this.$r=new Set,this.Mr=[],this.Lr=i,this.Lr.di((function(s){n.enqueueAndForget((function(){return g(o,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return ye(this)?(T("RemoteStore","Restarting streams for network reachability change."),[4,(function(u){return g(this,void 0,void 0,(function(){var c;return m(this,(function(l){switch(l.label){case 0:return(c=_(u)).$r.add(4),[4,vn(c)];case 1:return l.sent(),c.Br.set("Unknown"),c.$r.delete(4),[4,ar(c)];case 2:return l.sent(),[2]}}))}))})(this)]):[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}}))}))}))})),this.Br=new Cd(n,r)};function ar(e){return g(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:if(!ye(e))return[3,4];t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))}function vn(e){return g(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:t=0,n=e.Mr,r.label=1;case 1:return t<n.length?[4,(0,n[t])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return t++,[3,1];case 4:return[2]}}))}))}function pi(e,t){var n=_(e);n.Or.has(t.targetId)||(n.Or.set(t.targetId,t),cs(n)?us(n):gn(n).er()&&as(n,t))}function Un(e,t){var n=_(e),r=gn(n);n.Or.delete(t),r.er()&&fl(n,t),n.Or.size===0&&(r.er()?r.ir():ye(n)&&n.Br.set("Unknown"))}function as(e,t){e.qr.U(t.targetId),gn(e).mr(t)}function fl(e,t){e.qr.U(t),gn(e).yr(t)}function us(e){e.qr=new Dp({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},lt:function(t){return e.Or.get(t)||null}}),gn(e).start(),e.Br.Sr()}function cs(e){return ye(e)&&!gn(e).tr()&&e.Or.size>0}function ye(e){return _(e).$r.size===0}function hl(e){e.qr=void 0}function Od(e){return g(this,void 0,void 0,(function(){return m(this,(function(t){return e.Or.forEach((function(n,r){as(e,n)})),[2]}))}))}function Rd(e,t){return g(this,void 0,void 0,(function(){return m(this,(function(n){return hl(e),cs(e)?(e.Br.Nr(t),us(e)):e.Br.set("Unknown"),[2]}))}))}function xd(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o;return m(this,(function(s){switch(s.label){case 0:if(e.Br.set("Online"),!(t instanceof Pc&&t.state===2&&t.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,(function(a,u){return g(this,void 0,void 0,(function(){var c,l,f,h;return m(this,(function(p){switch(p.label){case 0:c=u.cause,l=0,f=u.targetIds,p.label=1;case 1:return l<f.length?(h=f[l],a.Or.has(h)?[4,a.remoteSyncer.rejectListen(h,c)]:[3,3]):[3,5];case 2:p.sent(),a.Or.delete(h),a.qr.removeTarget(h),p.label=3;case 3:p.label=4;case 4:return l++,[3,1];case 5:return[2]}}))}))})(e,t)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),T("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),r),[4,zr(e,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof Er?e.qr.X(t):t instanceof xc?e.qr.rt(t):e.qr.et(t),n.isEqual(P.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,ol(e.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,(function(a,u){var c=a.qr.ut(u);return c.targetChanges.forEach((function(l,f){if(l.resumeToken.approximateByteSize()>0){var h=a.Or.get(f);h&&a.Or.set(f,h.withResumeToken(l.resumeToken,u))}})),c.targetMismatches.forEach((function(l){var f=a.Or.get(l);if(f){a.Or.set(l,f.withResumeToken(It.EMPTY_BYTE_STRING,f.snapshotVersion)),fl(a,l);var h=new fi(f.target,l,1,f.sequenceNumber);as(a,h)}})),a.remoteSyncer.applyRemoteEvent(c)})(e,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return T("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,zr(e,o)];case 12:return s.sent(),[3,13];case 13:return[2]}}))}))}function zr(e,t,n){return g(this,void 0,void 0,(function(){var r=this;return m(this,(function(i){switch(i.label){case 0:if(!xe(t))throw t;return e.$r.add(1),[4,vn(e)];case 1:return i.sent(),e.Br.set("Offline"),n||(n=function(){return ol(e.localStore)}),e.asyncQueue.enqueueRetryable((function(){return g(r,void 0,void 0,(function(){return m(this,(function(o){switch(o.label){case 0:return T("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return o.sent(),e.$r.delete(1),[4,ar(e)];case 2:return o.sent(),[2]}}))}))})),[2]}}))}))}function pl(e,t){return t().catch((function(n){return zr(e,n,t)}))}function mn(e){return g(this,void 0,void 0,(function(){var t,n,r,i,o;return m(this,(function(s){switch(s.label){case 0:t=_(e),n=fe(t),r=t.kr.length>0?t.kr[t.kr.length-1].batchId:-1,s.label=1;case 1:if(!(function(a){return ye(a)&&a.kr.length<10})(t))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,fd(t.localStore,r)];case 3:return(i=s.sent())===null?(t.kr.length===0&&n.ir(),[3,7]):(r=i.batchId,(function(a,u){a.kr.push(u);var c=fe(a);c.er()&&c.pr&&c.Er(u.mutations)})(t,i),[3,6]);case 4:return o=s.sent(),[4,zr(t,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return dl(t)&&yl(t),[2]}}))}))}function dl(e){return ye(e)&&!fe(e).tr()&&e.kr.length>0}function yl(e){fe(e).start()}function Pd(e){return g(this,void 0,void 0,(function(){return m(this,(function(t){return fe(e).Ar(),[2]}))}))}function Ld(e){return g(this,void 0,void 0,(function(){var t,n,r,i;return m(this,(function(o){for(t=fe(e),n=0,r=e.kr;n<r.length;n++)i=r[n],t.Er(i.mutations);return[2]}))}))}function Md(e,t,n){return g(this,void 0,void 0,(function(){var r,i;return m(this,(function(o){switch(o.label){case 0:return r=e.kr.shift(),i=$p.from(r,t,n),[4,pl(e,(function(){return e.remoteSyncer.applySuccessfulWrite(i)}))];case 1:return o.sent(),[4,mn(e)];case 2:return o.sent(),[2]}}))}))}function Fd(e,t){return g(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return t&&fe(e).pr?[4,(function(r,i){return g(this,void 0,void 0,(function(){var o,s;return m(this,(function(a){switch(a.label){case 0:return Oc(s=i.code)&&s!==y.ABORTED?(o=r.kr.shift(),fe(r).sr(),[4,pl(r,(function(){return r.remoteSyncer.rejectFailedWrite(o.batchId,i)}))]):[3,3];case 1:return a.sent(),[4,mn(r)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))})(e,t)]:[3,2];case 1:n.sent(),n.label=2;case 2:return dl(e)&&yl(e),[2]}}))}))}function uo(e,t){return g(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=_(e),t?(n.$r.delete(2),[4,ar(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return t?[3,4]:(n.$r.add(2),[4,vn(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}}))}))}function gn(e){var t=this;return e.Ur||(e.Ur=(function(n,r,i){var o=_(n);return o.br(),new Ad(r,o.Hi,o.credentials,o.R,i)})(e.datastore,e.asyncQueue,{Ii:Od.bind(null,e),Ri:Rd.bind(null,e),_r:xd.bind(null,e)}),e.Mr.push((function(n){return g(t,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return n?(e.Ur.sr(),cs(e)?us(e):e.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,e.Ur.stop()];case 2:r.sent(),hl(e),r.label=3;case 3:return[2]}}))}))}))),e.Ur}function fe(e){var t=this;return e.Qr||(e.Qr=(function(n,r,i){var o=_(n);return o.br(),new Nd(r,o.Hi,o.credentials,o.R,i)})(e.datastore,e.asyncQueue,{Ii:Pd.bind(null,e),Ri:Fd.bind(null,e),Ir:Ld.bind(null,e),Tr:Md.bind(null,e)}),e.Mr.push((function(n){return g(t,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return n?(e.Qr.sr(),[4,mn(e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.Qr.stop()];case 3:r.sent(),e.kr.length>0&&(T("RemoteStore","Stopping write stream with "+e.kr.length+" pending writes"),e.kr=[]),r.label=4;case 4:return[2]}}))}))}))),e.Qr}var Vd=(function(){function e(t,n,r,i,o){this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=o,this.deferred=new Rt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(s){}))}return e.createAndSchedule=function(t,n,r,i,o){var s=new e(t,n,Date.now()+r,i,o);return s.start(r),s},e.prototype.start=function(t){var n=this;this.timerHandle=setTimeout((function(){return n.handleDelayElapsed()}),t)},e.prototype.skipDelay=function(){return this.handleDelayElapsed()},e.prototype.cancel=function(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new w(y.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},e.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget((function(){return t.timerHandle!==null?(t.clearTimeout(),t.op().then((function(n){return t.deferred.resolve(n)}))):Promise.resolve()}))},e.prototype.clearTimeout=function(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},e})();function wn(e,t){if(Y("AsyncQueue",t+": "+e),xe(e))return new w(y.UNAVAILABLE,t+": "+e);throw e}var vl=(function(){function e(t){this.comparator=t?function(n,r){return t(n,r)||C.comparator(n.key,r.key)}:function(n,r){return C.comparator(n.key,r.key)},this.keyedMap=io(),this.sortedSet=new ht(this.comparator)}return e.emptySet=function(t){return new e(t.comparator)},e.prototype.has=function(t){return this.keyedMap.get(t)!=null},e.prototype.get=function(t){return this.keyedMap.get(t)},e.prototype.first=function(){return this.sortedSet.minKey()},e.prototype.last=function(){return this.sortedSet.maxKey()},e.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},e.prototype.indexOf=function(t){var n=this.keyedMap.get(t);return n?this.sortedSet.indexOf(n):-1},Object.defineProperty(e.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t){this.sortedSet.inorderTraversal((function(n,r){return t(n),!1}))},e.prototype.add=function(t){var n=this.delete(t.key);return n.copy(n.keyedMap.insert(t.key,t),n.sortedSet.insert(t,null))},e.prototype.delete=function(t){var n=this.get(t);return n?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(n)):this},e.prototype.isEqual=function(t){if(!(t instanceof e)||this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},e.prototype.toString=function(){var t=[];return this.forEach((function(n){t.push(n.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`},e.prototype.copy=function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r},e})(),Pa=(function(){function e(){this.Kr=new ht(C.comparator)}return e.prototype.track=function(t){var n=t.doc.key,r=this.Kr.get(n);r?t.type!==0&&r.type===3?this.Kr=this.Kr.insert(n,t):t.type===3&&r.type!==1?this.Kr=this.Kr.insert(n,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.Kr=this.Kr.insert(n,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.Kr=this.Kr.insert(n,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.Kr=this.Kr.remove(n):t.type===1&&r.type===2?this.Kr=this.Kr.insert(n,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.Kr=this.Kr.insert(n,{type:2,doc:t.doc}):D():this.Kr=this.Kr.insert(n,t)},e.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal((function(n,r){t.push(r)})),t},e})(),Gr=(function(){function e(t,n,r,i,o,s,a,u){this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=o,this.fromCache=s,this.syncStateChanged=a,this.excludesMetadataChanges=u}return e.fromInitialDocuments=function(t,n,r,i){var o=[];return n.forEach((function(s){o.push({type:0,doc:s})})),new e(t,n,vl.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&nr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var n=this.docChanges,r=t.docChanges;if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0},e})(),Ud=function(){this.Wr=void 0,this.listeners=[]},qd=function(){this.queries=new yn((function(e){return Ec(e)}),nr),this.onlineState="Unknown",this.Gr=new Set};function ls(e,t){return g(this,void 0,void 0,(function(){var n,r,i,o,s,a,u;return m(this,(function(c){switch(c.label){case 0:if(n=_(e),r=t.query,i=!1,(o=n.queries.get(r))||(i=!0,o=new Ud),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=wn(a,"Initialization of query '"+no(t.query)+"' failed"),[2,void t.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(t),t.zr(n.onlineState),o.Wr&&t.Hr(o.Wr)&&hs(n),[2]}}))}))}function fs(e,t){return g(this,void 0,void 0,(function(){var n,r,i,o,s;return m(this,(function(a){return n=_(e),r=t.query,i=!1,(o=n.queries.get(r))&&(s=o.listeners.indexOf(t))>=0&&(o.listeners.splice(s,1),i=o.listeners.length===0),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]}))}))}function Bd(e,t){for(var n=_(e),r=!1,i=0,o=t;i<o.length;i++){var s=o[i],a=s.query,u=n.queries.get(a);if(u){for(var c=0,l=u.listeners;c<l.length;c++)l[c].Hr(s)&&(r=!0);u.Wr=s}}r&&hs(n)}function jd(e,t,n){var r=_(e),i=r.queries.get(t);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(t)}function hs(e){e.Gr.forEach((function(t){t.next()}))}var ps=(function(){function e(t,n,r){this.query=t,this.Jr=n,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=r||{}}return e.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var n=[],r=0,i=t.docChanges;r<i.length;r++){var o=i[r];o.type!==3&&n.push(o)}t=new Gr(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var s=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),s=!0):this.eo(t,this.onlineState)&&(this.no(t),s=!0),this.Xr=t,s},e.prototype.onError=function(t){this.Jr.error(t)},e.prototype.zr=function(t){this.onlineState=t;var n=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),n=!0),n},e.prototype.eo=function(t,n){if(!t.fromCache)return!0;var r=n!=="Offline";return!(this.options.so&&r||t.docs.isEmpty()&&n!=="Offline")},e.prototype.Zr=function(t){if(t.docChanges.length>0)return!0;var n=this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0},e.prototype.no=function(t){t=Gr.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},e})();var ml=function(e){this.key=e},gl=function(e){this.key=e},wl=(function(){function e(t,n){this.query=t,this.uo=n,this.ao=null,this.current=!1,this.ho=j(),this.mutatedKeys=j(),this.lo=Ic(t),this.fo=new vl(this.lo)}return Object.defineProperty(e.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),e.prototype._o=function(t,n){var r=this,i=n?n.mo:new Pa,o=n?n.fo:this.fo,s=n?n.mutatedKeys:this.mutatedKeys,a=o,u=!1,c=wr(this.query)&&o.size===this.query.limit?o.last():null,l=Vr(this.query)&&o.size===this.query.limit?o.first():null;if(t.inorderTraversal((function(h,p){var d=o.get(h),v=rr(r.query,p)?p:null,b=!!d&&r.mutatedKeys.has(d.key),I=!!v&&(v.hasLocalMutations||r.mutatedKeys.has(v.key)&&v.hasCommittedMutations),A=!1;d&&v?d.data.isEqual(v.data)?b!==I&&(i.track({type:3,doc:v}),A=!0):r.yo(d,v)||(i.track({type:2,doc:v}),A=!0,(c&&r.lo(v,c)>0||l&&r.lo(v,l)<0)&&(u=!0)):!d&&v?(i.track({type:0,doc:v}),A=!0):d&&!v&&(i.track({type:1,doc:d}),A=!0,(c||l)&&(u=!0)),A&&(v?(a=a.add(v),s=I?s.add(h):s.delete(h)):(a=a.delete(h),s=s.delete(h)))})),wr(this.query)||Vr(this.query))for(;a.size>this.query.limit;){var f=wr(this.query)?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),i.track({type:1,doc:f})}return{fo:a,mo:i,Nn:u,mutatedKeys:s}},e.prototype.yo=function(t,n){return t.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations},e.prototype.applyChanges=function(t,n,r){var i=this,o=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var s=t.mo.jr();s.sort((function(l,f){return(function(h,p){var d=function(v){switch(v){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return D()}};return d(h)-d(p)})(l.type,f.type)||i.lo(l.doc,f.doc)})),this.po(r);var a=n?this.Eo():[],u=this.ho.size===0&&this.current?1:0,c=u!==this.ao;return this.ao=u,s.length!==0||c?{snapshot:new Gr(this.query,t.fo,o,s,t.mutatedKeys,u===0,c,!1),To:a}:{To:a}},e.prototype.zr=function(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({fo:this.fo,mo:new Pa,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},e.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},e.prototype.po=function(t){var n=this;t&&(t.addedDocuments.forEach((function(r){return n.uo=n.uo.add(r)})),t.modifiedDocuments.forEach((function(r){})),t.removedDocuments.forEach((function(r){return n.uo=n.uo.delete(r)})),this.current=t.current)},e.prototype.Eo=function(){var t=this;if(!this.current)return[];var n=this.ho;this.ho=j(),this.fo.forEach((function(i){t.Io(i.key)&&(t.ho=t.ho.add(i.key))}));var r=[];return n.forEach((function(i){t.ho.has(i)||r.push(new gl(i))})),this.ho.forEach((function(i){n.has(i)||r.push(new ml(i))})),r},e.prototype.Ao=function(t){this.uo=t.Bn,this.ho=j();var n=this._o(t.documents);return this.applyChanges(n,!0)},e.prototype.Ro=function(){return Gr.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,this.ao===0)},e})(),Kd=function(e,t,n){this.query=e,this.targetId=t,this.view=n},zd=function(e){this.key=e,this.bo=!1},Gd=(function(){function e(t,n,r,i,o,s){this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=o,this.maxConcurrentLimboResolutions=s,this.vo={},this.Po=new yn((function(a){return Ec(a)}),nr),this.Vo=new Map,this.So=new Set,this.Do=new ht(C.comparator),this.Co=new Map,this.No=new os,this.xo={},this.Fo=new Map,this.ko=Br.Yt(),this.onlineState="Unknown",this.Oo=void 0}return Object.defineProperty(e.prototype,"isPrimaryClient",{get:function(){return this.Oo===!0},enumerable:!1,configurable:!0}),e})();function $d(e,t){return g(this,void 0,void 0,(function(){var n,r,i,o,s,a;return m(this,(function(u){switch(u.label){case 0:return n=gs(e),(o=n.Po.get(t))?(r=o.targetId,n.sharedClientState.addLocalQueryTarget(r),i=o.view.Ro(),[3,4]):[3,1];case 1:return[4,jr(n.localStore,jt(t))];case 2:return s=u.sent(),a=n.sharedClientState.addLocalQueryTarget(s.targetId),r=s.targetId,[4,ds(n,t,r,a==="current")];case 3:i=u.sent(),n.isPrimaryClient&&pi(n.remoteStore,s),u.label=4;case 4:return[2,i]}}))}))}function ds(e,t,n,r){return g(this,void 0,void 0,(function(){var i,o,s,a,u,c;return m(this,(function(l){switch(l.label){case 0:return e.$o=function(f,h,p){return(function(d,v,b,I){return g(this,void 0,void 0,(function(){var A,S,x;return m(this,(function(M){switch(M.label){case 0:return A=v.view._o(b),A.Nn?[4,Kr(d.localStore,v.query,!1).then((function(B){var nt=B.documents;return v.view._o(nt,A)}))]:[3,2];case 1:A=M.sent(),M.label=2;case 2:return S=I&&I.targetChanges.get(v.targetId),x=v.view.applyChanges(A,d.isPrimaryClient,S),[2,(co(d,v.targetId,x.To),x.snapshot)]}}))}))})(e,f,h,p)},[4,Kr(e.localStore,t,!0)];case 1:return i=l.sent(),o=new wl(t,i.Bn),s=o._o(i.documents),a=Jo.createSynthesizedTargetChangeForCurrentChange(n,r&&e.onlineState!=="Offline"),u=o.applyChanges(s,e.isPrimaryClient,a),co(e,n,u.To),c=new Kd(t,n,o),[2,(e.Po.set(t,c),e.Vo.has(n)?e.Vo.get(n).push(t):e.Vo.set(n,[t]),u.snapshot)]}}))}))}function Hd(e,t){return g(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(o){switch(o.label){case 0:return n=_(e),r=n.Po.get(t),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter((function(s){return!nr(s,t)}))),void n.Po.delete(t))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,un(n.localStore,r.targetId,!1).then((function(){n.sharedClientState.clearQueryState(r.targetId),Un(n.remoteStore,r.targetId),cn(n,r.targetId)})).catch(Pe)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return cn(n,r.targetId),[4,un(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}}))}))}function Qd(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o,s;return m(this,(function(a){switch(a.label){case 0:r=ws(e),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,(function(u,c){var l,f=_(u),h=Et.now(),p=c.reduce((function(d,v){return d.add(v.key)}),j());return f.persistence.runTransaction("Locally write mutations","readwrite",(function(d){return f.Mn.pn(d,p).next((function(v){l=v;for(var b=[],I=0,A=c;I<A.length;I++){var S=A[I],x=bp(S,l.get(S.key));x!=null&&b.push(new de(S.key,x,mc(x.toProto().mapValue),ut.exists(!0)))}return f._n.addMutationBatch(d,h,b,c)}))})).then((function(d){return d.applyToLocalDocumentSet(l),{batchId:d.batchId,changes:l}}))})(r.localStore,t)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),(function(u,c,l){var f=u.xo[u.currentUser.toKey()];f||(f=new ht(L)),f=f.insert(c,l),u.xo[u.currentUser.toKey()]=f})(r,i.batchId,n),[4,ve(r,i.changes)];case 3:return a.sent(),[4,mn(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=wn(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}}))}))}function bl(e,t){return g(this,void 0,void 0,(function(){var n,r;return m(this,(function(i){switch(i.label){case 0:n=_(e),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,cd(n.localStore,t)];case 2:return r=i.sent(),t.targetChanges.forEach((function(o,s){var a=n.Co.get(s);a&&(O(o.addedDocuments.size+o.modifiedDocuments.size+o.removedDocuments.size<=1),o.addedDocuments.size>0?a.bo=!0:o.modifiedDocuments.size>0?O(a.bo):o.removedDocuments.size>0&&(O(a.bo),a.bo=!1))})),[4,ve(n,r,t)];case 3:return i.sent(),[3,6];case 4:return[4,Pe(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}}))}))}function La(e,t,n){var r=_(e);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){var i=[];r.Po.forEach((function(o,s){var a=s.view.zr(t);a.snapshot&&i.push(a.snapshot)})),(function(o,s){var a=_(o);a.onlineState=s;var u=!1;a.queries.forEach((function(c,l){for(var f=0,h=l.listeners;f<h.length;f++)h[f].zr(s)&&(u=!0)})),u&&hs(a)})(r.eventManager,t),i.length&&r.vo._r(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Wd(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o,s,a,u;return m(this,(function(c){switch(c.label){case 0:return(r=_(e)).sharedClientState.updateQueryState(t,"rejected",n),i=r.Co.get(t),(o=i&&i.key)?(s=(s=new ht(C.comparator)).insert(o,ft.newNoDocument(o,P.min())),a=j().add(o),u=new Xo(P.min(),new Map,new Z(L),s,a),[4,bl(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(t),ms(r),[3,4];case 2:return[4,un(r.localStore,t,!1).then((function(){return cn(r,t,n)})).catch(Pe)];case 3:c.sent(),c.label=4;case 4:return[2]}}))}))}function Yd(e,t){return g(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(o){switch(o.label){case 0:n=_(e),r=t.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,ud(n.localStore,t)];case 2:return i=o.sent(),vs(n,r,null),ys(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,ve(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Pe(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Xd(e,t,n){return g(this,void 0,void 0,(function(){var r,i;return m(this,(function(o){switch(o.label){case 0:r=_(e),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,(function(s,a){var u=_(s);return u.persistence.runTransaction("Reject batch","readwrite-primary",(function(c){var l;return u._n.lookupMutationBatch(c,a).next((function(f){return O(f!==null),l=f.keys(),u._n.removeMutationBatch(c,f)})).next((function(){return u._n.performConsistencyCheck(c)})).next((function(){return u.Mn.pn(c,l)}))}))})(r.localStore,t)];case 2:return i=o.sent(),vs(r,t,n),ys(r,t),r.sharedClientState.updateMutationState(t,"rejected",n),[4,ve(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Pe(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}}))}))}function Jd(e,t){return g(this,void 0,void 0,(function(){var n,r,i,o,s;return m(this,(function(a){switch(a.label){case 0:ye((n=_(e)).remoteStore)||T("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(function(u){var c=_(u);return c.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(l){return c._n.getHighestUnacknowledgedBatchId(l)}))})(n.localStore)];case 2:return(r=a.sent())===-1?[2,void t.resolve()]:((i=n.Fo.get(r)||[]).push(t),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=wn(o,"Initialization of waitForPendingWrites() operation failed"),t.reject(s),[3,4];case 4:return[2]}}))}))}function ys(e,t){(e.Fo.get(t)||[]).forEach((function(n){n.resolve()})),e.Fo.delete(t)}function vs(e,t,n){var r=_(e),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(t);o&&(n?o.reject(n):o.resolve(),i=i.remove(t)),r.xo[r.currentUser.toKey()]=i}}function cn(e,t,n){n===void 0&&(n=null),e.sharedClientState.removeLocalQueryTarget(t);for(var r=0,i=e.Vo.get(t);r<i.length;r++){var o=i[r];e.Po.delete(o),n&&e.vo.Mo(o,n)}e.Vo.delete(t),e.isPrimaryClient&&e.No.Zn(t).forEach((function(s){e.No.containsKey(s)||El(e,s)}))}function El(e,t){e.So.delete(t.path.canonicalString());var n=e.Do.get(t);n!==null&&(Un(e.remoteStore,n),e.Do=e.Do.remove(t),e.Co.delete(n),ms(e))}function co(e,t,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof ml?(e.No.addReference(o.key,t),Zd(e,o)):o instanceof gl?(T("SyncEngine","Document no longer in limbo: "+o.key),e.No.removeReference(o.key,t),e.No.containsKey(o.key)||El(e,o.key)):D()}}function Zd(e,t){var n=t.key,r=n.path.canonicalString();e.Do.get(n)||e.So.has(r)||(T("SyncEngine","New document in limbo: "+n),e.So.add(r),ms(e))}function ms(e){for(;e.So.size>0&&e.Do.size<e.maxConcurrentLimboResolutions;){var t=e.So.values().next().value;e.So.delete(t);var n=new C(U.fromString(t)),r=e.ko.next();e.Co.set(r,new zd(n)),e.Do=e.Do.insert(n,r),pi(e.remoteStore,new fi(jt(er(n.path)),r,2,Nt.o))}}function ve(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o,s;return m(this,(function(a){switch(a.label){case 0:return r=_(e),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach((function(u,c){s.push(r.$o(c,t,n).then((function(l){if(l){r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,l.fromCache?"not-current":"current"),i.push(l);var f=sd.Pn(c.targetId,l);o.push(f)}})))})),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,(function(u,c){return g(this,void 0,void 0,(function(){var l,f,h,p,d,v,b,I,A;return m(this,(function(S){switch(S.label){case 0:l=_(u),S.label=1;case 1:return S.trys.push([1,3,,4]),[4,l.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(x){return E.forEach(c,(function(M){return E.forEach(M.bn,(function(B){return l.persistence.referenceDelegate.addReference(x,M.targetId,B)})).next((function(){return E.forEach(M.vn,(function(B){return l.persistence.referenceDelegate.removeReference(x,M.targetId,B)}))}))}))}))];case 2:return S.sent(),[3,4];case 3:if(!xe(f=S.sent()))throw f;return T("LocalStore","Failed to update sequence numbers: "+f),[3,4];case 4:for(h=0,p=c;h<p.length;h++)d=p[h],v=d.targetId,d.fromCache||(b=l.Fn.get(v),I=b.snapshotVersion,A=b.withLastLimboFreeSnapshotVersion(I),l.Fn=l.Fn.insert(v,A));return[2]}}))}))})(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}}))}))}function ty(e,t){return g(this,void 0,void 0,(function(){var n,r;return m(this,(function(i){switch(i.label){case 0:return(n=_(e)).currentUser.isEqual(t)?[3,3]:(T("SyncEngine","User change. New user:",t.toKey()),[4,il(n.localStore,t)]);case 1:return r=i.sent(),n.currentUser=t,(function(o,s){o.Fo.forEach((function(a){a.forEach((function(u){u.reject(new w(y.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),o.Fo.clear()})(n),n.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),[4,ve(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))}function ey(e,t){var n=_(e),r=n.Co.get(t);if(r&&r.bo)return j().add(r.key);var i=j(),o=n.Vo.get(t);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=a[s],c=n.Po.get(u);i=i.unionWith(c.view.wo)}return i}function ny(e,t){return g(this,void 0,void 0,(function(){var n,r,i;return m(this,(function(o){switch(o.label){case 0:return[4,Kr((n=_(e)).localStore,t.query,!0)];case 1:return r=o.sent(),i=t.view.Ao(r),[2,(n.isPrimaryClient&&co(n,t.targetId,i.To),i)]}}))}))}function ry(e){return g(this,void 0,void 0,(function(){var t;return m(this,(function(n){return[2,al((t=_(e)).localStore).then((function(r){return ve(t,r)}))]}))}))}function iy(e,t,n,r){return g(this,void 0,void 0,(function(){var i,o;return m(this,(function(s){switch(s.label){case 0:return[4,(function(a,u){var c=_(a),l=_(c._n);return c.persistence.runTransaction("Lookup mutation documents","readonly",(function(f){return l.jt(f,u).next((function(h){return h?c.Mn.pn(f,h):E.resolve(null)}))}))})((i=_(e)).localStore,t)];case 1:return(o=s.sent())===null?[3,6]:n!=="pending"?[3,3]:[4,mn(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:n==="acknowledged"||n==="rejected"?(vs(i,t,r||null),ys(i,t),(function(a,u){_(_(a)._n).Gt(u)})(i.localStore,t)):D(),s.label=4;case 4:return[4,ve(i,o)];case 5:return s.sent(),[3,7];case 6:T("SyncEngine","Cannot apply mutation batch with id: "+t),s.label=7;case 7:return[2]}}))}))}function oy(e,t){return g(this,void 0,void 0,(function(){var n,r,i,o,s,a,u,c;return m(this,(function(l){switch(l.label){case 0:return gs(n=_(e)),ws(n),t!==!0||n.Oo===!0?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,Ma(n,r.toArray())]);case 1:return i=l.sent(),n.Oo=!0,[4,uo(n.remoteStore,!0)];case 2:for(l.sent(),o=0,s=i;o<s.length;o++)a=s[o],pi(n.remoteStore,a);return[3,7];case 3:return t!==!1||n.Oo===!1?[3,7]:(u=[],c=Promise.resolve(),n.Vo.forEach((function(f,h){n.sharedClientState.isLocalQueryTarget(h)?u.push(h):c=c.then((function(){return cn(n,h),un(n.localStore,h,!0)})),Un(n.remoteStore,h)})),[4,c]);case 4:return l.sent(),[4,Ma(n,u)];case 5:return l.sent(),(function(f){var h=_(f);h.Co.forEach((function(p,d){Un(h.remoteStore,d)})),h.No.ts(),h.Co=new Map,h.Do=new ht(C.comparator)})(n),n.Oo=!1,[4,uo(n.remoteStore,!1)];case 6:l.sent(),l.label=7;case 7:return[2]}}))}))}function Ma(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,l,f,h,p,d,v,b;return m(this,(function(I){switch(I.label){case 0:r=_(e),i=[],o=[],s=0,a=t,I.label=1;case 1:return s<a.length?(u=a[s],c=void 0,(l=r.Vo.get(u))&&l.length!==0?[4,jr(r.localStore,jt(l[0]))]:[3,7]):[3,13];case 2:c=I.sent(),f=0,h=l,I.label=3;case 3:return f<h.length?(p=h[f],d=r.Po.get(p),[4,ny(r,d)]):[3,6];case 4:(v=I.sent()).snapshot&&o.push(v.snapshot),I.label=5;case 5:return f++,[3,3];case 6:return[3,11];case 7:return[4,sl(r.localStore,u)];case 8:return b=I.sent(),[4,jr(r.localStore,b)];case 9:return c=I.sent(),[4,ds(r,Il(b),u,!1)];case 10:I.sent(),I.label=11;case 11:i.push(c),I.label=12;case 12:return s++,[3,1];case 13:return[2,(r.vo._r(o),i)]}}))}))}function Il(e){return wc(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function sy(e){var t=_(e);return _(_(t.localStore).persistence).fn()}function ay(e,t,n,r){return g(this,void 0,void 0,(function(){var i,o,s;return m(this,(function(a){switch(a.label){case 0:return(i=_(e)).Oo?(T("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(t))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,al(i.localStore)];case 3:return o=a.sent(),s=Xo.createSynthesizedRemoteEventForCurrentChange(t,n==="current"),[4,ve(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,un(i.localStore,t,!0)];case 6:return a.sent(),cn(i,t,r),[3,8];case 7:D(),a.label=8;case 8:return[2]}}))}))}function uy(e,t,n){return g(this,void 0,void 0,(function(){var r,i,o,s,a,u,c,l,f,h;return m(this,(function(p){switch(p.label){case 0:if(!(r=gs(e)).Oo)return[3,10];i=0,o=t,p.label=1;case 1:return i<o.length?(s=o[i],r.Vo.has(s)?(T("SyncEngine","Adding an already active target "+s),[3,5]):[4,sl(r.localStore,s)]):[3,6];case 2:return a=p.sent(),[4,jr(r.localStore,a)];case 3:return u=p.sent(),[4,ds(r,Il(a),u.targetId,!1)];case 4:p.sent(),pi(r.remoteStore,u),p.label=5;case 5:return i++,[3,1];case 6:c=function(d){return m(this,(function(v){switch(v.label){case 0:return r.Vo.has(d)?[4,un(r.localStore,d,!1).then((function(){Un(r.remoteStore,d),cn(r,d)})).catch(Pe)]:[3,2];case 1:v.sent(),v.label=2;case 2:return[2]}}))},l=0,f=n,p.label=7;case 7:return l<f.length?(h=f[l],[5,c(h)]):[3,10];case 8:p.sent(),p.label=9;case 9:return l++,[3,7];case 10:return[2]}}))}))}function gs(e){var t=_(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=bl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=ey.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Wd.bind(null,t),t.vo._r=Bd.bind(null,t.eventManager),t.vo.Mo=jd.bind(null,t.eventManager),t}function ws(e){var t=_(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Yd.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Xd.bind(null,t),t}var Tl=(function(){function e(){this.synchronizeTabs=!1}return e.prototype.initialize=function(t){return g(this,void 0,void 0,(function(){return m(this,(function(n){switch(n.label){case 0:return this.R=hi(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return n.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}}))}))},e.prototype.Uo=function(t){return null},e.prototype.Qo=function(t){return rl(this.persistence,new nl,t.initialUser,this.R)},e.prototype.qo=function(t){return new gd(bd.bs,this.R)},e.prototype.Bo=function(t){return new ul},e.prototype.terminate=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}}))}))},e})(),_l=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).Ko=n,o.cacheSizeBytes=r,o.forceOwnership=i,o.synchronizeTabs=!1,o}return k(t,e),t.prototype.initialize=function(n){return g(this,void 0,void 0,(function(){return m(this,(function(r){switch(r.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return r.sent(),[4,hd(this.localStore)];case 2:return r.sent(),[4,this.Ko.initialize(this,n)];case 3:return r.sent(),[4,ws(this.Ko.syncEngine)];case 4:return r.sent(),[4,mn(this.Ko.remoteStore)];case 5:return r.sent(),[2]}}))}))},t.prototype.Qo=function(n){return rl(this.persistence,new nl,n.initialUser,this.R)},t.prototype.Uo=function(n){var r=this.persistence.referenceDelegate.garbageCollector;return new Zp(r,n.asyncQueue)},t.prototype.qo=function(n){var r=is(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?Vt.withCacheSize(this.cacheSizeBytes):Vt.DEFAULT;return new od(this.synchronizeTabs,r,n.clientId,i,n.asyncQueue,cl(),Ir(),this.R,this.sharedClientState,!!this.forceOwnership)},t.prototype.Bo=function(n){return new ul},t})(Tl),cy=(function(e){function t(n,r){var i=this;return(i=e.call(this,n,r,!1)||this).Ko=n,i.cacheSizeBytes=r,i.synchronizeTabs=!0,i}return k(t,e),t.prototype.initialize=function(n){return g(this,void 0,void 0,(function(){var r,i=this;return m(this,(function(o){switch(o.label){case 0:return[4,e.prototype.initialize.call(this,n)];case 1:return o.sent(),r=this.Ko.syncEngine,this.sharedClientState instanceof Fi?(this.sharedClientState.syncEngine={ui:iy.bind(null,r),ai:ay.bind(null,r),hi:uy.bind(null,r),fn:sy.bind(null,r),ci:ry.bind(null,r)},[4,this.sharedClientState.start()]):[3,3];case 2:o.sent(),o.label=3;case 3:return[4,this.persistence.He((function(s){return g(i,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,oy(this.Ko.syncEngine,s)];case 1:return a.sent(),this.gcScheduler&&(s&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):s||this.gcScheduler.stop()),[2]}}))}))}))];case 4:return o.sent(),[2]}}))}))},t.prototype.Bo=function(n){var r=cl();if(!Fi.yt(r))throw new w(y.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var i=is(n.databaseInfo.databaseId,n.databaseInfo.persistenceKey);return new Fi(r,n.asyncQueue,i,n.clientId,n.initialUser)},t})(_l),lo=(function(){function e(){}return e.prototype.initialize=function(t,n){return g(this,void 0,void 0,(function(){var r=this;return m(this,(function(i){switch(i.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(o){return La(r.syncEngine,o,1)},this.remoteStore.remoteSyncer.handleCredentialChange=ty.bind(null,this.syncEngine),[4,uo(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:i.sent(),i.label=2;case 2:return[2]}}))}))},e.prototype.createEventManager=function(t){return new qd},e.prototype.createDatastore=function(t){var n,r=hi(t.databaseInfo.databaseId),i=(n=t.databaseInfo,new Sd(n));return(function(o,s,a){return new Dd(o,s,a)})(t.credentials,i,r)},e.prototype.createRemoteStore=function(t){var n,r,i,o,s,a=this;return n=this.localStore,r=this.datastore,i=t.asyncQueue,o=function(u){return La(a.syncEngine,u,0)},s=xa.yt()?new xa:new Id,new kd(n,r,i,o,s)},e.prototype.createSyncEngine=function(t,n){return(function(r,i,o,s,a,u,c){var l=new Gd(r,i,o,s,a,u);return c&&(l.Oo=!0),l})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,n)},e.prototype.terminate=function(){return(function(t){return g(this,void 0,void 0,(function(){var n;return m(this,(function(r){switch(r.label){case 0:return n=_(t),T("RemoteStore","RemoteStore shutting down."),n.$r.add(5),[4,vn(n)];case 1:return r.sent(),n.Lr.shutdown(),n.Br.set("Unknown"),[2]}}))}))})(this.remoteStore)},e})();var di=(function(){function e(t){this.observer=t,this.muted=!1}return e.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},e.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},e.prototype.Wo=function(){this.muted=!0},e.prototype.jo=function(t,n){var r=this;this.muted||setTimeout((function(){r.muted||t(n)}),0)},e})(),ly=(function(){function e(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return e.prototype.lookup=function(t){return g(this,void 0,void 0,(function(){var n,r=this;return m(this,(function(i){switch(i.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new w(y.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,(function(o,s){return g(this,void 0,void 0,(function(){var a,u,c,l,f,h;return m(this,(function(p){switch(p.label){case 0:return a=_(o),u=Vn(a.R)+"/documents",c={documents:s.map((function(d){return Fn(a.R,d)}))},[4,a.Oi("BatchGetDocuments",u,c)];case 1:return l=p.sent(),f=new Map,l.forEach((function(d){var v=(function(b,I){return"found"in I?(function(A,S){O(!!S.found),S.found.name,S.found.updateTime;var x=Gt(A,S.found.name),M=mt(S.found.updateTime),B=new At({mapValue:{fields:S.found.fields}});return ft.newFoundDocument(x,M,B)})(b,I):"missing"in I?(function(A,S){O(!!S.missing),O(!!S.readTime);var x=Gt(A,S.missing),M=mt(S.readTime);return ft.newNoDocument(x,M)})(b,I):D()})(a.R,d);f.set(v.key.toString(),v)})),h=[],[2,(s.forEach((function(d){var v=f.get(d.toString());O(!!v),h.push(v)})),h)]}}))}))})(this.datastore,t)];case 1:return[2,((n=i.sent()).forEach((function(o){return r.recordVersion(o)})),n)]}}))}))},e.prototype.set=function(t,n){this.write(n.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.update=function(t,n){try{this.write(n.toMutation(t,this.preconditionForUpdate(t)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(t.toString())},e.prototype.delete=function(t){this.write(new sr(t,this.precondition(t))),this.writtenDocs.add(t.toString())},e.prototype.commit=function(){return g(this,void 0,void 0,(function(){var t,n=this;return m(this,(function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach((function(i){t.delete(i.key.toString())})),t.forEach((function(i,o){var s=C.fromPath(o);n.mutations.push(new Yo(s,n.precondition(s)))})),[4,(function(i,o){return g(this,void 0,void 0,(function(){var s,a,u;return m(this,(function(c){switch(c.label){case 0:return s=_(i),a=Vn(s.R)+"/documents",u={writes:o.map((function(l){return Ur(s.R,l)}))},[4,s.Ni("Commit",a,u)];case 1:return c.sent(),[2]}}))}))})(this.datastore,this.mutations)];case 1:return r.sent(),this.committed=!0,[2]}}))}))},e.prototype.recordVersion=function(t){var n;if(t.isFoundDocument())n=t.version;else{if(!t.isNoDocument())throw D();n=P.min()}var r=this.readVersions.get(t.key.toString());if(r){if(!n.isEqual(r))throw new w(y.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),n)},e.prototype.precondition=function(t){var n=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&n?ut.updateTime(n):ut.none()},e.prototype.preconditionForUpdate=function(t){var n=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&n){if(n.isEqual(P.min()))throw new w(y.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ut.updateTime(n)}return ut.exists(!0)},e.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},e.prototype.ensureCommitNotCalled=function(){},e})(),fy=(function(){function e(t,n,r,i){this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.ec=5,this.Zi=new ss(this.asyncQueue,"transaction_retry")}return e.prototype.run=function(){this.nc()},e.prototype.nc=function(){var t=this;this.Zi.ji((function(){return g(t,void 0,void 0,(function(){var n,r,i=this;return m(this,(function(o){return n=new ly(this.datastore),(r=this.sc(n))&&r.then((function(s){i.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){i.deferred.resolve(s)})).catch((function(a){i.ic(a)}))}))})).catch((function(s){i.ic(s)})),[2]}))}))}))},e.prototype.sc=function(t){try{var n=this.updateFunction(t);return!Re(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(r){return this.deferred.reject(r),null}},e.prototype.ic=function(t){var n=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget((function(){return n.nc(),Promise.resolve()}))):this.deferred.reject(t)},e.prototype.rc=function(t){if(t.name==="FirebaseError"){var n=t.code;return n==="aborted"||n==="failed-precondition"||!Oc(n)}return!1},e})(),hy=(function(){function e(t,n,r){var i=this;this.credentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=wt.UNAUTHENTICATED,this.clientId=fc.u(),this.credentialListener=function(){},this.receivedInitialUser=new Rt,this.credentials.setChangeListener((function(o){T("FirestoreClient","Received user=",o.uid),i.user=o,i.credentialListener(o),i.receivedInitialUser.resolve()}))}return e.prototype.getConfiguration=function(){return g(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return[4,this.receivedInitialUser.promise];case 1:return[2,(t.sent(),{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100})]}}))}))},e.prototype.setCredentialChangeListener=function(t){var n=this;this.credentialListener=t,this.receivedInitialUser.promise.then((function(){return n.credentialListener(n.user)}))},e.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new w(y.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var n=new Rt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((function(){return g(t,void 0,void 0,(function(){var r,i;return m(this,(function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:o.sent(),o.label=4;case 4:return this.credentials.removeChangeListener(),n.resolve(),[3,6];case 5:return r=o.sent(),i=wn(r,"Failed to shutdown persistence"),n.reject(i),[3,6];case 6:return[2]}}))}))})),n.promise},e})();function Sl(e,t){return g(this,void 0,void 0,(function(){var n,r,i=this;return m(this,(function(o){switch(o.label){case 0:return e.asyncQueue.verifyOperationInProgress(),T("FirestoreClient","Initializing OfflineComponentProvider"),[4,e.getConfiguration()];case 1:return n=o.sent(),[4,t.initialize(n)];case 2:return o.sent(),r=n.initialUser,e.setCredentialChangeListener((function(s){r.isEqual(s)||(r=s,e.asyncQueue.enqueueRetryable((function(){return g(i,void 0,void 0,(function(){return m(this,(function(a){switch(a.label){case 0:return[4,il(t.localStore,s)];case 1:return a.sent(),[2]}}))}))})))})),t.persistence.setDatabaseDeletedListener((function(){return e.terminate()})),e.offlineComponents=t,[2]}}))}))}function Al(e,t){return g(this,void 0,void 0,(function(){var n,r;return m(this,(function(i){switch(i.label){case 0:return e.asyncQueue.verifyOperationInProgress(),[4,bs(e)];case 1:return n=i.sent(),T("FirestoreClient","Initializing OnlineComponentProvider"),[4,e.getConfiguration()];case 2:return r=i.sent(),[4,t.initialize(n,r)];case 3:return i.sent(),e.setCredentialChangeListener((function(o){return e.asyncQueue.enqueueRetryable((function(){return(function(s,a){return g(this,void 0,void 0,(function(){var u,c;return m(this,(function(l){switch(l.label){case 0:return(u=_(s)).asyncQueue.verifyOperationInProgress(),T("RemoteStore","RemoteStore received new credentials"),c=ye(u),u.$r.add(3),[4,vn(u)];case 1:return l.sent(),c&&u.Br.set("Unknown"),[4,u.remoteSyncer.handleCredentialChange(a)];case 2:return l.sent(),u.$r.delete(3),[4,ar(u)];case 3:return l.sent(),[2]}}))}))})(t.remoteStore,o)}))})),e.onlineComponents=t,[2]}}))}))}function bs(e){return g(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return e.offlineComponents?[3,2]:(T("FirestoreClient","Using default OfflineComponentProvider"),[4,Sl(e,new Tl)]);case 1:t.sent(),t.label=2;case 2:return[2,e.offlineComponents]}}))}))}function yi(e){return g(this,void 0,void 0,(function(){return m(this,(function(t){switch(t.label){case 0:return e.onlineComponents?[3,2]:(T("FirestoreClient","Using default OnlineComponentProvider"),[4,Al(e,new lo)]);case 1:t.sent(),t.label=2;case 2:return[2,e.onlineComponents]}}))}))}function Fa(e){return bs(e).then((function(t){return t.persistence}))}function Nl(e){return bs(e).then((function(t){return t.localStore}))}function Va(e){return yi(e).then((function(t){return t.remoteStore}))}function Dl(e){return yi(e).then((function(t){return t.syncEngine}))}function ln(e){return g(this,void 0,void 0,(function(){var t,n;return m(this,(function(r){switch(r.label){case 0:return[4,yi(e)];case 1:return t=r.sent(),[2,((n=t.eventManager).onListen=$d.bind(null,t.syncEngine),n.onUnlisten=Hd.bind(null,t.syncEngine),n)]}}))}))}function Ua(e,t,n){var r=this;n===void 0&&(n={});var i=new Rt;return e.asyncQueue.enqueueAndForget((function(){return g(r,void 0,void 0,(function(){var o;return m(this,(function(s){switch(s.label){case 0:return o=function(a,u,c,l,f){var h=new di({next:function(d){u.enqueueAndForget((function(){return fs(a,p)}));var v=d.docs.has(c);!v&&d.fromCache?f.reject(new w(y.UNAVAILABLE,"Failed to get document because the client is offline.")):v&&d.fromCache&&l&&l.source==="server"?f.reject(new w(y.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(d)},error:function(d){return f.reject(d)}}),p=new ps(er(c.path),h,{includeMetadataChanges:!0,so:!0});return ls(a,p)},[4,ln(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}}))}))})),i.promise}function qa(e,t,n){var r=this;n===void 0&&(n={});var i=new Rt;return e.asyncQueue.enqueueAndForget((function(){return g(r,void 0,void 0,(function(){var o;return m(this,(function(s){switch(s.label){case 0:return o=function(a,u,c,l,f){var h=new di({next:function(d){u.enqueueAndForget((function(){return fs(a,p)})),d.fromCache&&l.source==="server"?f.reject(new w(y.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(d)},error:function(d){return f.reject(d)}}),p=new ps(c,h,{includeMetadataChanges:!0,so:!0});return ls(a,p)},[4,ln(e)];case 1:return[2,o.apply(void 0,[s.sent(),e.asyncQueue,t,n,i])]}}))}))})),i.promise}var py=(function(e,t,n,r,i,o,s){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s}),$r=(function(){function e(t,n){this.projectId=t,this.database=n||"(default)"}return Object.defineProperty(e.prototype,"isDefaultDatabase",{get:function(){return this.database==="(default)"},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database},e})(),Ba=new Map,Cl=function(e,t){this.user=t,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+e},ja=(function(){function e(){this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(null)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t){this.changeListener=t,t(wt.UNAUTHENTICATED)},e.prototype.removeChangeListener=function(){this.changeListener=null},e})(),dy=(function(){function e(t){this.token=t,this.changeListener=null}return e.prototype.getToken=function(){return Promise.resolve(this.token)},e.prototype.invalidateToken=function(){},e.prototype.setChangeListener=function(t){this.changeListener=t,t(this.token.user)},e.prototype.removeChangeListener=function(){this.changeListener=null},e})(),yy=(function(){function e(t){var n=this;this.oc=null,this.currentUser=wt.UNAUTHENTICATED,this.receivedInitialUser=!1,this.cc=0,this.changeListener=null,this.forceRefresh=!1,this.oc=function(){n.cc++,n.currentUser=n.uc(),n.receivedInitialUser=!0,n.changeListener&&n.changeListener(n.currentUser)},this.cc=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.oc):(this.oc(null),t.get().then((function(r){n.auth=r,n.oc&&n.auth.addAuthTokenListener(n.oc)}),(function(){})))}return e.prototype.getToken=function(){var t=this,n=this.cc,r=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(r).then((function(i){return t.cc!==n?(T("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):i?(O(typeof i.accessToken=="string"),new Cl(i.accessToken,t.currentUser)):null})):Promise.resolve(null)},e.prototype.invalidateToken=function(){this.forceRefresh=!0},e.prototype.setChangeListener=function(t){this.changeListener=t,this.receivedInitialUser&&t(this.currentUser)},e.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.oc),this.oc=null,this.changeListener=null},e.prototype.uc=function(){var t=this.auth&&this.auth.getUid();return O(t===null||typeof t=="string"),new wt(t)},e})(),vy=(function(){function e(t,n,r){this.ac=t,this.hc=n,this.lc=r,this.type="FirstParty",this.user=wt.FIRST_PARTY}return Object.defineProperty(e.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.hc},n=this.ac.auth.getAuthHeaderValueForFirstParty([]);return n&&(t.Authorization=n),this.lc&&(t["X-Goog-Iam-Authorization-Token"]=this.lc),t},enumerable:!1,configurable:!0}),e})(),my=(function(){function e(t,n,r){this.ac=t,this.hc=n,this.lc=r}return e.prototype.getToken=function(){return Promise.resolve(new vy(this.ac,this.hc,this.lc))},e.prototype.setChangeListener=function(t){t(wt.FIRST_PARTY)},e.prototype.removeChangeListener=function(){},e.prototype.invalidateToken=function(){},e})();function Es(e,t,n){if(!n)throw new w(y.INVALID_ARGUMENT,"Function "+e+"() cannot be called with an empty "+t+".")}function Is(e,t){if(t===void 0)return{merge:!1};if(t.mergeFields!==void 0&&t.merge!==void 0)throw new w(y.INVALID_ARGUMENT,"Invalid options passed to function "+e+'(): You cannot specify both "merge" and "mergeFields".');return t}function kl(e,t,n,r){if(t===!0&&r===!0)throw new w(y.INVALID_ARGUMENT,e+" and "+n+" cannot be used together.")}function Ka(e){if(!C.isDocumentKey(e))throw new w(y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e+" has "+e.length+".")}function za(e){if(C.isDocumentKey(e))throw new w(y.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e+" has "+e.length+".")}function vi(e){if(e===void 0)return"undefined";if(e===null)return"null";if(typeof e=="string")return e.length>20&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if(typeof e=="number"||typeof e=="boolean")return""+e;if(typeof e=="object"){if(e instanceof Array)return"an array";var t=(function(n){if(n.constructor){var r=/function\s+([^\s(]+)\s*\(/.exec(n.constructor.toString());if(r&&r.length>1)return r[1]}return null})(e);return t?"a custom "+t+" object":"an object"}return typeof e=="function"?"a function":D()}function q(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new w(y.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=vi(e);throw new w(y.INVALID_ARGUMENT,"Expected type '"+t.name+"', but it was: "+n)}return e}function Ga(e,t){if(t<=0)throw new w(y.INVALID_ARGUMENT,"Function "+e+"() requires a positive number, but it was: "+t+".")}var $a=(function(){function e(t){var n;if(t.host===void 0){if(t.ssl!==void 0)throw new w(y.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(n=t.ssl)===null||n===void 0||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new w(y.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,kl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return e.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},e})(),qn=(function(){function e(t,n){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $a({}),this._settingsFrozen=!1,t instanceof $r?(this._databaseId=t,this._credentials=new ja):(this._app=t,this._databaseId=(function(r){if(!Object.prototype.hasOwnProperty.apply(r.options,["projectId"]))throw new w(y.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $r(r.options.projectId)})(t),this._credentials=new yy(n))}return Object.defineProperty(e.prototype,"app",{get:function(){if(!this._app)throw new w(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_terminated",{get:function(){return this._terminateTask!==void 0},enumerable:!1,configurable:!0}),e.prototype._setSettings=function(t){if(this._settingsFrozen)throw new w(y.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $a(t),t.credentials!==void 0&&(this._credentials=(function(n){if(!n)return new ja;switch(n.type){case"gapi":var r=n.client;return O(!(typeof r!="object"||r===null||!r.auth||!r.auth.getAuthHeaderValueForFirstParty)),new my(r,n.sessionIndex||"0",n.iamToken||null);case"provider":return n.client;default:throw new w(y.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}})(t.credentials))},e.prototype._getSettings=function(){return this._settings},e.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},e.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},e.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},e.prototype._terminate=function(){return t=this,(n=Ba.get(t))&&(T("ComponentProvider","Removing Datastore"),Ba.delete(t),n.terminate()),Promise.resolve();var t,n},e})(),G=(function(){function e(t,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=t}return Object.defineProperty(e.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new ae(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._key)},e})(),Ct=(function(){function e(t,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=t}return e.prototype.withConverter=function(t){return new e(this.firestore,t,this._query)},e})(),ae=(function(e){function t(n,r,i){var o=this;return(o=e.call(this,n,r,er(i))||this)._path=i,o.type="collection",o}return k(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._path.popLast();return n.isEmpty()?null:new G(this.firestore,null,new C(n))},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(n){return new t(this.firestore,n,this._path)},t})(Ct);function Ol(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=X(e),Es("collection","path",t),e instanceof qn)return za(n=U.fromString.apply(U,H([t],r))),new ae(e,null,n);if(!(e instanceof G||e instanceof ae))throw new w(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return za(n=U.fromString.apply(U,H([e.path],r)).child(U.fromString(t))),new ae(e.firestore,null,n)}function Tr(e,t){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(e=X(e),arguments.length===1&&(t=fc.u()),Es("doc","path",t),e instanceof qn)return Ka(n=U.fromString.apply(U,H([t],r))),new G(e,null,new C(n));if(!(e instanceof G||e instanceof ae))throw new w(y.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ka(n=e._path.child(U.fromString.apply(U,H([t],r)))),new G(e.firestore,e instanceof ae?e.converter:null,new C(n))}function Rl(e,t){return e=X(e),t=X(t),(e instanceof G||e instanceof ae)&&(t instanceof G||t instanceof ae)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function xl(e,t){return e=X(e),t=X(t),e instanceof Ct&&t instanceof Ct&&e.firestore===t.firestore&&nr(e._query,t._query)&&e.converter===t.converter}var gy=(function(){function e(){var t=this;this.fc=Promise.resolve(),this.dc=[],this.wc=!1,this._c=[],this.mc=null,this.yc=!1,this.gc=[],this.Zi=new ss(this,"async_queue_retry"),this.Ec=function(){var r=Ir();r&&T("AsyncQueue","Visibility state changed to "+r.visibilityState),t.Zi.Gi()};var n=Ir();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Ec)}return Object.defineProperty(e.prototype,"isShuttingDown",{get:function(){return this.wc},enumerable:!1,configurable:!0}),e.prototype.enqueueAndForget=function(t){this.enqueue(t)},e.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Tc(),this.Ic(t)},e.prototype.enterRestrictedMode=function(){if(!this.wc){this.wc=!0;var t=Ir();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Ec)}},e.prototype.enqueue=function(t){return this.Tc(),this.wc?new Promise((function(n){})):this.Ic(t)},e.prototype.enqueueRetryable=function(t){var n=this;this.enqueueAndForget((function(){return n.dc.push(t),n.Ac()}))},e.prototype.Ac=function(){return g(this,void 0,void 0,(function(){var t,n=this;return m(this,(function(r){switch(r.label){case 0:if(this.dc.length===0)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.dc[0]()];case 2:return r.sent(),this.dc.shift(),this.Zi.reset(),[3,4];case 3:if(!xe(t=r.sent()))throw t;return T("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.dc.length>0&&this.Zi.ji((function(){return n.Ac()})),r.label=5;case 5:return[2]}}))}))},e.prototype.Ic=function(t){var n=this,r=this.fc.then((function(){return n.yc=!0,t().catch((function(i){throw n.mc=i,n.yc=!1,Y("INTERNAL UNHANDLED ERROR: ",(function(o){var s=o.message||"";return o.stack&&(s=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),s})(i)),i})).then((function(i){return n.yc=!1,i}))}));return this.fc=r,r},e.prototype.enqueueAfterDelay=function(t,n,r){var i=this;this.Tc(),this.gc.indexOf(t)>-1&&(n=0);var o=Vd.createAndSchedule(this,t,n,r,(function(s){return i.Rc(s)}));return this._c.push(o),o},e.prototype.Tc=function(){this.mc&&D()},e.prototype.verifyOperationInProgress=function(){},e.prototype.bc=function(){return g(this,void 0,void 0,(function(){var t;return m(this,(function(n){switch(n.label){case 0:return[4,t=this.fc];case 1:n.sent(),n.label=2;case 2:if(t!==this.fc)return[3,0];n.label=3;case 3:return[2]}}))}))},e.prototype.vc=function(t){for(var n=0,r=this._c;n<r.length;n++)if(r[n].timerId===t)return!0;return!1},e.prototype.Pc=function(t){var n=this;return this.bc().then((function(){n._c.sort((function(s,a){return s.targetTimeMs-a.targetTimeMs}));for(var r=0,i=n._c;r<i.length;r++){var o=i[r];if(o.skipDelay(),t!=="all"&&o.timerId===t)break}return n.bc()}))},e.prototype.Vc=function(t){this.gc.push(t)},e.prototype.Rc=function(t){var n=this._c.indexOf(t);this._c.splice(n,1)},e})();function fn(e){return(function(t,n){if(typeof t!="object"||t===null)return!1;for(var r=t,i=0,o=["next","error","complete"];i<o.length;i++){var s=o[i];if(s in r&&typeof r[s]=="function")return!0}return!1})(e)}var wy=-1,J=(function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).type="firestore",i._queue=new gy,i._persistenceKey="name"in n?n.name:"[DEFAULT]",i}return k(t,e),t.prototype._terminate=function(){return this._firestoreClient||Pl(this),this._firestoreClient.terminate()},t})(qn);function at(e){return e._firestoreClient||Pl(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function Pl(e){var t,n=e._freezeSettings(),r=(function(i,o,s,a){return new py(i,o,s,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling)})(e._databaseId,((t=e._app)===null||t===void 0?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new hy(e._credentials,e._queue,r)}function Ha(e,t,n){var r=this,i=new Rt;return e.asyncQueue.enqueue((function(){return g(r,void 0,void 0,(function(){var o;return m(this,(function(s){switch(s.label){case 0:return s.trys.push([0,3,,4]),[4,Sl(e,n)];case 1:return s.sent(),[4,Al(e,t)];case 2:return s.sent(),i.resolve(),[3,4];case 3:if(!(function(a){return a.name==="FirebaseError"?a.code===y.FAILED_PRECONDITION||a.code===y.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(o=s.sent()))throw o;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),i.reject(o),[3,4];case 4:return[2]}}))}))})).then((function(){return i.promise}))}function Qa(e){if(e._initialized||e._terminated)throw new w(y.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var qt=(function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=0;r<t.length;++r)if(t[r].length===0)throw new w(y.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new xt(t)}return e.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},e})(),ke=(function(){function e(t){this._byteString=t}return e.fromBase64String=function(t){try{return new e(It.fromBase64String(t))}catch(n){throw new w(y.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}},e.fromUint8Array=function(t){return new e(It.fromUint8Array(t))},e.prototype.toBase64=function(){return this._byteString.toBase64()},e.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},e.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},e.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},e})(),Le=(function(e){this._methodName=e}),mi=(function(){function e(t,n){if(!isFinite(t)||t<-90||t>90)throw new w(y.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new w(y.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return Object.defineProperty(e.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),e.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},e.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},e.prototype._compareTo=function(t){return L(this._lat,t._lat)||L(this._long,t._long)},e})(),by=/^__.*__$/,Ey=(function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return this.fieldMask!==null?new de(t,this.data,this.fieldMask,n,this.fieldTransforms):new or(t,this.data,n,this.fieldTransforms)},e})(),Ll=(function(){function e(t,n,r){this.data=t,this.fieldMask=n,this.fieldTransforms=r}return e.prototype.toMutation=function(t,n){return new de(t,this.data,this.fieldMask,n,this.fieldTransforms)},e})();function Ml(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw D()}}var Fl=(function(){function e(t,n,r,i,o,s){this.settings=t,this.databaseId=n,this.R=r,this.ignoreUndefinedProperties=i,o===void 0&&this.Sc(),this.fieldTransforms=o||[],this.fieldMask=s||[]}return Object.defineProperty(e.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Dc",{get:function(){return this.settings.Dc},enumerable:!1,configurable:!0}),e.prototype.Cc=function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},e.prototype.Nc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.Cc({path:r,xc:!1});return i.Fc(t),i},e.prototype.kc=function(t){var n,r=(n=this.path)===null||n===void 0?void 0:n.child(t),i=this.Cc({path:r,xc:!1});return i.Sc(),i},e.prototype.Oc=function(t){return this.Cc({path:void 0,xc:!0})},e.prototype.$c=function(t){return Hr(t,this.settings.methodName,this.settings.Mc||!1,this.path,this.settings.Lc)},e.prototype.contains=function(t){return this.fieldMask.find((function(n){return t.isPrefixOf(n)}))!==void 0||this.fieldTransforms.find((function(n){return t.isPrefixOf(n.field)}))!==void 0},e.prototype.Sc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fc(this.path.get(t))},e.prototype.Fc=function(t){if(t.length===0)throw this.$c("Document fields must not be empty");if(Ml(this.Dc)&&by.test(t))throw this.$c('Document fields cannot begin and end with "__"')},e})(),Iy=(function(){function e(t,n,r){this.databaseId=t,this.ignoreUndefinedProperties=n,this.R=r||hi(t)}return e.prototype.Bc=function(t,n,r,i){return i===void 0&&(i=!1),new Fl({Dc:t,methodName:n,Lc:r,path:xt.emptyPath(),xc:!1,Mc:i},this.databaseId,this.R,this.ignoreUndefinedProperties)},e})();function Me(e){var t=e._freezeSettings(),n=hi(e._databaseId);return new Iy(e._databaseId,!!t.ignoreUndefinedProperties,n)}function gi(e,t,n,r,i,o){o===void 0&&(o={});var s=e.Bc(o.merge||o.mergeFields?2:0,t,n,i);As("Data must be an object, but it was:",s,r);var a,u,c=ql(r,s);if(o.merge)a=new Ye(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var l=[],f=0,h=o.mergeFields;f<h.length;f++){var p=fo(t,h[f],n);if(!s.contains(p))throw new w(y.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");jl(l,p)||l.push(p)}a=new Ye(l),u=s.fieldTransforms.filter((function(d){return a.covers(d.field)}))}else a=null,u=s.fieldTransforms;return new Ey(new At(c),a,u)}var Ts=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype._toFieldTransform=function(n){if(n.Dc!==2)throw n.Dc===1?n.$c(this._methodName+"() can only appear at the top level of your update data"):n.$c(this._methodName+"() cannot be used with set() unless you pass {merge:true}");return n.fieldMask.push(n.path),null},t.prototype.isEqual=function(n){return n instanceof t},t})(Le);function Vl(e,t,n){return new Fl({Dc:3,Lc:t.settings.Lc,methodName:e._methodName,xc:n},t.databaseId,t.R,t.ignoreUndefinedProperties)}var Ty=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype._toFieldTransform=function(n){return new ir(n.path,new tn)},t.prototype.isEqual=function(n){return n instanceof t},t})(Le),_y=(function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).qc=r,i}return k(t,e),t.prototype._toFieldTransform=function(n){var r=Vl(this,n,!0),i=this.qc.map((function(s){return Fe(s,r)})),o=new De(i);return new ir(n.path,o)},t.prototype.isEqual=function(n){return this===n},t})(Le),Sy=(function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).qc=r,i}return k(t,e),t.prototype._toFieldTransform=function(n){var r=Vl(this,n,!0),i=this.qc.map((function(s){return Fe(s,r)})),o=new Ce(i);return new ir(n.path,o)},t.prototype.isEqual=function(n){return this===n},t})(Le),Ay=(function(e){function t(n,r){var i=this;return(i=e.call(this,n)||this).Uc=r,i}return k(t,e),t.prototype._toFieldTransform=function(n){var r=new en(n.R,Sc(n.R,this.Uc));return new ir(n.path,r)},t.prototype.isEqual=function(n){return this===n},t})(Le);function _s(e,t,n,r){var i=e.Bc(1,t,n);As("Data must be an object, but it was:",i,r);var o=[],s=At.empty();Zn(r,(function(u,c){var l=Ns(t,u,n);c=X(c);var f=i.kc(l);if(c instanceof Ts)o.push(l);else{var h=Fe(c,f);h!=null&&(o.push(l),s.set(l,h))}}));var a=new Ye(o);return new Ll(s,a,i.fieldTransforms)}function Ss(e,t,n,r,i,o){var s=e.Bc(1,t,n),a=[fo(t,r,n)],u=[i];if(o.length%2!=0)throw new w(y.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(fo(t,o[c])),u.push(o[c+1]);for(var l=[],f=At.empty(),h=a.length-1;h>=0;--h)if(!jl(l,a[h])){var p=a[h],d=u[h];d=X(d);var v=s.kc(p);if(d instanceof Ts)l.push(p);else{var b=Fe(d,v);b!=null&&(l.push(p),f.set(p,b))}}var I=new Ye(l);return new Ll(f,I,s.fieldTransforms)}function Ul(e,t,n,r){return r===void 0&&(r=!1),Fe(n,e.Bc(r?4:3,t))}function Fe(e,t){if(Bl(e=X(e)))return As("Unsupported field value:",t,e),ql(e,t);if(e instanceof Le)return(function(n,r){if(!Ml(r.Dc))throw r.$c(n._methodName+"() can only be used with update() and set()");if(!r.path)throw r.$c(n._methodName+"() is not currently supported inside arrays");var i=n._toFieldTransform(r);i&&r.fieldTransforms.push(i)})(e,t),null;if(e===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.xc&&t.Dc!==4)throw t.$c("Nested arrays are not supported");return(function(n,r){for(var i=[],o=0,s=0,a=n;s<a.length;s++){var u=Fe(a[s],r.Oc(o));u==null&&(u={nullValue:"NULL_VALUE"}),i.push(u),o++}return{arrayValue:{values:i}}})(e,t)}return(function(n,r){if((n=X(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return Sc(r.R,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){var i=Et.fromDate(n);return{timestampValue:Mn(r.R,i)}}if(n instanceof Et)return i=new Et(n.seconds,1e3*Math.floor(n.nanoseconds/1e3)),{timestampValue:Mn(r.R,i)};if(n instanceof mi)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof ke)return{bytesValue:Lc(r.R,n._byteString)};if(n instanceof G){i=r.databaseId;var o=n.firestore._databaseId;if(!o.isEqual(i))throw r.$c("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Zo(n.firestore._databaseId||r.databaseId,n._key.path)}}throw r.$c("Unsupported field value: "+vi(n))})(e,t)}function ql(e,t){var n={};return pc(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Zn(e,(function(r,i){var o=Fe(i,t.Nc(r));o!=null&&(n[r]=o)})),{mapValue:{fields:n}}}function Bl(e){return!(typeof e!="object"||e===null||e instanceof Array||e instanceof Date||e instanceof Et||e instanceof mi||e instanceof ke||e instanceof G||e instanceof Le)}function As(e,t,n){if(!Bl(n)||!(function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)})(n)){var r=vi(n);throw r==="an object"?t.$c(e+" a custom object"):t.$c(e+" "+r)}}function fo(e,t,n){if((t=X(t))instanceof qt)return t._internalPath;if(typeof t=="string")return Ns(e,t);throw Hr("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var Ny=new RegExp("[~\\*/\\[\\]]");function Ns(e,t,n){if(t.search(Ny)>=0)throw Hr("Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'",e,!1,void 0,n);try{return new(qt.bind.apply(qt,H([void 0],t.split("."))))()._internalPath}catch{throw Hr("Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",e,!1,void 0,n)}}function Hr(e,t,n,r,i){var o=r&&!r.isEmpty(),s=i!==void 0,a="Function "+t+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new w(y.INVALID_ARGUMENT,(a+=". ")+e+u)}function jl(e,t){return e.some((function(n){return n.isEqual(t)}))}var Bn=(function(){function e(t,n,r,i,o){this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=o}return Object.defineProperty(e.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ref",{get:function(){return new G(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),e.prototype.exists=function(){return this._document!==null},e.prototype.data=function(){if(this._document){if(this._converter){var t=new Dy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.toProto())}},e.prototype.get=function(t){if(this._document){var n=this._document.data.field(Qr("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n)}},e})(),Dy=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.data=function(){return e.prototype.data.call(this)},t})(Bn);function Qr(e,t){return typeof t=="string"?Ns(e,t):t instanceof qt?t._internalPath:t._delegate._internalPath}var be=(function(){function e(t,n){this.hasPendingWrites=t,this.fromCache=n}return e.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},e})(),Ht=(function(e){function t(n,r,i,o,s,a){var u=this;return(u=e.call(this,n,r,i,o,a)||this)._firestore=n,u._firestoreImpl=n,u.metadata=s,u}return k(t,e),t.prototype.exists=function(){return e.prototype.exists.call(this)},t.prototype.data=function(n){if(n===void 0&&(n={}),this._document){if(this._converter){var r=new Nn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(r,n)}return this._userDataWriter.convertValue(this._document.data.toProto(),n.serverTimestamps)}},t.prototype.get=function(n,r){if(r===void 0&&(r={}),this._document){var i=this._document.data.field(Qr("DocumentSnapshot.get",n));if(i!==null)return this._userDataWriter.convertValue(i,r.serverTimestamps)}},t})(Bn),Nn=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.data=function(n){return n===void 0&&(n={}),e.prototype.data.call(this,n)},t})(Ht),re=(function(){function e(t,n,r,i){this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new be(i.hasPendingWrites,i.fromCache),this.query=r}return Object.defineProperty(e.prototype,"docs",{get:function(){var t=[];return this.forEach((function(n){return t.push(n)})),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this.size===0},enumerable:!1,configurable:!0}),e.prototype.forEach=function(t,n){var r=this;this._snapshot.docs.forEach((function(i){t.call(n,new Nn(r._firestore,r._userDataWriter,i.key,i,new be(r._snapshot.mutatedKeys.has(i.key),r._snapshot.fromCache),r.query.converter))}))},e.prototype.docChanges=function(t){t===void 0&&(t={});var n=!!t.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new w(y.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(r,i){if(r._snapshot.oldDocs.isEmpty()){var o=0;return r._snapshot.docChanges.map((function(a){var u=new Nn(r._firestore,r._userDataWriter,a.doc.key,a.doc,new be(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}}))}var s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter((function(a){return i||a.type!==3})).map((function(a){var u=new Nn(r._firestore,r._userDataWriter,a.doc.key,a.doc,new be(r._snapshot.mutatedKeys.has(a.doc.key),r._snapshot.fromCache),r.query.converter),c=-1,l=-1;return a.type!==0&&(c=s.indexOf(a.doc.key),s=s.delete(a.doc.key)),a.type!==1&&(l=(s=s.add(a.doc)).indexOf(a.doc.key)),{type:Cy(a.type),doc:u,oldIndex:c,newIndex:l}}))})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges},e})();function Cy(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return D()}}function Kl(e,t){return e instanceof Ht&&t instanceof Ht?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(e._document===null?t._document===null:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof re&&t instanceof re&&e._firestore===t._firestore&&xl(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function zl(e){if(Vr(e)&&e.explicitOrderBy.length===0)throw new w(y.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ur=function(){};function Jt(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var r=0,i=t;r<i.length;r++){var o=i[r];e=o._apply(e)}return e}var ky=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).Qc=n,o.Kc=r,o.jc=i,o.type="where",o}return k(t,e),t.prototype._apply=function(n){var r=Me(n.firestore),i=(function(o,s,a,u,c,l,f){var h;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new w(y.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+l+"' queries on FieldPath.documentId().");if(l==="in"||l==="not-in"){Za(f,l);for(var p=[],d=0,v=f;d<v.length;d++){var b=v[d];p.push(Ja(u,o,b))}h={arrayValue:{values:p}}}else h=Ja(u,o,f)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Za(f,l),h=Ul(a,"where",f,l==="in"||l==="not-in");var I=Dt.create(c,l,h);return(function(A,S){if(S.g()){var x=Qo(A);if(x!==null&&!x.isEqual(S.field))throw new w(y.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+x.toString()+"' and '"+S.field.toString()+"'");var M=Ho(A);M!==null&&$l(A,S.field,M)}var B=(function(nt,Ti){for(var bn=0,Cs=nt.filters;bn<Cs.length;bn++){var ks=Cs[bn];if(Ti.indexOf(ks.op)>=0)return ks.op}return null})(A,(function(nt){switch(nt){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}})(S.op));if(B!==null)throw B===S.op?new w(y.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+S.op.toString()+"' filter."):new w(y.INVALID_ARGUMENT,"Invalid query. You cannot use '"+S.op.toString()+"' filters with '"+B.toString()+"' filters.")})(o,I),I})(n._query,0,r,n.firestore._databaseId,this.Qc,this.Kc,this.jc);return new Ct(n.firestore,n.converter,(function(o,s){var a=o.filters.concat([s]);return new Wt(o.path,o.collectionGroup,o.explicitOrderBy.slice(),a,o.limit,o.limitType,o.startAt,o.endAt)})(n._query,i))},t})(ur),Oy=(function(e){function t(n,r){var i=this;return(i=e.call(this)||this).Qc=n,i.Wc=r,i.type="orderBy",i}return k(t,e),t.prototype._apply=function(n){var r=(function(i,o,s){if(i.startAt!==null)throw new w(y.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new w(y.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var a=new $e(o,s);return(function(u,c){if(Ho(u)===null){var l=Qo(u);l!==null&&$l(u,l,c.field)}})(i,a),a})(n._query,this.Qc,this.Wc);return new Ct(n.firestore,n.converter,(function(i,o){var s=i.explicitOrderBy.concat([o]);return new Wt(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)})(n._query,r))},t})(ur),Wa=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Gc=r,o.zc=i,o}return k(t,e),t.prototype._apply=function(n){return new Ct(n.firestore,n.converter,bc(n._query,this.Gc,this.zc))},t})(ur),Ya=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Hc=r,o.Jc=i,o}return k(t,e),t.prototype._apply=function(n){var r=Gl(n,this.type,this.Hc,this.Jc);return new Ct(n.firestore,n.converter,(function(i,o){return new Wt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,o,i.endAt)})(n._query,r))},t})(ur),Xa=(function(e){function t(n,r,i){var o=this;return(o=e.call(this)||this).type=n,o.Hc=r,o.Jc=i,o}return k(t,e),t.prototype._apply=function(n){var r=Gl(n,this.type,this.Hc,this.Jc);return new Ct(n.firestore,n.converter,(function(i,o){return new Wt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,o)})(n._query,r))},t})(ur);function Gl(e,t,n,r){if(n[0]=X(n[0]),n[0]instanceof Bn)return(function(o,s,a,u,c){if(!u)throw new w(y.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+a+"().");for(var l=[],f=0,h=Ze(o);f<h.length;f++){var p=h[f];if(p.field.isKeyField())l.push(Lr(s,u.key));else{var d=u.data.field(p.field);if(zo(d))throw new w(y.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+p.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){var v=p.field.canonicalString();throw new w(y.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+v+"' (used as the orderBy) does not exist.")}l.push(d)}}return new Ln(l,c)})(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Me(e.firestore);return(function(o,s,a,u,c,l){var f=o.explicitOrderBy;if(c.length>f.length)throw new w(y.INVALID_ARGUMENT,"Too many arguments provided to "+u+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var h=[],p=0;p<c.length;p++){var d=c[p];if(f[p].field.isKeyField()){if(typeof d!="string")throw new w(y.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+u+"(), but got a "+typeof d);if(!Wo(o)&&d.indexOf("/")!==-1)throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+u+"() must be a plain document ID, but '"+d+"' contains a slash.");var v=o.path.child(U.fromString(d));if(!C.isDocumentKey(v))throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+u+"() must result in a valid document path, but '"+v+"' is not because it contains an odd number of segments.");var b=new C(v);h.push(Lr(s,b))}else{var I=Ul(a,u,d);h.push(I)}}return new Ln(h,l)})(e._query,e.firestore._databaseId,i,t,n,r)}function Ja(e,t,n){if(typeof(n=X(n))=="string"){if(n==="")throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Wo(t)&&n.indexOf("/")!==-1)throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=t.path.child(U.fromString(n));if(!C.isDocumentKey(r))throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Lr(e,new C(r))}if(n instanceof G)return Lr(e,n._key);throw new w(y.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+vi(n)+".")}function Za(e,t){if(!Array.isArray(e)||e.length===0)throw new w(y.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+t.toString()+"' filters.");if(e.length>10)throw new w(y.INVALID_ARGUMENT,"Invalid Query. '"+t.toString()+"' filters support a maximum of 10 elements in the value array.")}function $l(e,t,n){if(!n.isEqual(t))throw new w(y.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var Ds=(function(){function e(){}return e.prototype.convertValue=function(t,n){switch(n===void 0&&(n="none"),le(t)){case 0:return null;case 1:return t.booleanValue;case 2:return W(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,n);case 5:return t.stringValue;case 6:return this.convertBytes(Xe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,n);case 10:return this.convertObject(t.mapValue,n);default:throw D()}},e.prototype.convertObject=function(t,n){var r=this,i={};return Zn(t.fields||{},(function(o,s){i[o]=r.convertValue(s,n)})),i},e.prototype.convertGeoPoint=function(t){return new mi(W(t.latitude),W(t.longitude))},e.prototype.convertArray=function(t,n){var r=this;return(t.values||[]).map((function(i){return r.convertValue(i,n)}))},e.prototype.convertServerTimestamp=function(t,n){switch(n){case"previous":var r=yc(t);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(xn(t));default:return null}},e.prototype.convertTimestamp=function(t){var n=ce(t);return new Et(n.seconds,n.nanos)},e.prototype.convertDocumentKey=function(t,n){var r=U.fromString(t);O(Kc(r));var i=new $r(r.get(1),r.get(3)),o=new C(r.popFirst(5));return i.isEqual(n)||Y("Document "+o+" contains a document reference within a different database ("+i.projectId+"/"+i.database+") which is not supported. It will be treated as a reference in the current database ("+n.projectId+"/"+n.database+") instead."),o},e})();function wi(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Ry=(function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return k(t,e),t.prototype.convertBytes=function(n){return new ke(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new G(this.firestore,null,r)},t})(Ds),xy=(function(){function e(t,n){this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Me(t)}return e.prototype.set=function(t,n,r){this._verifyNotCommitted();var i=ie(t,this._firestore),o=wi(i.converter,n,r),s=gi(this._dataReader,"WriteBatch.set",i._key,o,i.converter!==null,r);return this._mutations.push(s.toMutation(i._key,ut.none())),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this._verifyNotCommitted();var s,a=ie(t,this._firestore);return s=typeof(n=X(n))=="string"||n instanceof qt?Ss(this._dataReader,"WriteBatch.update",a._key,n,r,i):_s(this._dataReader,"WriteBatch.update",a._key,n),this._mutations.push(s.toMutation(a._key,ut.exists(!0))),this},e.prototype.delete=function(t){this._verifyNotCommitted();var n=ie(t,this._firestore);return this._mutations=this._mutations.concat(new sr(n._key,ut.none())),this},e.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},e.prototype._verifyNotCommitted=function(){if(this._committed)throw new w(y.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},e})();function ie(e,t){if((e=X(e)).firestore!==t)throw new w(y.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var Te=(function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return k(t,e),t.prototype.convertBytes=function(n){return new ke(n)},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return new G(this.firestore,null,r)},t})(Ds);function tu(e,t,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];e=q(e,G);var o=q(e.firestore,J),s=Me(o);return jn(o,[(typeof(t=X(t))=="string"||t instanceof qt?Ss(s,"updateDoc",e._key,t,n,r):_s(s,"updateDoc",e._key,t)).toMutation(e._key,ut.exists(!0))])}function Hl(e){for(var t,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];e=X(e);var s={includeMetadataChanges:!1},a=0;typeof i[a]!="object"||fn(i[a])||(s=i[a],a++);var u,c,l,f={includeMetadataChanges:s.includeMetadataChanges};if(fn(i[a])){var h=i[a];i[a]=(t=h.next)===null||t===void 0?void 0:t.bind(h),i[a+1]=(n=h.error)===null||n===void 0?void 0:n.bind(h),i[a+2]=(r=h.complete)===null||r===void 0?void 0:r.bind(h)}if(e instanceof G)c=q(e.firestore,J),l=er(e._key.path),u={next:function(v){i[a]&&i[a](ho(c,e,v))},error:i[a+1],complete:i[a+2]};else{var p=q(e,Ct);c=q(p.firestore,J),l=p._query;var d=new Te(c);u={next:function(v){i[a]&&i[a](new re(c,d,p,v))},error:i[a+1],complete:i[a+2]},zl(e._query)}return(function(v,b,I,A){var S=this,x=new di(A),M=new ps(b,x,I);return v.asyncQueue.enqueueAndForget((function(){return g(S,void 0,void 0,(function(){var B;return m(this,(function(nt){switch(nt.label){case 0:return B=ls,[4,ln(v)];case 1:return[2,B.apply(void 0,[nt.sent(),M])]}}))}))})),function(){x.Wo(),v.asyncQueue.enqueueAndForget((function(){return g(S,void 0,void 0,(function(){var B;return m(this,(function(nt){switch(nt.label){case 0:return B=fs,[4,ln(v)];case 1:return[2,B.apply(void 0,[nt.sent(),M])]}}))}))}))}})(at(c),l,f,u)}function jn(e,t){return(function(n,r){var i=this,o=new Rt;return n.asyncQueue.enqueueAndForget((function(){return g(i,void 0,void 0,(function(){var s;return m(this,(function(a){switch(a.label){case 0:return s=Qd,[4,Dl(n)];case 1:return[2,s.apply(void 0,[a.sent(),r,o])]}}))}))})),o.promise})(at(e),t)}function ho(e,t,n){var r=n.docs.get(t._key),i=new Te(e);return new Ht(e,i,t._key,r,new be(n.hasPendingWrites,n.fromCache),t.converter)}var Py=(function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this)._firestore=n,i}return k(t,e),t.prototype.get=function(n){var r=this,i=ie(n,this._firestore),o=new Te(this._firestore);return e.prototype.get.call(this,n).then((function(s){return new Ht(r._firestore,o,i._key,s._document,new be(!1,!1),i.converter)}))},t})((function(){function e(t,n){this._firestore=t,this._transaction=n,this._dataReader=Me(t)}return e.prototype.get=function(t){var n=this,r=ie(t,this._firestore),i=new Ry(this._firestore);return this._transaction.lookup([r._key]).then((function(o){if(!o||o.length!==1)return D();var s=o[0];if(s.isFoundDocument())return new Bn(n._firestore,i,s.key,s,r.converter);if(s.isNoDocument())return new Bn(n._firestore,i,r._key,null,r.converter);throw D()}))},e.prototype.set=function(t,n,r){var i=ie(t,this._firestore),o=wi(i.converter,n,r),s=gi(this._dataReader,"Transaction.set",i._key,o,i.converter!==null,r);return this._transaction.set(i._key,s),this},e.prototype.update=function(t,n,r){for(var i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s,a=ie(t,this._firestore);return s=typeof(n=X(n))=="string"||n instanceof qt?Ss(this._dataReader,"Transaction.update",a._key,n,r,i):_s(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,s),this},e.prototype.delete=function(t){var n=ie(t,this._firestore);return this._transaction.delete(n._key),this},e})());function eu(){if(typeof Uint8Array>"u")throw new w(y.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function nu(){if(typeof atob>"u")throw new w(y.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Ql=(function(){function e(t){this._delegate=t}return e.fromBase64String=function(t){return nu(),new e(ke.fromBase64String(t))},e.fromUint8Array=function(t){return eu(),new e(ke.fromUint8Array(t))},e.prototype.toBase64=function(){return nu(),this._delegate.toBase64()},e.prototype.toUint8Array=function(){return eu(),this._delegate.toUint8Array()},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},e})(),Ly=(function(){function e(){}return e.prototype.enableIndexedDbPersistence=function(t,n){return(function(r,i){Qa(r=q(r,J));var o=at(r),s=r._freezeSettings(),a=new lo;return Ha(o,a,new _l(a,s.cacheSizeBytes,i?.forceOwnership))})(t._delegate,{forceOwnership:n})},e.prototype.enableMultiTabIndexedDbPersistence=function(t){return(function(n){Qa(n=q(n,J));var r=at(n),i=n._freezeSettings(),o=new lo;return Ha(r,o,new cy(o,i.cacheSizeBytes))})(t._delegate)},e.prototype.clearIndexedDbPersistence=function(t){return(function(n){var r=this;if(n._initialized&&!n._terminated)throw new w(y.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var i=new Rt;return n._queue.enqueueAndForgetEvenWhileRestricted((function(){return g(r,void 0,void 0,(function(){var o;return m(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,(function(a){return g(this,void 0,void 0,(function(){var u;return m(this,(function(c){switch(c.label){case 0:return on.yt()?(u=a+"main",[4,on.delete(u)]):[2,Promise.resolve()];case 1:return c.sent(),[2]}}))}))})(is(n._databaseId,n._persistenceKey))];case 1:return s.sent(),i.resolve(),[3,3];case 2:return o=s.sent(),i.reject(o),[3,3];case 3:return[2]}}))}))})),i.promise})(t._delegate)},e})(),Wl=(function(){function e(t,n,r){var i=this;this._delegate=n,this.Yc=r,this.INTERNAL={delete:function(){return i.terminate()}},t instanceof $r||(this.Xc=t)}return Object.defineProperty(e.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),e.prototype.settings=function(t){t.merge&&delete(t=Object.assign(Object.assign({},this._delegate._getSettings()),t)).merge,this._delegate._setSettings(t)},e.prototype.useEmulator=function(t,n,r){r===void 0&&(r={}),(function(i,o,s,a){a===void 0&&(a={});var u=(i=q(i,qn))._getSettings();if(u.host!=="firestore.googleapis.com"&&u.host!==o&&Ji("Host has been set in both settings() and useEmulator(), emulator host will be used"),i._setSettings(Object.assign(Object.assign({},u),{host:o+":"+s,ssl:!1})),a.mockUserToken){var c=sf(a.mockUserToken),l=a.mockUserToken.sub||a.mockUserToken.user_id;if(!l)throw new w(y.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");i._credentials=new dy(new Cl(c,new wt(l)))}})(this._delegate,t,n,r)},e.prototype.enableNetwork=function(){return(function(t){var n=this;return t.asyncQueue.enqueue((function(){return g(n,void 0,void 0,(function(){var r,i;return m(this,(function(o){switch(o.label){case 0:return[4,Fa(t)];case 1:return r=o.sent(),[4,Va(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!0),(function(s){var a=_(s);return a.$r.delete(0),ar(a)})(i))]}}))}))}))})(at(q(this._delegate,J)))},e.prototype.disableNetwork=function(){return(function(t){var n=this;return t.asyncQueue.enqueue((function(){return g(n,void 0,void 0,(function(){var r,i;return m(this,(function(o){switch(o.label){case 0:return[4,Fa(t)];case 1:return r=o.sent(),[4,Va(t)];case 2:return i=o.sent(),[2,(r.setNetworkEnabled(!1),(function(s){return g(this,void 0,void 0,(function(){var a;return m(this,(function(u){switch(u.label){case 0:return(a=_(s)).$r.add(0),[4,vn(a)];case 1:return u.sent(),a.Br.set("Offline"),[2]}}))}))})(i))]}}))}))}))})(at(q(this._delegate,J)))},e.prototype.enablePersistence=function(t){var n=!1,r=!1;return t&&kl("synchronizeTabs",n=!!t.synchronizeTabs,"experimentalForceOwningTab",r=!!t.experimentalForceOwningTab),n?this.Yc.enableMultiTabIndexedDbPersistence(this):this.Yc.enableIndexedDbPersistence(this,r)},e.prototype.clearPersistence=function(){return this.Yc.clearIndexedDbPersistence(this)},e.prototype.terminate=function(){return this.Xc&&(this.Xc._removeServiceInstance("firestore"),this.Xc._removeServiceInstance("firestore-exp")),this._delegate._delete()},e.prototype.waitForPendingWrites=function(){return(function(t){var n=this,r=new Rt;return t.asyncQueue.enqueueAndForget((function(){return g(n,void 0,void 0,(function(){var i;return m(this,(function(o){switch(o.label){case 0:return i=Jd,[4,Dl(t)];case 1:return[2,i.apply(void 0,[o.sent(),r])]}}))}))})),r.promise})(at(q(this._delegate,J)))},e.prototype.onSnapshotsInSync=function(t){return(function(n,r){return(function(i,o){var s=this,a=new di(o);return i.asyncQueue.enqueueAndForget((function(){return g(s,void 0,void 0,(function(){var u;return m(this,(function(c){switch(c.label){case 0:return u=function(l,f){_(l).Gr.add(f),f.next()},[4,ln(i)];case 1:return[2,u.apply(void 0,[c.sent(),a])]}}))}))})),function(){a.Wo(),i.asyncQueue.enqueueAndForget((function(){return g(s,void 0,void 0,(function(){var u;return m(this,(function(c){switch(c.label){case 0:return u=function(l,f){_(l).Gr.delete(f)},[4,ln(i)];case 1:return[2,u.apply(void 0,[c.sent(),a])]}}))}))}))}})(at(n=q(n,J)),fn(r)?r:{next:r})})(this._delegate,t)},Object.defineProperty(e.prototype,"app",{get:function(){if(!this.Xc)throw new w(y.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Xc},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Wr(this,Ol(this._delegate,t))}catch(n){throw pt(n,"collection()","Firestore.collection()")}},e.prototype.doc=function(t){try{return new _e(this,Tr(this._delegate,t))}catch(n){throw pt(n,"doc()","Firestore.doc()")}},e.prototype.collectionGroup=function(t){try{return new Ii(this,(function(n,r){if(n=q(n,qn),Es("collectionGroup","collection id",r),r.indexOf("/")>=0)throw new w(y.INVALID_ARGUMENT,"Invalid collection ID '"+r+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new Ct(n,null,(function(i){return new Wt(U.emptyPath(),i)})(r))})(this._delegate,t))}catch(n){throw pt(n,"collectionGroup()","Firestore.collectionGroup()")}},e.prototype.runTransaction=function(t){var n=this;return(function(r,i){return(function(o,s){var a=this,u=new Rt;return o.asyncQueue.enqueueAndForget((function(){return g(a,void 0,void 0,(function(){var c;return m(this,(function(l){switch(l.label){case 0:return[4,(function(f){return yi(f).then((function(h){return h.datastore}))})(o)];case 1:return c=l.sent(),new fy(o.asyncQueue,c,s,u).run(),[2]}}))}))})),u.promise})(at(r),(function(o){return i(new Py(r,o))}))})(this._delegate,(function(r){return t(new Yl(n,r))}))},e.prototype.batch=function(){var t=this;return at(this._delegate),new Xl(new xy(this._delegate,(function(n){return jn(t._delegate,n)})))},e.prototype.loadBundle=function(t){throw new w(y.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},e.prototype.namedQuery=function(t){throw new w(y.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},e})(),bi=(function(e){function t(n){var r=this;return(r=e.call(this)||this).firestore=n,r}return k(t,e),t.prototype.convertBytes=function(n){return new Ql(new ke(n))},t.prototype.convertReference=function(n){var r=this.convertDocumentKey(n,this.firestore._databaseId);return _e.Zc(r,this.firestore,null)},t})(Ds);function My(e){var t;t=e,Lt.setLogLevel(t)}var Yl=(function(){function e(t,n){this._firestore=t,this._delegate=n,this._userDataWriter=new bi(t)}return e.prototype.get=function(t){var n=this,r=Ee(t);return this._delegate.get(r).then((function(i){return new Kn(n._firestore,new Ht(n._firestore._delegate,n._userDataWriter,i._key,i._document,i.metadata,r.converter))}))},e.prototype.set=function(t,n,r){var i=Ee(t);return r?(Is("Transaction.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ee(t);return arguments.length===2?this._delegate.update(a,n):(i=this._delegate).update.apply(i,H([a,n,r],o)),this},e.prototype.delete=function(t){var n=Ee(t);return this._delegate.delete(n),this},e})(),Xl=(function(){function e(t){this._delegate=t}return e.prototype.set=function(t,n,r){var i=Ee(t);return r?(Is("WriteBatch.set",r),this._delegate.set(i,n,r)):this._delegate.set(i,n),this},e.prototype.update=function(t,n,r){for(var i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];var a=Ee(t);return arguments.length===2?this._delegate.update(a,n):(i=this._delegate).update.apply(i,H([a,n,r],o)),this},e.prototype.delete=function(t){var n=Ee(t);return this._delegate.delete(n),this},e.prototype.commit=function(){return this._delegate.commit()},e})(),Ei=(function(){function e(t,n,r){this._firestore=t,this._userDataWriter=n,this._delegate=r}return e.prototype.fromFirestore=function(t,n){var r=new Nn(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new zn(this._firestore,r),n??{})},e.prototype.toFirestore=function(t,n){return n?this._delegate.toFirestore(t,n):this._delegate.toFirestore(t)},e.tu=function(t,n){var r=e.eu,i=r.get(t);i||(i=new WeakMap,r.set(t,i));var o=i.get(n);return o||(o=new e(t,new bi(t),n),i.set(n,o)),o},e})();Ei.eu=new WeakMap;var _e=(function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new bi(t)}return e.nu=function(t,n,r){if(t.length%2!=0)throw new w(y.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.canonicalString()+" has "+t.length);return new e(n,new G(n._delegate,r,new C(t)))},e.Zc=function(t,n,r){return new e(n,new G(n._delegate,r,t))},Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return new Wr(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),e.prototype.collection=function(t){try{return new Wr(this.firestore,Ol(this._delegate,t))}catch(n){throw pt(n,"collection()","DocumentReference.collection()")}},e.prototype.isEqual=function(t){return(t=X(t))instanceof G&&Rl(this._delegate,t)},e.prototype.set=function(t,n){n=Is("DocumentReference.set",n);try{return(function(r,i,o){r=q(r,G);var s=q(r.firestore,J),a=wi(r.converter,i,o);return jn(s,[gi(Me(s),"setDoc",r._key,a,r.converter!==null,o).toMutation(r._key,ut.none())])})(this._delegate,t,n)}catch(r){throw pt(r,"setDoc()","DocumentReference.set()")}},e.prototype.update=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];try{return arguments.length===1?tu(this._delegate,t):tu.apply(void 0,H([this._delegate,t,n],r))}catch(o){throw pt(o,"updateDoc()","DocumentReference.update()")}},e.prototype.delete=function(){return jn(q((t=this._delegate).firestore,J),[new sr(t._key,ut.none())]);var t},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Jl(n),o=Zl(n,(function(s){return new Kn(t.firestore,new Ht(t.firestore._delegate,t._userDataWriter,s._key,s._document,s.metadata,t._delegate.converter))}));return Hl(this._delegate,i,o)},e.prototype.get=function(t){var n=this;return(t?.source==="cache"?(function(r){r=q(r,G);var i=q(r.firestore,J),o=at(i),s=new Te(i);return(function(a,u){var c=this,l=new Rt;return a.asyncQueue.enqueueAndForget((function(){return g(c,void 0,void 0,(function(){var f;return m(this,(function(h){switch(h.label){case 0:return f=function(p,d,v){return g(this,void 0,void 0,(function(){var b,I;return m(this,(function(A){switch(A.label){case 0:return A.trys.push([0,2,,3]),[4,(function(S,x){var M=_(S);return M.persistence.runTransaction("read document","readonly",(function(B){return M.Mn.mn(B,x)}))})(p,d)];case 1:return(I=A.sent()).isFoundDocument()?v.resolve(I):I.isNoDocument()?v.resolve(null):v.reject(new w(y.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return b=A.sent(),I=wn(b,"Failed to get document '"+d+" from cache"),v.reject(I),[3,3];case 3:return[2]}}))}))},[4,Nl(a)];case 1:return[2,f.apply(void 0,[h.sent(),u,l])]}}))}))})),l.promise})(o,r._key).then((function(a){return new Ht(i,s,r._key,a,new be(a!==null&&a.hasLocalMutations,!0),r.converter)}))})(this._delegate):t?.source==="server"?(function(r){r=q(r,G);var i=q(r.firestore,J);return Ua(at(i),r._key,{source:"server"}).then((function(o){return ho(i,r,o)}))})(this._delegate):(function(r){r=q(r,G);var i=q(r.firestore,J);return Ua(at(i),r._key).then((function(o){return ho(i,r,o)}))})(this._delegate)).then((function(r){return new Kn(n.firestore,new Ht(n.firestore._delegate,n._userDataWriter,r._key,r._document,r.metadata,n._delegate.converter))}))},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(Ei.tu(this.firestore,t)):this._delegate.withConverter(null))},e})();function pt(e,t,n){return e.message=e.message.replace(t,n),e}function Jl(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(typeof r=="object"&&!fn(r))return r}return{}}function Zl(e,t){var n,r,i;return{next:function(o){i.next&&i.next(t(o))},error:(n=(i=fn(e[0])?e[0]:fn(e[1])?e[1]:typeof e[0]=="function"?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)===null||n===void 0?void 0:n.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Kn=(function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"ref",{get:function(){return new _e(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),e.prototype.data=function(t){return this._delegate.data(t)},e.prototype.get=function(t,n){return this._delegate.get(t,n)},e.prototype.isEqual=function(t){return Kl(this._delegate,t._delegate)},e})(),zn=(function(e){function t(){return e!==null&&e.apply(this,arguments)||this}return k(t,e),t.prototype.data=function(n){return this._delegate.data(n)},t})(Kn),Ii=(function(){function e(t,n){this.firestore=t,this._delegate=n,this._userDataWriter=new bi(t)}return e.prototype.where=function(t,n,r){try{return new e(this.firestore,Jt(this._delegate,(function(i,o,s){var a=o,u=Qr("where",i);return new ky(u,a,s)})(t,n,r)))}catch(i){throw pt(i,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.orderBy=function(t,n){try{return new e(this.firestore,Jt(this._delegate,(function(r,i){i===void 0&&(i="asc");var o=i,s=Qr("orderBy",r);return new Oy(s,o)})(t,n)))}catch(r){throw pt(r,/(orderBy|where)\(\)/,"Query.$1()")}},e.prototype.limit=function(t){try{return new e(this.firestore,Jt(this._delegate,(function(n){return Ga("limit",n),new Wa("limit",n,"F")})(t)))}catch(n){throw pt(n,"limit()","Query.limit()")}},e.prototype.limitToLast=function(t){try{return new e(this.firestore,Jt(this._delegate,(function(n){return Ga("limitToLast",n),new Wa("limitToLast",n,"L")})(t)))}catch(n){throw pt(n,"limitToLast()","Query.limitToLast()")}},e.prototype.startAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Jt(this._delegate,(function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Ya("startAt",r,!0)}).apply(void 0,t)))}catch(r){throw pt(r,"startAt()","Query.startAt()")}},e.prototype.startAfter=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Jt(this._delegate,(function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Ya("startAfter",r,!1)}).apply(void 0,t)))}catch(r){throw pt(r,"startAfter()","Query.startAfter()")}},e.prototype.endBefore=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Jt(this._delegate,(function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Xa("endBefore",r,!0)}).apply(void 0,t)))}catch(r){throw pt(r,"endBefore()","Query.endBefore()")}},e.prototype.endAt=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];try{return new e(this.firestore,Jt(this._delegate,(function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return new Xa("endAt",r,!1)}).apply(void 0,t)))}catch(r){throw pt(r,"endAt()","Query.endAt()")}},e.prototype.isEqual=function(t){return xl(this._delegate,t._delegate)},e.prototype.get=function(t){var n=this;return(t?.source==="cache"?(function(r){r=q(r,Ct);var i=q(r.firestore,J),o=at(i),s=new Te(i);return(function(a,u){var c=this,l=new Rt;return a.asyncQueue.enqueueAndForget((function(){return g(c,void 0,void 0,(function(){var f;return m(this,(function(h){switch(h.label){case 0:return f=function(p,d,v){return g(this,void 0,void 0,(function(){var b,I,A,S,x;return m(this,(function(M){switch(M.label){case 0:return M.trys.push([0,2,,3]),[4,Kr(p,d,!0)];case 1:return x=M.sent(),b=new wl(d,x.Bn),I=b._o(x.documents),A=b.applyChanges(I,!1),v.resolve(A.snapshot),[3,3];case 2:return S=M.sent(),x=wn(S,"Failed to execute query '"+d+" against cache"),v.reject(x),[3,3];case 3:return[2]}}))}))},[4,Nl(a)];case 1:return[2,f.apply(void 0,[h.sent(),u,l])]}}))}))})),l.promise})(o,r._query).then((function(a){return new re(i,s,r,a)}))})(this._delegate):t?.source==="server"?(function(r){r=q(r,Ct);var i=q(r.firestore,J),o=at(i),s=new Te(i);return qa(o,r._query,{source:"server"}).then((function(a){return new re(i,s,r,a)}))})(this._delegate):(function(r){r=q(r,Ct);var i=q(r.firestore,J),o=at(i),s=new Te(i);return zl(r._query),qa(o,r._query).then((function(a){return new re(i,s,r,a)}))})(this._delegate)).then((function(r){return new po(n.firestore,new re(n.firestore._delegate,n._userDataWriter,n._delegate,r._snapshot))}))},e.prototype.onSnapshot=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var i=Jl(n),o=Zl(n,(function(s){return new po(t.firestore,new re(t.firestore._delegate,t._userDataWriter,t._delegate,s._snapshot))}));return Hl(this._delegate,i,o)},e.prototype.withConverter=function(t){return new e(this.firestore,t?this._delegate.withConverter(Ei.tu(this.firestore,t)):this._delegate.withConverter(null))},e})(),Fy=(function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"doc",{get:function(){return new zn(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),e})(),po=(function(){function e(t,n){this._firestore=t,this._delegate=n}return Object.defineProperty(e.prototype,"query",{get:function(){return new Ii(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map((function(n){return new zn(t._firestore,n)}))},enumerable:!1,configurable:!0}),e.prototype.docChanges=function(t){var n=this;return this._delegate.docChanges(t).map((function(r){return new Fy(n._firestore,r)}))},e.prototype.forEach=function(t,n){var r=this;this._delegate.forEach((function(i){t.call(n,new zn(r._firestore,i))}))},e.prototype.isEqual=function(t){return Kl(this._delegate,t._delegate)},e})(),Wr=(function(e){function t(n,r){var i=this;return(i=e.call(this,n,r)||this).firestore=n,i._delegate=r,i}return k(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var n=this._delegate.parent;return n?new _e(this.firestore,n):null},enumerable:!1,configurable:!0}),t.prototype.doc=function(n){try{return new _e(this.firestore,n===void 0?Tr(this._delegate):Tr(this._delegate,n))}catch(r){throw pt(r,"doc()","CollectionReference.doc()")}},t.prototype.add=function(n){var r=this;return(function(i,o){var s=q(i.firestore,J),a=Tr(i),u=wi(i.converter,o);return jn(s,[gi(Me(i.firestore),"addDoc",a._key,u,i.converter!==null,{}).toMutation(a._key,ut.exists(!1))]).then((function(){return a}))})(this._delegate,n).then((function(i){return new _e(r.firestore,i)}))},t.prototype.isEqual=function(n){return Rl(this._delegate,n._delegate)},t.prototype.withConverter=function(n){return new t(this.firestore,n?this._delegate.withConverter(Ei.tu(this.firestore,n)):this._delegate.withConverter(null))},t})(Ii);function Ee(e){return q(e,G)}var Vy=(function(){function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this._delegate=new(qt.bind.apply(qt,H([void 0],t)))}return e.documentId=function(){return new e(xt.keyField().canonicalString())},e.prototype.isEqual=function(t){return(t=X(t))instanceof qt&&this._delegate._internalPath.isEqual(t._internalPath)},e})(),Uy=(function(){function e(t){this._delegate=t}return e.serverTimestamp=function(){var t=new Ty("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)},e.delete=function(){var t=new Ts("deleteField");return t._methodName="FieldValue.delete",new e(t)},e.arrayUnion=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=(function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new _y("arrayUnion",i)}).apply(void 0,t);return r._methodName="FieldValue.arrayUnion",new e(r)},e.arrayRemove=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=(function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];return new Sy("arrayRemove",i)}).apply(void 0,t);return r._methodName="FieldValue.arrayRemove",new e(r)},e.increment=function(t){var n=(function(r){return new Ay("increment",r)})(t);return n._methodName="FieldValue.increment",new e(n)},e.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},e})(),qy={Firestore:Wl,GeoPoint:mi,Timestamp:Et,Blob:Ql,Transaction:Yl,WriteBatch:Xl,DocumentReference:_e,DocumentSnapshot:Kn,Query:Ii,QueryDocumentSnapshot:zn,QuerySnapshot:po,CollectionReference:Wr,FieldPath:Vy,FieldValue:Uy,setLogLevel:My,CACHE_SIZE_UNLIMITED:wy};function By(e){(function(t,n){t.INTERNAL.registerComponent(new Yr("firestore",(function(r){var i=r.getProvider("app").getImmediate();return n(i,r.getProvider("auth-internal"))}),"PUBLIC").setServiceProps(Object.assign({},qy)))})(e,(function(t,n){return new Wl(t,new J(t,n),new Ly)})),e.registerVersion("@firebase/firestore","2.3.0")}By(Gn);const jy={apiKey:"AIzaSyB9VDZh5MyfQ5FuOJdiKz3GBl_zm5mEqo0",authDomain:"portfolio-cv-45ef6.firebaseapp.com",projectId:"portfolio-cv-45ef6",storageBucket:"portfolio-cv-45ef6.firebasestorage.app",messagingSenderId:"980896584557",appId:"1:980896584557:web:2612a9d6c7d47506c78064"};Gn.initializeApp(jy);const zy=Gn.firestore();export{Ky as l,zy as p};
